{
  "currentState": "recalled-JSB框架",
  "stateHistory": [
    {
      "from": "initial",
      "command": "init",
      "timestamp": "2025-07-04T07:13:56.658Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/mnutils"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "remember",
      "timestamp": "2025-07-04T08:41:50.700Z",
      "args": [
        "MNUtil.select() 方法不存在陷阱：在 MN-Addon 开发中，文档记载的 MNUtil.select() 方法实际不存在。正确的方法是 MNUtil.userSelect(mainTitle, subTitle, items)，返回 Promise<number>。注意：0 是取消按钮，实际选项从 1 开始（而不是文档中说的从 0 开始）。已修复 mntask 项目中 9 个使用错误 API 的筛选函数。教训：始终以源码为准，使用 grep 验证方法是否存在。",
        "--tags",
        "MN-Addon MNUtils API错误 文档问题"
      ]
    },
    {
      "from": "memory_saved",
      "command": "init",
      "timestamp": "2025-07-04T13:11:34.159Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/mnai"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "remember",
      "timestamp": "2025-07-04T14:08:05.696Z",
      "args": [
        "## MNTask 开发经验总结 - UI 布局陷阱\n\n### 1. ScrollView 布局与固定元素\n**问题**：关闭按钮随 ScrollView 内容移动\n**解决**：\n- 将 ScrollView 和关闭按钮放在同一父视图中\n- 缩短 ScrollView 宽度（width - 45）为关闭按钮预留空间\n- 关闭按钮定位：x = tabView.width + 5\n\n### 2. ScrollView 方向锁定\n**问题**：横向滚动视图也能垂直移动\n**解决**：\n```javascript\ntabView.alwaysBounceVertical = false\ntabView.directionalLockEnabled = true\ntabView.contentSize.height = tabView.frame.height\n```\n\n### 3. iOS 颜色值陷阱\n**错误**：color:\"transparent\"\n**正确**：color:\"#ffffff\", alpha:0.0\n\n### 4. 视图层级与坐标系统\n- 子视图坐标相对于直接父视图\n- 要对齐的元素必须在同一父视图中\n- 典型层级：view → [moveButton, tabView, closeButton, settingView]",
        "--tags",
        "MNTask UI布局 ScrollView iOS开发 MarginNote插件"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-07-04T14:44:39.873Z",
      "args": [
        "JSB 框架类定义陷阱 - MN-Addon 项目重要经验\n\n问题：在 JSB.defineClass 中直接定义对象属性会导致该属性成为\"类属性\"而非\"实例属性\"，导致实例无法访问。\n\n症状：\n- self.viewManager 显示为 undefined\n- 按钮点击没有反应\n- 大型对象属性无法访问\n\n错误示例：\n```javascript\nvar Controller = JSB.defineClass('Controller', {\n  viewManager: {  // ❌ 错误：成为类属性\n    switchTo: function() {}\n  }\n})\n```\n\n正确做法：\n```javascript\n// 1. 在 prototype 上定义初始化方法\nController.prototype.initViewManager = function() {\n  this.viewManager = {  // ✅ 创建实例属性\n    switchTo: function() {}\n  }\n}\n\n// 2. 在 init 中调用\nController.prototype.init = function() {\n  this.initViewManager()\n}\n```\n\n重要规则：在 JSB.defineClass 中，只能定义方法（函数），不能定义对象属性！所有对象属性必须在实例初始化时创建。\n\n相关文件：\n- /Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/mntask/settingController.js\n- /Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/mntask/VIEWMANAGER_GUIDE.md\n- /Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/CLAUDE.md",
        "--tags",
        "JSB框架 MarginNote 类定义 实例属性 viewManager 调试经验"
      ]
    },
    {
      "from": "memory_saved",
      "command": "recall",
      "timestamp": "2025-07-04T14:44:58.308Z",
      "args": [
        "JSB框架"
      ]
    }
  ],
  "lastUpdated": "2025-07-04T14:44:58.316Z"
}
