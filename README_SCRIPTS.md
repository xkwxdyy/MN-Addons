# MN Toolbar Pro 开发脚本说明

本目录包含两个重要的自动化脚本，用于管理 MN Toolbar Pro 的版本更新和打包发布。

## 📦 update.py - 智能更新脚本

### 功能特点

1. **自动版本识别**：自动查找并识别最新版本的 .mnaddon 文件
2. **用户文件保护**：保护您的自定义文件不被覆盖
3. **智能合并**：自动合并用户修改（如 webviewController.js 中的注册表代码）
4. **完整备份**：更新前自动备份所有用户文件
5. **详细报告**：生成 Markdown 格式的更新报告

### 使用方法

```bash
python3 update.py
```

### 保护的文件

- **自定义文件**（永不覆盖）：
  - `xdyy_utils_extensions.js`
  - `xdyy_custom_actions_registry.js`

- **智能合并的文件**：
  - `webviewController.js` - 保留注册表相关的修改

### 更新流程

1. 查找最新的 .mnaddon 文件
2. 备份用户文件到带时间戳的目录
3. 解包新版本到临时目录
4. 更新 mntoolbar_official（官方备份）
5. 智能更新 mntoolbar（开发目录）
6. 生成并打开更新报告

### 注意事项

- 更新前会自动创建备份，如需回滚可从备份目录恢复
- 脚本会自动修复已知的拼写错误（如 foucsNote → focusNote）
- 如果官方更新导致代码结构大变，脚本会在报告中说明

---

## 📦 pack.py - 智能打包脚本

### 功能特点

1. **版本管理**：自动管理版本号（支持 major/minor/patch）
2. **定制版支持**：支持打包夏大鱼羊定制版
3. **发布说明**：自动生成发布说明模板
4. **命名规范**：自动生成符合规范的文件名

### 使用方法

```bash
python3 pack.py
```

### 版本更新选项

1. **补丁版本 (patch)**：1.0.0 → 1.0.1（修复 bug）
2. **次要版本 (minor)**：1.0.0 → 1.1.0（新增功能）
3. **主要版本 (major)**：1.0.0 → 2.0.0（重大更新）
4. **自定义版本**：手动输入版本号
5. **不更新版本**：保持当前版本号

### 输出文件命名

- **正式版**：`mntoolbar_v1_0_0.mnaddon`
- **Alpha 版**：`mntoolbar_v1_0_0_alpha0427.mnaddon`
- **定制版**：`mntoolbar_v1_0_0_xdyy0627.mnaddon`

### 打包流程

1. 读取当前版本号
2. 选择版本更新方式
3. 更新 manifest.json
4. 创建发布说明模板
5. 等待编辑发布说明
6. 执行打包
7. 显示打包结果

---

## 🔧 环境要求

- Python 3.6+
- mnaddon 命令行工具
- macOS/Linux/Windows（部分功能如自动打开文件仅支持 macOS）

## 📝 最佳实践

1. **更新官方版本时**：
   ```bash
   # 1. 将新的 .mnaddon 文件放到当前目录
   # 2. 运行更新脚本
   python3 update.py
   # 3. 查看更新报告，确认更新内容
   # 4. 测试功能是否正常
   ```

2. **发布新版本时**：
   ```bash
   # 1. 完成所有开发和测试
   # 2. 运行打包脚本
   python3 pack.py
   # 3. 选择合适的版本号
   # 4. 编辑发布说明
   # 5. 完成打包
   ```

3. **版本号建议**：
   - 修复 bug：使用 patch 版本
   - 新增功能：使用 minor 版本
   - 架构调整或不兼容更新：使用 major 版本

## ⚠️ 注意事项

1. 更新前请确保已提交所有代码更改
2. 重要更新前建议手动备份整个项目
3. 定期清理旧的备份目录以节省空间
4. 发布前务必充分测试

## 🤝 贡献

如果您发现脚本有问题或有改进建议，欢迎提出 Issue 或 PR。