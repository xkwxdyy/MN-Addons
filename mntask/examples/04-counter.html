<!DOCTYPE html>
<html>
<head>
    <title>æˆ‘çš„è®¡æ•°å™¨</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        
        .counter-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        .number-display {
            font-size: 72px;
            font-weight: bold;
            color: #007aff;
            margin: 30px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        button {
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-add {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-add:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-subtract {
            background-color: #f44336;
            color: white;
        }
        
        .btn-subtract:hover {
            background-color: #da190b;
            transform: translateY(-2px);
        }
        
        .btn-reset {
            background-color: #ff9800;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #e68900;
            transform: translateY(-2px);
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 5px;
            color: #2e7d32;
            font-size: 14px;
            transition: background-color 0.5s;
        }
        
        /* å­¦ä¹ ç¬”è®°æ ·å¼ */
        .note {
            margin-top: 40px;
            padding: 20px;
            background-color: #fff9c4;
            border-radius: 10px;
            text-align: left;
            max-width: 500px;
            font-size: 14px;
            color: #666;
        }
        
        .note h3 {
            color: #f57c00;
            margin-top: 0;
        }
        
        .note code {
            background-color: #fff;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="counter-container">
        <h1>ğŸ”¢ è¶…çº§è®¡æ•°å™¨</h1>
        
        <div class="number-display" id="number">
            0
        </div>
        
        <div class="button-group">
            <button class="btn-subtract" onclick="subtract()">â– å‡ä¸€</button>
            <button class="btn-reset" onclick="reset()">ğŸ”„ é‡ç½®</button>
            <button class="btn-add" onclick="add()">â• åŠ ä¸€</button>
        </div>
        
        <div class="status" id="status">
            å‡†å¤‡å°±ç»ª
        </div>
        
        <div class="note">
            <h3>ğŸ“š å­¦ä¹ ç¬”è®°</h3>
            <p><strong>è¿™ä¸ªè®¡æ•°å™¨å±•ç¤ºäº†ï¼š</strong></p>
            <ul>
                <li>çŠ¶æ€ç®¡ç†ï¼šæ•°å­—ä¿å­˜åœ¨ <code>currentNumber</code> å˜é‡ä¸­</li>
                <li>UI æ›´æ–°ï¼šé€šè¿‡ <code>updateDisplay()</code> æ›´æ–°ç•Œé¢</li>
                <li>æ’ä»¶é€šä¿¡ï¼šé€šè¿‡ <code>sendCommand()</code> å‘é€å‘½ä»¤</li>
                <li>æ•°æ®æ¥æ”¶ï¼š<code>receiveData()</code> å¤„ç†æ’ä»¶è¿”å›çš„æ•°æ®</li>
            </ul>
            <p>ğŸ’¡ <strong>æç¤ºï¼š</strong>åœ¨æ§åˆ¶å°è¾“å…¥ <code>updateCounter(42)</code> å¯ä»¥æ¨¡æ‹Ÿæ’ä»¶æ›´æ–°æ•°å­—ï¼</p>
        </div>
    </div>
    
    <script>
        // =====================================
        // ğŸ¯ è®¡æ•°å™¨åº”ç”¨
        // 
        // è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è®¡æ•°å™¨ç¤ºä¾‹ï¼Œå±•ç¤ºäº†ï¼š
        // 1. å¦‚ä½•ç®¡ç†åº”ç”¨çŠ¶æ€
        // 2. å¦‚ä½•ä¸æ’ä»¶é€šä¿¡
        // 3. å¦‚ä½•æ›´æ–°ç”¨æˆ·ç•Œé¢
        // 4. å¦‚ä½•å¤„ç†ç”¨æˆ·äº¤äº’
        // =====================================
        
        // ==================== çŠ¶æ€ç®¡ç† ====================
        let currentNumber = 0;  // å½“å‰æ˜¾ç¤ºçš„æ•°å­—
        
        // ==================== æ˜¾ç¤ºæ›´æ–° ====================
        
        // æ›´æ–°æ•°å­—æ˜¾ç¤º
        function updateDisplay(number) {
            currentNumber = number;
            const display = document.getElementById('number');
            display.textContent = number;
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            display.style.transform = 'scale(1.2)';
            setTimeout(() => {
                display.style.transform = 'scale(1)';
            }, 200);
            
            // æ ¹æ®æ•°å­—æ”¹å˜é¢œè‰²
            if (number > 0) {
                display.style.color = '#4CAF50';  // æ­£æ•° - ç»¿è‰²
            } else if (number < 0) {
                display.style.color = '#f44336';  // è´Ÿæ•° - çº¢è‰²
            } else {
                display.style.color = '#007aff';  // é›¶ - è“è‰²
            }
        }
        
        // æ›´æ–°çŠ¶æ€ä¿¡æ¯
        function updateStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            
            // çŸ­æš‚é«˜äº®
            status.style.backgroundColor = '#ffeb3b';
            setTimeout(() => {
                status.style.backgroundColor = '#e8f5e9';
            }, 500);
        }
        
        // ==================== ä¸æ’ä»¶é€šä¿¡ ====================
        
        // å‘é€å‘½ä»¤åˆ°æ’ä»¶
        function sendCommand(command, value = null) {
            // æ„é€  URL
            let url = `mntask://counter/${command}`;
            if (value !== null) {
                url += `?value=${value}`;
            }
            
            // è®°å½•æ“ä½œ
            console.log('ğŸ“¤ å‘é€å‘½ä»¤:', url);
            updateStatus(`å‘é€å‘½ä»¤: ${command}`);
            
            // å‘é€
            window.location.href = url;
            
            // === ä»…ç”¨äºæ¼”ç¤º ===
            // åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œæ’ä»¶ä¼šå¤„ç†å‘½ä»¤å¹¶è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•°
            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿæ’ä»¶çš„å“åº”
            setTimeout(() => {
                simulatePluginResponse(command);
            }, 300);
        }
        
        // æ¥æ”¶æ’ä»¶çš„æ•°æ®
        function receiveData(data) {
            console.log('ğŸ“¥ æ”¶åˆ°æ•°æ®:', data);
            
            if (data.number !== undefined) {
                updateDisplay(data.number);
                updateStatus('æ•°æ®å·²æ›´æ–°');
            }
            
            if (data.message) {
                updateStatus(data.message);
            }
        }
        
        // ==================== æŒ‰é’®æ“ä½œ ====================
        
        // åŠ ä¸€
        function add() {
            console.log('ğŸ”¼ æ‰§è¡ŒåŠ ä¸€æ“ä½œ');
            sendCommand('add');
        }
        
        // å‡ä¸€
        function subtract() {
            console.log('ğŸ”½ æ‰§è¡Œå‡ä¸€æ“ä½œ');
            sendCommand('subtract');
        }
        
        // é‡ç½®
        function reset() {
            console.log('ğŸ”„ æ‰§è¡Œé‡ç½®æ“ä½œ');
            if (currentNumber !== 0 && confirm('ç¡®å®šè¦é‡ç½®ä¸º0å—ï¼Ÿ')) {
                sendCommand('reset');
            }
        }
        
        // ==================== æ¨¡æ‹Ÿæ’ä»¶å“åº” ====================
        // æ³¨æ„ï¼šè¿™éƒ¨åˆ†ä»£ç ä»…ç”¨äºæ¼”ç¤º
        // åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œæ’ä»¶ä¼šæ‰§è¡Œè¿™äº›æ“ä½œ
        
        function simulatePluginResponse(command) {
            let newNumber = currentNumber;
            let message = '';
            
            switch(command) {
                case 'add':
                    newNumber = currentNumber + 1;
                    message = 'åŠ ä¸€æˆåŠŸ';
                    break;
                case 'subtract':
                    newNumber = currentNumber - 1;
                    message = 'å‡ä¸€æˆåŠŸ';
                    break;
                case 'reset':
                    newNumber = 0;
                    message = 'å·²é‡ç½®ä¸ºé›¶';
                    break;
                case 'getData':
                    message = 'æ•°æ®å·²åŠ è½½';
                    break;
            }
            
            // æ¨¡æ‹Ÿæ’ä»¶è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•°
            updateCounter(newNumber);
            
            // æˆ–è€…ä½¿ç”¨å®Œæ•´æ•°æ®æ ¼å¼
            // setCounterData(JSON.stringify({
            //     number: newNumber,
            //     message: message
            // }));
        }
        
        // ==================== åˆå§‹åŒ– ====================
        
        // é¡µé¢åŠ è½½å®Œæˆå
        window.onload = function() {
            console.log('âœ… è®¡æ•°å™¨é¡µé¢åŠ è½½å®Œæˆ');
            updateStatus('æ­£åœ¨è¿æ¥æ’ä»¶...');
            
            // è¯·æ±‚åˆå§‹æ•°æ®
            setTimeout(() => {
                sendCommand('getData');
            }, 100);
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            console.log('=====================================');
            console.log('ğŸ‰ æ¬¢è¿ä½¿ç”¨è¶…çº§è®¡æ•°å™¨ï¼');
            console.log('ğŸ’¡ æç¤ºï¼š');
            console.log('1. ç‚¹å‡»æŒ‰é’®æ”¹å˜æ•°å­—');
            console.log('2. æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹é€šä¿¡æ—¥å¿—');
            console.log('3. è¾“å…¥ updateCounter(100) æµ‹è¯•æ›´æ–°');
            console.log('=====================================');
        };
        
        // ==================== æ’ä»¶ä¼šè°ƒç”¨çš„å‡½æ•° ====================
        
        // è¿™ä¸ªå‡½æ•°ä¼šè¢«æ’ä»¶è°ƒç”¨æ¥æ›´æ–°æ•°å­—
        window.updateCounter = function(number) {
            console.log('ğŸ”” æ’ä»¶è°ƒç”¨ updateCounter:', number);
            updateDisplay(number);
            updateStatus('è®¡æ•°å™¨å·²æ›´æ–°');
        };
        
        // è¿™ä¸ªå‡½æ•°ä¼šè¢«æ’ä»¶è°ƒç”¨æ¥å‘é€å®Œæ•´æ•°æ®
        window.setCounterData = function(jsonString) {
            console.log('ğŸ”” æ’ä»¶è°ƒç”¨ setCounterData:', jsonString);
            try {
                const data = JSON.parse(jsonString);
                receiveData(data);
            } catch (error) {
                console.error('âŒ è§£ææ•°æ®å¤±è´¥:', error);
                updateStatus('æ•°æ®æ ¼å¼é”™è¯¯');
            }
        };
        
        // =====================================
        // ğŸ“ å…³é”®æ¦‚å¿µè§£é‡Šï¼š
        // 
        // 1. çŠ¶æ€ç®¡ç†
        //    - currentNumber ä¿å­˜å½“å‰æ•°å­—
        //    - æ‰€æœ‰æ“ä½œéƒ½é€šè¿‡å‡½æ•°ä¿®æ”¹çŠ¶æ€
        //    - çŠ¶æ€æ”¹å˜åæ›´æ–°ç•Œé¢
        // 
        // 2. å‘½ä»¤æ¨¡å¼
        //    - æ¯ä¸ªæ“ä½œå¯¹åº”ä¸€ä¸ªå‘½ä»¤
        //    - å‘½ä»¤é€šè¿‡ URL Scheme å‘é€
        //    - æ’ä»¶å¤„ç†å‘½ä»¤å¹¶è¿”å›ç»“æœ
        // 
        // 3. åŒå‘é€šä¿¡
        //    - ç½‘é¡µ â†’ æ’ä»¶ï¼šURL Scheme
        //    - æ’ä»¶ â†’ ç½‘é¡µï¼šè°ƒç”¨å…¨å±€å‡½æ•°
        // 
        // 4. é”™è¯¯å¤„ç†
        //    - try-catch å¤„ç† JSON è§£æ
        //    - ç¡®è®¤å¯¹è¯æ¡†é˜²æ­¢è¯¯æ“ä½œ
        //    - çŠ¶æ€æ¶ˆæ¯æä¾›åé¦ˆ
        // =====================================
    </script>
</body>
</html>