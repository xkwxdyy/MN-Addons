<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>JsonEditor</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link href="jsoneditor.min.css" rel="stylesheet" type="text/css">
    <script src="jsoneditor.min.js"></script>
</head>
<style>
body {
    margin: 0;
    padding: 0;
    height: 100vh !important;
    min-height: 100vh !important;
    overflow-y: hidden;
}


</style>
<body>
  <div id="jsoneditor"></div>
  <script>
  // let actionNames = ['none','bigbang','addChildNote','addBrotherNote','addComment','addBlankComment','addTag','setTittle','addTitle','copy','copyAsImage','setExcerpt','appendExcerpt','markdown2Mindmap','openInEditor']
  let actionNames = ['none','menu','bigbang','addChildNote','addBrotherNote','addComment','addBlankComment','setTitle','addTitle','copy','setExcerpt','appendExcerpt','markdown2Mindmap','openInEditor','snipaste','snipasteText','snipasteHTML','searchInBrowser','reAsk','reAskWithMenu','openChat']
  function genSchema(properties,title="Action",description="") {
    return {
      "title": title,
      "description": description,
      "type": "object",
      "properties": properties
    }
  }
  function stringEnum(enums) {
    return {
      "title": "string",
      "type": "string",
      "enum": enums,
    }
  }
  function numberEnum(enums) {
    return {
      "title": "number",
      "type": "number",
      "enum": enums,
    }
  }
  function stringType() {
    return {
      "title": "string",
      "type": "string",
    }
  }
  function booleanType(defaultValue = false) {
    return {
      "title": "boolean",
      "type": "boolean",
      "default": defaultValue
    }
  }
  function arrayType(type) {
    if (type === undefined) {
      return {
        "title": "array",
        "type": "array"
      }
    }
    return {
      "title": "array",
      "type": "array",
      "items": type
    }
  }
  function objectType(properties) {
    return {
      "title": "object",
      "type": "object",
      "properties": properties
    }
  }
  function commentType() {
    return stringEnum(['TextNote','HtmlNote','PaintNote','LinkNote','tagComment','linkComment','markdownComment','textComment','HtmlComment','blankTextComment','blankImageComment','mergedImageCommentWithDrawing','mergedImageComment','mergedTextComment','imageCommentWithDrawing','imageComment','drawingComment'])
  }
    // create the editor
    const container = document.getElementById("jsoneditor")
    let actionEnum = stringEnum(actionNames)
    let actionProperties = {}
    actionProperties.button1 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button2 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button3 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button4 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button5 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button6 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button7 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(false)
    })
    actionProperties.button8 = objectType({
      "click":actionEnum,
      "longPress":actionEnum,
      "autoClose":booleanType(true)
    })
    const action = {
    "title": "Action",
    "description": "Object containing employee details",
    "type": "object",
    "properties": actionProperties
  }
    function adjustSelectWidth() {
        const selects = document.getElementsByTagName('select');
        for (let index = 0; index < selects.length; index++) {
          const select = selects[index];
          const maxWidth = window.innerWidth - select.getBoundingClientRect().left-30;
          select.style.maxWidth = `${maxWidth}px`;
        }
    }
 function moveDuplicateAndRemoveToFront(arr) {

    const removeIndex = arr.findIndex(item => item.className === 'jsoneditor-remove');

    if (removeIndex > -1) {
        // Extract the element
        const [removeItem] = arr.splice(removeIndex, 1);
        // Move the element to the front
        arr.unshift(removeItem);
    }

    const extractIndex = arr.findIndex(item => item.className === "jsoneditor-extract");
    if (extractIndex > -1) {
        const [extractItem] = arr.splice(extractIndex, 1);
        // Move the element to the front
        arr.push(extractItem);
    }

    return arr;
}
function copyToClipboard(text) {
  window.location.href = "nativeCopy://content="+encodeURIComponent(text);
}
function setSchema(schema) {
  if (schema === undefined) {
      editor.setSchema(action,{action:action})
  }else{
    editor.setSchema(schema,{action:action})
  }
}
    const options = {
      schema: action,
      schemaRefs: {action:action},
      theme: 'ace',
      allowSchemaSuggestions: true,
      onEditable:(node)=> {
        if (node.field === "click" || node.field === "longPress" || node.field === "autoClose") {
          return {field: false, value: true}
        }
        
        return false
      },
      onEvent:(node, event)=> {
          console.log(event);
        if (event.type === 'mouseout' && event.srcElement.tagName === 'SELECT') {
          // console.log(event.srcElement.tagName);
          event.srcElement.blur()
        }

      },
      "enableSort": false,
      "enableTransform": false,
      "search": false,
      "mode":"tree",
      limitDragging:false,
      "navigationBar":false,
      "colorPicker":false,
        }

    const editor = new JSONEditor(container, options)

        // set json
        const initialJson = {
    "button1":{
      "click":"bigbang",
      "longPress":"none",
      "autoClose":false
    },
    "button2":{
      "click":"addComment",
      "longPress":"addBlankComment",
      "autoClose":false
    },
    "button3":{
      "click":"setTitle",
      "longPress":"none",
      "autoClose":false
    },
    "button4":{
      "click":"copy",
      "longPress":"none",
      "autoClose":false
    },
    "button5":{
      "click":"setExcerpt",
      "longPress":"appendExcerpt",
      "autoClose":false
    },
    "button6":{
      "click":"addChildNote",
      "longPress":"markdown2Mindmap",
      "autoClose":false
    }
  }

        editor.set(initialJson)
        // get json
      const updatedJson = editor.get()
      function updateContent(data) {
        let tem = JSON.parse(decodeURIComponent(data))
        // MNUtil.copy(tem)
        editor.update(tem)
        setTimeout(() => {
          editor.expandAll()
        }, 100);
      }
      function setContent(data) {
        let tem = JSON.parse(decodeURIComponent(data))
        // MNUtil.copy(tem)
        editor.set(tem)
        editor.expandAll()
        adjustSelectWidth()
      }
      function updateContent(data) {
        let tem = JSON.parse(decodeURIComponent(data))
        // MNUtil.copy(tem)
        editor.update(tem)
        editor.expandAll()
        adjustSelectWidth()
      }
      function getContent() {
        let tem = JSON.stringify(editor.get(),null,2)
        removeFocus()
        return encodeURIComponent(tem)
      }
      function removeFocus() {
        document.activeElement.blur(); // 先尝试失去当前焦点
        // document.body.focus(); // 将焦点设置到 body
      }
      window.addEventListener('resize', adjustSelectWidth);
    </script>
</body>
</html>