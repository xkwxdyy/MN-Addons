{
  "currentState": "memory_saved",
  "stateHistory": [
    {
      "from": "initial",
      "command": "init",
      "timestamp": "2025-06-26T15:48:11.309Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/mntoolbar"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "remember",
      "timestamp": "2025-06-26T15:52:01.624Z",
      "args": [
        "# MN Toolbar Pro é¡¹ç›®å®Œæ•´åˆ†æ\n\n## é¡¹ç›®æ¦‚è¿°\n- **é¡¹ç›®åç§°**: MN Toolbar Pro\n- **åŸºç¡€**: åŸºäºæ—ç«‹é£å¼€å‘çš„ MN Toolbar æ’ä»¶\n- **ç‰ˆæœ¬**: 0.1.3.alpha0427\n- **æ’ä»¶ID**: marginnote.extension.mntoolbar\n- **æ”¯æŒç‰ˆæœ¬**: MarginNote 3.7.11+\n- **å¹³å°**: iOS/iPadOS/macOS\n\n## é¡¹ç›®ç»“æ„\n\n### æ ¸å¿ƒæ–‡ä»¶\n1. **main.js** (1021è¡Œ)\n   - æ’ä»¶ä¸»å…¥å£æ–‡ä»¶\n   - å®šä¹‰ MNToolbarClass ç»§æ‰¿è‡ª JSExtension\n   - ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸ (sceneWillConnect, notebookWillOpenç­‰)\n   - å¤„ç†å„ç§é€šçŸ¥äº‹ä»¶ (PopupMenuOnNote, toggleDynamicç­‰)\n   - åŠ¨æ€å·¥å…·æ çš„æ˜¾ç¤º/éšè—é€»è¾‘\n\n2. **webviewController.js** (3700+è¡Œ)\n   - å·¥å…·æ UIæ§åˆ¶å™¨ (toolbarController)\n   - å¤„ç†æŒ‰é’®å¸ƒå±€ (æ°´å¹³/å‚ç›´)\n   - æ‰‹åŠ¿è¯†åˆ« (æ‹–åŠ¨ã€è°ƒæ•´å¤§å°ã€é•¿æŒ‰)\n   - è‡ªå®šä¹‰åŠ¨ä½œæ‰§è¡Œå™¨ (customActionByDes)\n   - æ”¯æŒæœ€å¤š30ä¸ªæŒ‰é’®\n\n3. **utils.js** (10068è¡Œ)\n   - Frameç±»: UIæ¡†æ¶æ“ä½œå·¥å…·\n   - toolbarUtilsç±»: æ ¸å¿ƒå·¥å…·å‡½æ•°é›†åˆ\n   - åŒ…å«å¤§é‡åŠŸèƒ½æ¨¡å—:\n     - æ–‡æœ¬å¤„ç† (markdownè½¬æ¢ã€OCRã€å¤åˆ¶ç²˜è´´)\n     - å¡ç‰‡æ“ä½œ (åˆ¶å¡ã€åˆå¹¶ã€é“¾æ¥ç®¡ç†)\n     - ä»»åŠ¡ç®¡ç† (OKRç³»ç»Ÿ)\n     - æ–‡çŒ®ç®¡ç† (å‚è€ƒæ–‡çŒ®ã€ä½œè€…ã€æœŸåˆŠ)\n     - æ¨¡æ¿ç³»ç»Ÿ\n\n4. **settingController.js**\n   - è®¾ç½®ç•Œé¢ç®¡ç†\n   - æŒ‰é’®é…ç½®ç¼–è¾‘å™¨\n   - iCloudåŒæ­¥è®¾ç½®\n\n### é…ç½®æ–‡ä»¶\n- **toolbar_config.json**: å·¥å…·æ é…ç½®å­˜å‚¨\n  - windowState: çª—å£çŠ¶æ€å’Œä½ç½®\n  - actionKeys: å›ºå®šå·¥å…·æ æŒ‰é’®é…ç½®\n  - dynamicActionKeys: åŠ¨æ€å·¥å…·æ æŒ‰é’®é…ç½®\n  - actions: æ‰€æœ‰å¯ç”¨åŠ¨ä½œçš„å®šä¹‰\n  - popupConfig: å¼¹å‡ºèœå•æ›¿æ¢é…ç½®\n\n## ä¸»è¦åŠŸèƒ½æ¨¡å—\n\n### 1. åŠ¨æ€å·¥å…·æ ç³»ç»Ÿ\n- æ”¯æŒæ°´å¹³/å‚ç›´å¸ƒå±€åˆ‡æ¢\n- å¯æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ˜¾ç¤º/éšè—\n- æ”¯æŒæ‹–åŠ¨å’Œè°ƒæ•´å¤§å°\n- æœ€å¤šæ”¯æŒ30ä¸ªæŒ‰é’®\n\n### 2. å¡ç‰‡æ“ä½œåŠŸèƒ½\n- **åˆ¶å¡ç³»ç»Ÿ**:\n  - æ¨¡æ¿åˆ¶å¡ (TemplateMakeNotes)\n  - æ‰¹é‡åˆ¶å¡\n  - æ–‡çŒ®åˆ¶å¡ (è®ºæ–‡ã€ä¹¦ç±ã€æœŸåˆŠ)\n  - OKRä»»åŠ¡å¡ç‰‡ (ç›®æ ‡ã€å…³é”®ç»“æœã€é¡¹ç›®ã€ä»»åŠ¡)\n  \n- **å¡ç‰‡ç®¡ç†**:\n  - åˆå¹¶åˆ°çˆ¶å¡ç‰‡\n  - é“¾æ¥ç®¡ç† (å•å‘/åŒå‘)\n  - é¢œè‰²æ ‡è®° (16ç§é¢œè‰²)\n  - æ ‡é¢˜å‰ç¼€ç®¡ç†\n\n### 3. å­¦ä¹ è¾…åŠ©åŠŸèƒ½\n- **è¯æ˜ç®¡ç†**: æ·»åŠ ã€æ›´æ–°ã€ç§»åŠ¨è¯æ˜å†…å®¹\n- **æ€è€ƒç‚¹ç³»ç»Ÿ**: æ·»åŠ æ€è€ƒç‚¹ã€ç§»åŠ¨è¯„è®ºåˆ°æ€è€ƒåŒº\n- **è¯„è®ºç®¡ç†**: HTML/Markdownè¯„è®ºã€è¯„è®ºåˆ†çº§\n- **å¼•ç”¨ç®¡ç†**: æ–‡çŒ®å¼•ç”¨ã€ä½œè€…ä¿¡æ¯ã€æœŸåˆŠä¿¡æ¯\n\n### 4. æ–‡æœ¬å¤„ç†åŠŸèƒ½\n- OCRè¯†åˆ«\n- Markdown/HTMLè½¬æ¢\n- æ ‡é¢˜æ ¼å¼åŒ–\n- ç©ºæ ¼å¤„ç†\n- å¤åˆ¶/ç²˜è´´å¢å¼º\n\n### 5. é›†æˆåŠŸèƒ½\n- MN Editor: å¡ç‰‡ç¼–è¾‘å™¨\n- MN Browser: å†…ç½®æµè§ˆå™¨\n- MN OCR: æ–‡å­—è¯†åˆ«\n- MN ChatAI: AIå¯¹è¯\n- MN Snipaste: æˆªå›¾å·¥å…·\n- Bigbang: æ–‡æœ¬å¤„ç†\n\n## æŠ€æœ¯ç‰¹ç‚¹\n\n### JSBridgeæ¶æ„\n- ä½¿ç”¨ JSB.defineClass å®šä¹‰åŸç”Ÿç±»\n- é€šè¿‡ JSB.require åŠ è½½æ¨¡å—\n- æ”¯æŒåŸç”ŸUIç»„ä»¶ (UIButton, UIViewç­‰)\n\n### è®¾è®¡æ¨¡å¼\n- **å•ä¾‹æ¨¡å¼**: é€šè¿‡ getFooController() è·å–å®ä¾‹\n- **è§‚å¯Ÿè€…æ¨¡å¼**: NSNotificationCenter é€šçŸ¥æœºåˆ¶\n- **å‘½ä»¤æ¨¡å¼**: åŠ¨ä½œé…ç½®ç³»ç»Ÿ\n\n### å†…å­˜ç®¡ç†\n- åœ¨ sceneDidDisconnect/notebookWillClose ä¸­æ¸…ç†èµ„æº\n- ç§»é™¤é€šçŸ¥è§‚å¯Ÿè€…\n- æ¸…ç†å®šæ—¶å™¨å’Œæ‰‹åŠ¿è¯†åˆ«å™¨\n\n### å¹³å°å…¼å®¹\n- æ£€æµ‹å¹³å°ç±»å‹ (iOS/macOS)\n- å¤„ç†å¹³å°å·®å¼‚ (é¼ æ ‡/è§¦æ‘¸)\n- é€‚é…ä¸åŒå±å¹•å°ºå¯¸\n\n## è‡ªå®šä¹‰åŠ¨ä½œç³»ç»Ÿ\n\n### åŠ¨ä½œç±»å‹\n1. **åŸºç¡€åŠ¨ä½œ**: copy, paste, undo, redo\n2. **å¡ç‰‡åŠ¨ä½œ**: åˆ¶å¡ã€åˆå¹¶ã€é“¾æ¥\n3. **æ–‡æœ¬åŠ¨ä½œ**: OCRã€æ ¼å¼åŒ–ã€ç¿»è¯‘\n4. **å­¦ä¹ åŠ¨ä½œ**: è¯æ˜ã€æ€è€ƒç‚¹ã€è¯„è®º\n5. **å·¥å…·åŠ¨ä½œ**: æœç´¢ã€ç¼–è¾‘å™¨ã€æµè§ˆå™¨\n\n### åŠ¨ä½œé…ç½®ç»“æ„\n```json\n{\n  \"action\": \"åŠ¨ä½œåç§°\",\n  \"target\": \"ç›®æ ‡\",\n  \"menuItems\": [], // å­èœå•\n  \"doubleClick\": {}, // åŒå‡»åŠ¨ä½œ\n  \"onLongPress\": {} // é•¿æŒ‰åŠ¨ä½œ\n}\n```\n\n## ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ (OKR)\n\n### å¡ç‰‡ç±»å‹\n- **ç›®æ ‡** (Objective): é»„è‰²\n- **å…³é”®ç»“æœ** (Key Result): æ·¡é»„è‰²/ç™½è‰²\n- **é¡¹ç›®** (Project): è“è‰²/æ·±è“è‰²\n- **ä»»åŠ¡** (Task): æ·¡è“è‰²/æ·¡ç²‰è‰²/ç°è‰²\n\n### çŠ¶æ€ç®¡ç†\n- æœªå¼€å§‹\n- è¿›è¡Œä¸­ (å¸¦æ—¶é—´æ ‡ç­¾)\n- å·²å®Œæˆ (ç°è‰²)\n\n### ç‰¹æ®ŠåŠŸèƒ½\n- è‡ªåŠ¨æ·»åŠ æ—¶é—´æ ‡ç­¾\n- çˆ¶å­å¡ç‰‡é“¾æ¥\n- çŠ¶æ€é¢œè‰²è‡ªåŠ¨åˆ‡æ¢\n- æ ‡é¢˜å‰ç¼€ç®¡ç†\n\n## æ–‡çŒ®ç®¡ç†ç³»ç»Ÿ\n\n### åŠŸèƒ½æ¨¡å—\n1. **å‚è€ƒæ–‡çŒ®IDç®¡ç†**\n   - ç»‘å®šæ–‡çŒ®IDåˆ°æ–‡æ¡£\n   - å¯¼å…¥/å¯¼å‡ºIDæ˜ å°„\n   - æ‰¹é‡å¤„ç†å¼•ç”¨\n\n2. **æ–‡çŒ®å¡ç‰‡ç±»å‹**\n   - è®ºæ–‡å¡ç‰‡\n   - ä¹¦ç±å¡ç‰‡\n   - æœŸåˆŠå¡ç‰‡\n   - ä½œè€…å¡ç‰‡\n   - å…³é”®è¯å¡ç‰‡\n\n3. **ä¿¡æ¯ç®¡ç†**\n   - BibTeXä¿¡æ¯\n   - DOIç®¡ç†\n   - å¼•ç”¨æ ·å¼\n   - ä½œè€…ç¼©å†™\n\n## é…ç½®ä¸æ‰©å±•\n\n### æŒ‰é’®é…ç½®\n- 36ä¸ªè‡ªå®šä¹‰æŒ‰é’®ä½ç½®\n- æ¯ä¸ªæŒ‰é’®å¯é…ç½®:\n  - å›¾æ ‡\n  - åŠ¨ä½œ\n  - åŒå‡»è¡Œä¸º\n  - é•¿æŒ‰èœå•\n\n### å¼¹çª—æ›¿æ¢\n- å¯æ›¿æ¢MarginNoteåŸç”Ÿå¼¹çª—\n- æ”¯æŒè‡ªå®šä¹‰èœå•é¡¹\n- ä¿æŒåŸæœ‰åŠŸèƒ½\n\n### iCloudåŒæ­¥\n- é…ç½®æ–‡ä»¶åŒæ­¥\n- å†²çªæ£€æµ‹\n- æ‰‹åŠ¨/è‡ªåŠ¨åŒæ­¥\n\n## å¼€å‘è§„èŒƒ\n\n### å‘½åè§„èŒƒ\n- ç±»: PascalCase\n- å‡½æ•°/å˜é‡: camelCase\n- å¸¸é‡: UPPER_CASE\n- æ–‡ä»¶: camelCase.js\n\n### é”™è¯¯å¤„ç†\n- try-catchåŒ…è£…ä¸»è¦æ–¹æ³•\n- é”™è¯¯æ—¥å¿—: toolbarUtils.addErrorLog()\n- ç”¨æˆ·æç¤º: MNUtil.showHUD()\n\n### ç”Ÿå‘½å‘¨æœŸç®¡ç†\n1. åˆå§‹åŒ–: sceneWillConnect\n2. ç¬”è®°æœ¬æ‰“å¼€: notebookWillOpen\n3. ç¬”è®°æœ¬å…³é—­: notebookWillClose\n4. æ–­å¼€è¿æ¥: sceneDidDisconnect\n\n### æ€§èƒ½ä¼˜åŒ–\n- å»¶è¿ŸåŠ è½½\n- æ‰¹é‡æ“ä½œä½¿ç”¨undoGrouping\n- å¤§æ–‡ä»¶åˆ†æ®µå¤„ç†\n- åŠ¨ç”»ä¼˜åŒ–\n\n## é¡¹ç›®ç‰¹è‰²\n\n1. **é«˜åº¦å¯å®šåˆ¶**: å‡ ä¹æ‰€æœ‰åŠŸèƒ½éƒ½å¯è‡ªå®šä¹‰\n2. **å¼ºå¤§çš„å¡ç‰‡ç³»ç»Ÿ**: æ”¯æŒå¤æ‚çš„çŸ¥è¯†ç®¡ç†å·¥ä½œæµ\n3. **ä¸“ä¸šçš„å­¦ä¹ å·¥å…·**: é’ˆå¯¹å­¦æœ¯ç ”ç©¶ä¼˜åŒ–\n4. **è‰¯å¥½çš„æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½\n5. **è·¨å¹³å°å…¼å®¹**: åŒæ—¶æ”¯æŒiOSå’ŒmacOS\n\n## å¾…å®ç°åŠŸèƒ½ (TODO)\n- æ‰¾åˆ°é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œå®ç°ä¸¤ä¸ª toolbar å…±å­˜",
        "--tags",
        "MN-Toolbar-Pro MarginNote æ’ä»¶å¼€å‘ çŸ¥è¯†ç®¡ç† å­¦ä¹ å·¥å…·"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-26T18:54:36.666Z",
      "args": [
        "MN Toolbar Pro é¡¹ç›® - æˆåŠŸå®ç°è‡ªå®šä¹‰ Actions è§£è€¦ï¼ˆ2025.6.27ï¼‰\n\n## ä»»åŠ¡èƒŒæ™¯\nç”¨æˆ·åœ¨ webviewController.js çš„ customActionByDes æ–¹æ³•ä¸­æ·»åŠ äº† 198 ä¸ªè‡ªå®šä¹‰ caseï¼Œå¯¼è‡´æ–‡ä»¶è¿‡å¤§ï¼ˆ264KBï¼‰ï¼Œéœ€è¦è§£è€¦ã€‚\n\n## å¤±è´¥çš„å°è¯•\n1. Prototype è¦†ç›–æ–¹å¼ï¼šå°è¯•é€šè¿‡ toolbarController.prototype.customActionByDes è¦†ç›–æ–¹æ³•ï¼Œä½† JSB æ¡†æ¶é™åˆ¶å¯¼è‡´å¤±è´¥\n2. é”™è¯¯é—®é¢˜ï¼š\n   - undefined is not an object (evaluating 'self.addonController.popupReplace') - é€šè¿‡æ·»åŠ  self.ensureView() è§£å†³\n   - ReferenceError: Can't find variable: toolbarController - å°è¯•äº†å»¶è¿Ÿåˆå§‹åŒ–ç­‰å¤šç§æ–¹æ¡ˆéƒ½å¤±è´¥\n\n## æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ - æ³¨å†Œè¡¨æ¨¡å¼\n1. æœ€å°åŒ–ä¿®æ”¹ä¸»æ–‡ä»¶ï¼ˆä»…åœ¨ default åˆ†æ”¯æ·»åŠ  4 è¡Œä»£ç ï¼‰\n2. åˆ›å»ºå…¨å±€æ³¨å†Œè¡¨å­˜å‚¨è‡ªå®šä¹‰ actions\n3. å®ç°äº†çœŸæ­£çš„è§£è€¦ï¼Œæ‰€æœ‰è‡ªå®šä¹‰ä»£ç åœ¨ç‹¬ç«‹æ–‡ä»¶ä¸­ç®¡ç†\n\n## æŠ€æœ¯è¦ç‚¹\n1. JSB æ¡†æ¶ä¸­ä¸èƒ½åœ¨å‡½æ•°å†…ä½¿ç”¨ break è¯­å¥ï¼Œéœ€è¦ç§»é™¤\n2. å¤æ‚çš„ switch è¯­å¥ï¼ˆå¦‚ TemplateMakeNotes 150+ è¡Œï¼‰éœ€è¦ç®€åŒ–å¤„ç†\n3. ä½¿ç”¨ Python è„šæœ¬è‡ªåŠ¨åŒ–è¿ç§»è¿‡ç¨‹\n4. åˆ›å»ºå¤šä¸ªç‰ˆæœ¬ï¼ˆåŸºç¡€ç‰ˆã€ç²¾é€‰ç‰ˆã€å®Œæ•´ç‰ˆï¼‰ä¾¿äºæµ‹è¯•\n\n## æˆæœ\n- æˆåŠŸè¿ç§» 198 ä¸ªè‡ªå®šä¹‰ actions\n- ä¸»æ–‡ä»¶ä» 264KB å‡å°‘åˆ° 95KBï¼ˆå‡å°‘ 64%ï¼‰\n- ä¿æŒå‘åå…¼å®¹æ€§\n- æ˜“äºç»´æŠ¤å’Œæ‰©å±•\n\n## æ–‡ä»¶åˆ—è¡¨\n- xdyy_custom_actions_registry_full.js - å®Œæ•´ç‰ˆï¼ˆ198ä¸ªactionsï¼‰\n- xdyy_custom_actions_registry_complete.js - ç²¾é€‰ç‰ˆï¼ˆ30ä¸ªactionsï¼‰\n- xdyy_custom_actions_registry.js - åŸºç¡€ç‰ˆï¼ˆ5ä¸ªactionsï¼‰\n- convert_to_registry.py - è‡ªåŠ¨è½¬æ¢è„šæœ¬",
        "--tags",
        "MNToolbar JSB è§£è€¦ æ³¨å†Œè¡¨æ¨¡å¼ MarginNote æ’ä»¶å¼€å‘"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-27T04:57:45.390Z",
      "args": [
        "MN Toolbar Pro - è‡ªå®šä¹‰ Actions è§£è€¦å®Œæ•´ç»éªŒæ€»ç»“ï¼ˆ2025.6.27ï¼‰\n\n## é¡¹ç›®èƒŒæ™¯\nç”¨æˆ·åœ¨ webviewController.js ä¸­æ·»åŠ äº† 198 ä¸ªè‡ªå®šä¹‰ caseï¼Œå¯¼è‡´æ–‡ä»¶è¿‡å¤§ï¼ˆ264KBï¼‰ï¼Œéœ€è¦è§£è€¦å¹¶æ”¹å–„ä»£ç ç»„ç»‡ã€‚\n\n## è§£å†³æ–¹æ¡ˆæ¼”è¿›\n\n### å¤±è´¥çš„å°è¯•\n1. **Prototype è¦†ç›–æ–¹å¼**\n   - å°è¯•ï¼štoolbarController.prototype.customActionByDes = function() \n   - å¤±è´¥åŸå› ï¼šJSB æ¡†æ¶é™åˆ¶ï¼Œprototype ä¿®æ”¹ä¸ç”Ÿæ•ˆ\n   - è¡¨ç°ï¼šè‡ªå®šä¹‰ actions è¿›å…¥ default åˆ†æ”¯æ˜¾ç¤º \"Not supported yet...\"\n\n2. **é”™è¯¯å¤„ç†ç»éªŒ**\n   - undefined is not an object (evaluating 'self.addonController.popupReplace')\n   - è§£å†³ï¼šæ·»åŠ  self.ensureView() ç¡®ä¿åˆå§‹åŒ–\n   - ReferenceError: Can't find variable: toolbarController\n   - å¤šç§å°è¯•å‡å¤±è´¥ï¼Œæœ€ç»ˆæ”¾å¼ƒ prototype æ–¹å¼\n\n### æˆåŠŸçš„æ³¨å†Œè¡¨æ¨¡å¼\n1. **æ¶æ„è®¾è®¡**\n   ```javascript\n   // å…¨å±€æ³¨å†Œè¡¨\n   global.customActions = {};\n   \n   // æ³¨å†Œå‡½æ•°\n   global.registerCustomAction = function(name, handler) {\n     global.customActions[name] = handler;\n   };\n   \n   // ä¸»æ–‡ä»¶ä»…ä¿®æ”¹ default åˆ†æ”¯\n   default:\n     if (typeof global !== 'undefined' && global.executeCustomAction) {\n       const handled = await global.executeCustomAction(des.action, context);\n       if (handled) break;\n     }\n   ```\n\n2. **Context æœºåˆ¶**\n   - åŸå› ï¼šç‹¬ç«‹å‡½æ•°æ— æ³•è®¿é—®åŸå‡½æ•°ä½œç”¨åŸŸå˜é‡\n   - è§£å†³ï¼šæ‰“åŒ…æ‰€æœ‰éœ€è¦çš„å˜é‡ä¼ é€’\n   - åŒ…å«ï¼šbutton, des, focusNote, focusNotes, self\n\n## æŠ€æœ¯è¦ç‚¹\n\n### JSB æ¡†æ¶é™åˆ¶\n1. å‡½æ•°å†…ä¸èƒ½ä½¿ç”¨ break è¯­å¥\n2. å¤æ‚ switch è¯­å¥éœ€è¦ç®€åŒ–å¤„ç†\n3. æ–¹æ³•è°ƒç”¨å¯èƒ½ä¸é€šè¿‡æ ‡å‡†åŸå‹é“¾\n4. ç±»å®šä¹‰å’Œå®ä¾‹åŒ–æ—¶æœºéš¾ä»¥æ§åˆ¶\n\n### æ‰¹é‡è¿ç§»å·¥å…·\n1. **Python è„šæœ¬ (convert_to_registry.py)**\n   - è‡ªåŠ¨æå– 198 ä¸ª cases\n   - ç§»é™¤ break è¯­å¥\n   - å¤„ç†ç‰¹æ®Šçš„ switch è¯­å¥\n   - æŒ‰åŠŸèƒ½åˆ†ç»„ï¼ˆreferenceã€moveã€proof ç­‰ï¼‰\n\n2. **ç‰¹æ®Šå¤„ç†çš„å¤æ‚ Actions**\n   - TemplateMakeNotes (150+ è¡Œ)\n   - addHtmlMarkdownComment\n   - mergeInParentNoteWithPopup\n   - è¿™äº›è¢«ç®€åŒ–ä¸ºæ ¸å¿ƒåŠŸèƒ½ç‰ˆæœ¬\n\n### ä»£ç æ ¼å¼åŒ–\n1. **ç¼©è¿›é—®é¢˜**\n   - Python è„šæœ¬ç”Ÿæˆçš„ä»£ç ç¼©è¿›ä¸è§„èŒƒ\n   - åˆ›å»º fix_indentation.js ä¿®å¤ç¼©è¿›\n   - ç»Ÿä¸€ä½¿ç”¨ 2 ç©ºæ ¼ç¼©è¿›\n\n2. **è¯­æ³•éªŒè¯**\n   - ä½¿ç”¨ node -c filename.js æ£€æŸ¥è¯­æ³•\n   - åˆ†é˜¶æ®µæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸\n\n## æ–‡ä»¶ç»„ç»‡ç­–ç•¥\n\n### ç‰ˆæœ¬ç®¡ç†\n1. åŸºç¡€ç‰ˆ (5ä¸ª actions) - ç”¨äºæµ‹è¯•\n2. ç²¾é€‰ç‰ˆ (30ä¸ª actions) - å¸¸ç”¨åŠŸèƒ½\n3. å®Œæ•´ç‰ˆ (198ä¸ª actions) - æ‰€æœ‰åŠŸèƒ½\n\n### æ–‡æ¡£é›†ä¸­åŒ–\n1. åˆ é™¤ä¸­é—´æ–‡æ¡£ï¼ˆ6ä¸ª md æ–‡ä»¶ï¼‰\n2. æ‰€æœ‰ç»éªŒé›†ä¸­åˆ° CLAUDE.md\n3. ä¿ç•™æ ¸å¿ƒæ–‡ä»¶ï¼š\n   - xdyy_custom_actions_registry.js\n   - convert_to_registry.py\n   - xdyy_utils_extensions.js\n\n## æˆæœæ•°æ®\n- ä¸»æ–‡ä»¶ï¼š264KB â†’ 95KBï¼ˆå‡å°‘ 64%ï¼‰\n- ä»£ç è¡Œæ•°ï¼š6555 â†’ 2599ï¼ˆå‡å°‘ 60%ï¼‰\n- ä¸»æ–‡ä»¶ä¿®æ”¹ï¼šä»… 4 è¡Œ\n- æˆåŠŸè¿ç§»ï¼š198 ä¸ª actions\n\n## æœ€ä½³å®è·µæ€»ç»“\n\n### å¼€å‘æµç¨‹\n1. åœ¨æ³¨å†Œè¡¨æ–‡ä»¶ä¸­æ·»åŠ æ–° action\n2. ç‰¹æ®Šå˜é‡åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰\n3. å…±äº«å¸¸é‡åœ¨ registerAllCustomActions é¡¶éƒ¨å®šä¹‰\n4. ä½¿ç”¨ MNUtil.undoGrouping åŒ…è£…æ‰¹é‡æ“ä½œ\n5. å§‹ç»ˆåŒ…å« try-catch é”™è¯¯å¤„ç†\n\n### è°ƒè¯•æŠ€å·§\n1. å¯åŠ¨æ—¶æŸ¥çœ‹åŠ è½½æç¤º\n2. ä½¿ç”¨ MNUtil.showHUD æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯\n3. æ£€æŸ¥ Console é”™è¯¯ä¿¡æ¯\n4. éªŒè¯ context å˜é‡æ˜¯å¦æ­£ç¡®ä¼ é€’\n\n### MarginNote API å¸¸ç”¨æ–¹æ³•\n- MNNote.getFocusNote() - è·å–å½“å‰å¡ç‰‡\n- MNUtil.undoGrouping() - æ‰¹é‡æ“ä½œ\n- MNUtil.showHUD() - æ˜¾ç¤ºæç¤º\n- UIAlertView.show... - å¼¹çª—äº¤äº’\n- focusNote.moveToInput() - ç§»åŠ¨å¡ç‰‡\n\n## ç»éªŒæ•™è®­\n1. JSB æ¡†æ¶æœ‰ç‹¬ç‰¹é™åˆ¶ï¼Œæ ‡å‡† JS æ¨¡å¼å¯èƒ½ä¸é€‚ç”¨\n2. æ³¨å†Œè¡¨æ¨¡å¼æ¯” prototype è¦†ç›–æ›´å¯é \n3. æ¸è¿›å¼æµ‹è¯•æ¯”ä¸€æ¬¡æ€§è¿ç§»æ›´å®‰å…¨\n4. è‰¯å¥½çš„é”™è¯¯å¤„ç†è‡³å…³é‡è¦\n5. æ–‡æ¡£é›†ä¸­ç®¡ç†ä¾¿äºç»´æŠ¤",
        "--tags",
        "MNToolbar MarginNote JSB ä»£ç è§£è€¦ æ³¨å†Œè¡¨æ¨¡å¼ JavaScript æ’ä»¶å¼€å‘"
      ]
    },
    {
      "from": "memory_saved",
      "command": "init",
      "timestamp": "2025-06-27T06:17:44.224Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/mntoolbar"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "remember",
      "timestamp": "2025-06-27T07:06:21.058Z",
      "args": [
        "MN Toolbar Pro æ³¨å†Œè¡¨è§£è€¦å®è·µç»éªŒï¼š\n\n1. è§£è€¦æ¶æ„ï¼š\n   - ä¸»æ–‡ä»¶ï¼ˆwebviewController.jsï¼‰åªéœ€æ·»åŠ  4 è¡Œä»£ç çš„é’©å­\n   - æ‰€æœ‰è‡ªå®šä¹‰åŠŸèƒ½åœ¨ç‹¬ç«‹çš„æ³¨å†Œè¡¨æ–‡ä»¶ï¼ˆxdyy_custom_actions_registry.jsï¼‰ä¸­ç®¡ç†\n   - é€šè¿‡ global å¯¹è±¡å®ç°æ¨¡å—é—´é€šä¿¡\n\n2. å…³é”®é—®é¢˜ä¸è§£å†³ï¼š\n   - å˜é‡æœªå®šä¹‰ï¼šåœ¨ customActionByDes å‡½æ•°ä¸­éœ€è¦åŒæ—¶å£°æ˜ focusNote å’Œ focusNotes\n   - å‡½æ•°æœªå®šä¹‰ï¼šç¡®ä¿åœ¨ main.js ä¸­æŒ‰æ­£ç¡®é¡ºåºåŠ è½½æ‰€æœ‰ä¾èµ–æ–‡ä»¶\n   - æ‰©å±•åˆå§‹åŒ–ï¼šåœ¨æ‰©å±•æ–‡ä»¶æœ«å°¾æ·»åŠ è‡ªåŠ¨åˆå§‹åŒ–ä»£ç \n\n3. è°ƒè¯•æŠ€å·§ï¼š\n   - ä½¿ç”¨ MNUtil.log() è€Œä¸æ˜¯ console.log()\n   - æ¸è¿›å¼è°ƒè¯•ï¼šå…ˆç¡®è®¤æ–‡ä»¶åŠ è½½â†’å†ç¡®è®¤å¯¹è±¡å­˜åœ¨â†’æœ€åç¡®è®¤åŠŸèƒ½æ‰§è¡Œ\n   - ä½¿ç”¨æœ‰æ„ä¹‰çš„æ—¥å¿—å‰ç¼€ï¼ˆğŸ”§åˆå§‹åŒ–ã€âœ…æˆåŠŸã€âŒé”™è¯¯ã€ğŸ”è°ƒè¯•ã€ğŸš€æ‰§è¡Œã€ğŸ“¦åŠ è½½ï¼‰\n\n4. æœ€ä½³å®è·µï¼š\n   - ä¸»æ–‡ä»¶ä¿®æ”¹æœ€å°åŒ–\n   - ä½¿ç”¨ typeof æ£€æŸ¥å¯¹è±¡å­˜åœ¨æ€§\n   - é”™è¯¯å¤„ç†ä½¿ç”¨ try-catch\n   - é€šè¿‡ context å¯¹è±¡ä¼ é€’æ‰€æœ‰å¿…è¦æ•°æ®\n\n5. æˆæœï¼š\n   - æˆåŠŸæ³¨å†Œ 198 ä¸ªè‡ªå®šä¹‰ actions\n   - å®ç°äº†å®Œå…¨çš„æ¨¡å—åŒ–è§£è€¦\n   - æœªæ¥æ·»åŠ æ–°åŠŸèƒ½æ— éœ€ä¿®æ”¹ä¸»æ–‡ä»¶",
        "--tags",
        "MN-Toolbar è§£è€¦ æ³¨å†Œè¡¨æ¨¡å¼ JSBæ¡†æ¶"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-27T07:40:47.829Z",
      "args": [
        "MN Toolbar Pro æ›´æ–°è„šæœ¬é—®é¢˜å¤„ç†è®°å½•ï¼ˆ2025-06-27ï¼‰\n\n## é—®é¢˜èƒŒæ™¯\nç”¨æˆ·åœ¨ä½¿ç”¨ update.py æ›´æ–° MN Toolbar Pro æ—¶ï¼Œå‘ç°è„šæœ¬æ²¡æœ‰æ­£ç¡®æ¢å¤ç”¨æˆ·çš„è‡ªå®šä¹‰å†…å®¹ã€‚ä¸»è¦æ¶‰åŠçš„æ–‡ä»¶æ˜¯ utils.jsï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡ç”¨æˆ·è‡ªå®šä¹‰çš„èœå•æ¨¡æ¿å’ŒåŠŸèƒ½ã€‚\n\n## å·²è¯†åˆ«çš„ç”¨æˆ·è‡ªå®šä¹‰å†…å®¹\n1. **preprocess ç›¸å…³åŠŸèƒ½**ï¼š\n   - defaultWindowState ä¸­çš„ preprocess: false\n   - togglePreprocess() æ–¹æ³•\n   - ç›¸å…³çš„ UI æ›´æ–°é€»è¾‘\n\n2. **referenceIds ç›¸å…³åŠŸèƒ½**ï¼š\n   - toolbarConfig.referenceIds çš„åˆå§‹åŒ–\n   - save æ–¹æ³•ä¸­çš„ case \"MNToolbar_referenceIds\"\n   - ç›¸å…³çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½\n\n3. **å¤§é‡çš„èœå•æ¨¡æ¿**ï¼ˆçº¦900è¡Œï¼‰ï¼š\n   - menu_commentï¼ˆè¯„è®ºèœå•ï¼‰\n   - menu_thinkï¼ˆæ€è€ƒèœå•ï¼‰\n   - menu_studyï¼ˆå­¦ä¹ èœå•ï¼‰\n   - menu_referenceï¼ˆæ–‡çŒ®èœå•ï¼‰\n   - menu_textï¼ˆæ–‡æœ¬èœå•ï¼‰\n   - menu_cardï¼ˆå¡ç‰‡èœå•ï¼‰\n   - menu_makeCardsï¼ˆåˆ¶å¡èœå•ï¼‰\n   - ç­‰ç­‰...\n\n4. **è‡ªå®šä¹‰åŠ¨ä½œ**ï¼š\n   - custom1-custom20 çš„åŠ¨ä½œå®šä¹‰\n   - åŒ…æ‹¬åˆ¶å¡ã€æ€è€ƒã€è¯„è®ºã€å­¦ä¹ ç­‰åŠŸèƒ½\n\n5. **æ–‡ä»¶æœ«å°¾çš„æ‰©å±•åŠ è½½**ï¼š\n   ```javascript\n   JSB.require('xdyy_utils_extensions')\n   if (typeof initXDYYExtensions === 'function') {\n     initXDYYExtensions()\n   }\n   if (typeof extendToolbarConfigInit === 'function') {\n     extendToolbarConfigInit()\n   }\n   ```\n\n## å·²å®Œæˆçš„ä¿®å¤\n1. ä¿®æ”¹äº† update.pyï¼Œæ·»åŠ äº† utils.js çš„ç”¨æˆ·ä¿®æ”¹ä¿ç•™è§„åˆ™\n2. æˆåŠŸæ¢å¤äº† preprocessã€referenceIds å’Œæ‰©å±•æ–‡ä»¶åŠ è½½ç­‰æ ¸å¿ƒåŠŸèƒ½\n3. åˆ›å»ºäº† user_menu_templates.txt ä¿å­˜èœå•æ¨¡æ¿å†…å®¹\n4. åˆ›å»ºäº† user_custom_menus.js ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ\n\n## å½“å‰çŠ¶æ€\n- update.py å¯ä»¥æ¢å¤éƒ¨åˆ†ç”¨æˆ·ä¿®æ”¹ï¼Œä½†èœå•æ¨¡æ¿éƒ¨åˆ†ç”±äºå†…å®¹è¿‡å¤šï¼Œéœ€è¦æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ\n- ç”¨æˆ·çš„è‡ªå®šä¹‰èœå•åŠŸèƒ½æš‚æ—¶æœªèƒ½å®Œå…¨æ¢å¤\n- å»ºè®®ä½¿ç”¨æ›´è§£è€¦çš„æ–¹å¼ç®¡ç†è¿™äº›è‡ªå®šä¹‰åŠŸèƒ½\n\n## å¾…è§£å†³é—®é¢˜\n1. å¦‚ä½•ä¼˜é›…åœ°æ¢å¤å¤§é‡çš„èœå•æ¨¡æ¿å†…å®¹\n2. æ˜¯å¦åº”è¯¥å°†èœå•æ¨¡æ¿åˆ†ç¦»åˆ°ç‹¬ç«‹æ–‡ä»¶\n3. å¦‚ä½•ç¡®ä¿æ›´æ–°è„šæœ¬çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§",
        "--tags",
        "MNToolbar update.py utils.js è‡ªå®šä¹‰èœå• æœªå®Œæˆ"
      ]
    },
    {
      "from": "memory_saved",
      "command": "recall",
      "timestamp": "2025-06-27T07:41:52.586Z",
      "args": []
    },
    {
      "from": "recall-waiting",
      "command": "init",
      "timestamp": "2025-06-27T07:45:40.478Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/mntoolbar"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "init",
      "timestamp": "2025-06-27T07:46:00.168Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/mntoolbar"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "action",
      "timestamp": "2025-06-27T08:06:17.314Z",
      "args": [
        "python-backend-developer"
      ]
    },
    {
      "from": "role_activated_with_memory",
      "command": "remember",
      "timestamp": "2025-06-27T08:34:54.622Z",
      "args": [
        "MN Toolbar Pro - update.py é…ç½®ç»´æŠ¤ç»éªŒï¼ˆ2025.6.27ï¼‰\n\n## é—®é¢˜èƒŒæ™¯\nç”¨æˆ·åœ¨å®Œæˆä»£ç è§£è€¦åï¼Œè¿è¡Œ update.py æ›´æ–°è„šæœ¬æ—¶ï¼Œä¹‹å‰çš„è§£è€¦å·¥ä½œè¢«æ’¤é”€äº†ã€‚ä¸»è¦è¡¨ç°ä¸ºï¼š\n1. main.js ä¸­çš„ togglePreprocess å‡½æ•°è¢«é”™è¯¯åˆ é™¤\n2. webviewController.js ä¸­çš„ togglePreprocess å‡½æ•°å…¨éƒ¨è¢«åˆ é™¤ï¼ˆåº”è¯¥ä¿ç•™ä¸€ä¸ªï¼‰\n\n## è§£å†³æ–¹æ¡ˆ\n\n### 1. ä¿®æ”¹ update.py é…ç½®\n- åœ¨ main.js é…ç½®ä¸­æ·»åŠ  togglePreprocess å‡½æ•°å®šä¹‰\n- ä½¿ç”¨ insert_after_once ç±»å‹é¿å…é‡å¤æ’å…¥\n- æ³¨é‡Šæ‰ utils.js ä¸­çš„ togglePreprocess æ·»åŠ é…ç½®\n\n### 2. å®ç°æ™ºèƒ½æ¸…ç†å‡½æ•°\n```python\ndef clean_duplicate_togglePreprocess(self, file_path):\n    # åŒ¹é…ä¸¤ç§æ¨¡å¼ï¼šå¸¦/ä¸å¸¦ \"dynamic\" æ³¨é‡Šçš„å‡½æ•°\n    # æŒ‰ä½ç½®æ’åºï¼Œä¿ç•™æœ€åä¸€ä¸ªï¼Œåˆ é™¤å…¶ä»–çš„\n```\n\n### 3. æ”¯æŒ insert_after_once ç±»å‹\nåœ¨ apply_user_modifications ä¸­æ·»åŠ é€»è¾‘ï¼Œæ£€æŸ¥å…³é”®ä»£ç æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤æ’å…¥ã€‚\n\n### 4. å…³é”®é…ç½®ç¤ºä¾‹\n```python\n# æ·»åŠ èœå•æ³¨å†Œè¡¨åˆ°ç”¨æˆ·è‡ªå®šä¹‰æ–‡ä»¶åˆ—è¡¨\nself.user_custom_files = {\n    'xdyy_utils_extensions.js',\n    'xdyy_custom_actions_registry.js',\n    'xdyy_menu_registry.js'\n}\n\n# åœ¨ webviewController.js ä¿®æ”¹åè°ƒç”¨æ¸…ç†\nif modified_file == 'webviewController.js':\n    self.clean_duplicate_togglePreprocess(file_path)\n```\n\n## å…³é”®è¦ç‚¹\n1. ç†è§£æ¯ä¸ªæ–‡ä»¶éœ€è¦å“ªäº›å‡½æ•°å®šä¹‰\n2. ä½¿ç”¨æ™ºèƒ½çš„é‡å¤æ£€æµ‹å’Œæ¸…ç†é€»è¾‘\n3. æ”¯æŒæ¡ä»¶æ’å…¥é¿å…é‡å¤ä¿®æ”¹\n4. åœ¨æ­£ç¡®çš„æ—¶æœºè°ƒç”¨æ¸…ç†å‡½æ•°\n5. æµ‹è¯•éªŒè¯ï¼šè¿è¡Œåæ£€æŸ¥å‡½æ•°æ•°é‡æ˜¯å¦æ­£ç¡®",
        "--tags",
        "MNToolbar update.py è§£è€¦ç»´æŠ¤ é…ç½®ç®¡ç†"
      ]
    }
  ],
  "lastUpdated": "2025-06-27T08:34:54.634Z"
}
