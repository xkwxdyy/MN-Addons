# 📋 MarginNote 任务管理插件使用指南

## 🌟 功能概述

任务管理插件将 MarginNote 的卡片系统转化为强大的任务管理工具，让您可以：

- 📝 创建和管理任务
- 📊 跟踪任务进度（特别适合读书进度）
- 🔗 关联任务与知识卡片
- 📅 管理今日任务
- 🎯 任务优先级和状态管理
- 📈 导出任务报告

## 🚀 快速开始

### 1. 集成到 MNToolbar

按照 `main_task_integration.patch` 文件的说明，将任务管理功能集成到您的 MNToolbar 插件中。

### 2. 创建任务

#### 方法一：从笔记创建
1. 右键点击任何笔记卡片
2. 选择"📋 创建任务"
3. 填写任务信息（名称、描述、优先级等）
4. 点击确定，任务会自动关联到原笔记

#### 方法二：在任务管理器中创建
1. 打开任务管理器（右键菜单 → "🗂️ 任务管理器"）
2. 点击右下角的"+"按钮
3. 填写任务信息
4. 点击确定

### 3. 任务状态

任务通过颜色表示不同状态：
- 🟡 **淡黄色**（0）：未开始
- 🟢 **绿色**（5）：进行中
- 🔵 **淡蓝色**（2）：已完成
- 🔴 **淡红色**（3）：暂停中
- ⚫ **深灰色**（14）：已取消

### 4. 任务类型标识

任务通过标题前缀识别：
- `【任务】任务名称` - 普通任务
- `【今日】任务名称` - 今日任务
- `【完成】任务名称` - 已完成任务
- `【项目】项目名称` - 项目任务
- `【子任务】子任务名称` - 子任务

## 📖 详细功能

### 进度管理

特别适合读书任务：
1. 右键点击任务卡片
2. 选择"📊 更新进度"
3. 输入当前进度（如：50/300页）
4. 系统会自动计算进度百分比

进度信息存储在评论中：`进度：50/300页`

### 今日任务

将任务标记为今日任务：
1. 右键点击任务
2. 选择"📅 标记为今日任务"
3. 任务标题会变为`【今日】`前缀
4. 在任务管理器中会显示在"今日任务"分组

### 任务关联

每个任务可以关联一个知识卡片：
- 创建任务时会自动关联当前卡片
- 点击任务可以快速跳转到关联卡片
- 适合将书籍、文档等作为任务的参考资料

### 子任务管理

创建子任务来拆分大任务：
1. 选中父任务
2. 创建新的子卡片
3. 子卡片标题使用`【子任务】`前缀
4. 系统会自动计算总体进度

### 任务筛选与排序

在任务管理器中：
- 🔍 使用搜索框快速查找任务
- 📊 按优先级、截止日期、创建时间排序
- 👁️ 显示/隐藏已完成和已取消的任务

## ⚙️ 设置选项

打开设置（任务管理器 → ⚙️ 设置）：

### 显示选项
- **显示已完成任务**：是否在列表中显示已完成的任务
- **显示已取消任务**：是否显示已取消的任务

### 排序方式
- **优先级**：高→中→低
- **截止日期**：最近的在前
- **创建时间**：最新的在前
- **任务状态**：按状态分组

### 界面设置
- **显示进度条**：在任务列表中显示进度条
- **显示截止日期**：显示任务的截止日期

## 📊 任务报告

导出任务报告：
1. 打开任务管理器
2. 点击"📊 导出报告"
3. 报告会复制到剪贴板
4. 包含任务统计、今日任务、进行中任务等信息

## 🎨 使用技巧

### 1. 读书任务最佳实践
```
1. 创建主任务：【任务】阅读《深度工作》
2. 设置总页数：进度：0/296页
3. 每日更新进度：进度：120/296页
4. 创建章节子任务：【子任务】第一章：深度工作的价值
```

### 2. 项目管理
```
1. 创建项目：【项目】MarginNote 插件开发
2. 创建子任务：
   - 【子任务】需求分析
   - 【子任务】UI 设计
   - 【子任务】功能开发
3. 关联相关文档和笔记
```

### 3. 日常任务
```
1. 使用【今日】标记当天要完成的任务
2. 完成后状态会自动变为蓝色
3. 定期清理已完成的任务
```

## 🐛 故障排除

### 任务不显示
1. 确保笔记标题有正确的前缀（【任务】等）
2. 刷新任务列表（🔄 刷新按钮）
3. 检查筛选设置

### 进度无法更新
1. 确保使用正确的格式：`进度：当前/总数单位`
2. 检查是否有权限修改笔记

### 任务管理器无法打开
1. 确保所有文件都已正确加载
2. 检查 main.js 是否正确集成
3. 查看错误日志

## 🔧 技术说明

### 数据存储
- 任务数据存储在 MarginNote 的卡片系统中
- 使用标题前缀识别任务类型
- 使用颜色表示任务状态
- 使用评论存储进度和元数据

### 文件结构
```
mntoolbar_learning/
├── taskUtils.js         # 工具函数
├── taskManager.js       # 核心逻辑
├── taskWebview.js       # UI 控制器
├── taskSettings.js      # 设置界面
└── resources/
    └── task.html        # 任务管理界面
```

### API 使用
- 基于 MNUtils 框架
- 使用 MNNote API 管理卡片
- 使用 WebView 实现界面
- 使用 iCloud 同步配置

## 📝 更新日志

### v1.0.0 (2025-07-01)
- ✨ 初始版本发布
- 📋 基本任务管理功能
- 📊 进度跟踪
- 📅 今日任务
- 🔗 卡片关联
- ⚙️ 设置界面

## 🤝 贡献

欢迎提交问题和建议！如需添加新功能：
1. 在 `taskUtils.js` 中添加工具函数
2. 在 `taskManager.js` 中实现业务逻辑
3. 在 `task.html` 中更新界面
4. 在 `taskWebview.js` 中处理交互

## 📄 许可

本插件基于 MNToolbar 项目开发，遵循相同的开源协议。