<!DOCTYPE html>
<html>
<head>
    <title>任务看板</title>
    <meta charset="UTF-8">
    <style>
        /* 基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        /* 工具栏样式 */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .filters {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filters label {
            font-weight: bold;
            color: #555;
        }
        
        .filters select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }
        
        /* 任务列表样式 */
        .task-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* 任务卡片样式 */
        .task-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        /* 任务头部 */
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-type {
            background-color: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .task-status {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        /* 任务标题 */
        .task-title {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        /* 任务描述 */
        .task-description {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        /* 任务底部 */
        .task-footer {
            display: flex;
            gap: 10px;
        }
        
        /* 按钮样式 */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
            font-size: 16px;
            padding: 10px 20px;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-start {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-start:hover {
            background-color: #27ae60;
        }
        
        .btn-complete {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-complete:hover {
            background-color: #e67e22;
        }
        
        .btn-redo {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-redo:hover {
            background-color: #7f8c8d;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        .btn-cancel {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-cancel:hover {
            background-color: #7f8c8d;
        }
        
        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
        }
        
        .modal-content h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        /* 表单样式 */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* 提示消息样式 */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2c3e50;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }
        
        .toast.fade-out {
            animation: fadeOut 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        /* 空状态样式 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }
        
        .empty-state-icon {
            font-size: 72px;
            margin-bottom: 20px;
        }
        
        .empty-state p {
            font-size: 18px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📋 我的任务看板</h1>
        
        <!-- 工具栏 -->
        <div class="toolbar">
            <button class="btn btn-primary" onclick="showAddTaskForm()">
                ➕ 添加新任务
            </button>
            
            <div class="filters">
                <label>筛选：</label>
                <select id="filterStatus" onchange="filterTasks()">
                    <option value="all">所有状态</option>
                    <option value="未开始">未开始</option>
                    <option value="进行中">进行中</option>
                    <option value="已完成">已完成</option>
                </select>
                
                <select id="filterType" onchange="filterTasks()">
                    <option value="all">所有类型</option>
                    <option value="任务">任务</option>
                    <option value="项目">项目</option>
                    <option value="目标">目标</option>
                </select>
            </div>
        </div>
        
        <!-- 任务列表容器 -->
        <div class="task-list" id="taskList">
            <!-- 任务卡片将在这里动态生成 -->
        </div>
        
        <!-- 添加任务表单（默认隐藏） -->
        <div class="modal" id="addTaskModal" style="display: none;">
            <div class="modal-content">
                <h2>添加新任务</h2>
                
                <div class="form-group">
                    <label>任务类型</label>
                    <select id="taskType">
                        <option value="任务">任务</option>
                        <option value="项目">项目</option>
                        <option value="目标">目标</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>任务标题</label>
                    <input type="text" id="taskTitle" placeholder="输入任务标题">
                </div>
                
                <div class="form-group">
                    <label>任务描述</label>
                    <textarea id="taskDescription" placeholder="输入任务描述"></textarea>
                </div>
                
                <div class="form-buttons">
                    <button class="btn btn-primary" onclick="addTask()">添加</button>
                    <button class="btn btn-cancel" onclick="hideAddTaskForm()">取消</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // =====================================
        // 🎯 任务看板应用
        // 
        // 这是一个完整的任务管理示例，包含：
        // 1. 任务的增删改查
        // 2. 状态管理和流转
        // 3. 筛选和排序
        // 4. 数据持久化
        // 5. 与插件通信
        // =====================================
        
        // ==================== 数据管理 ====================
        
        // 任务数据数组
        let tasks = [
            {
                id: 1,
                type: '任务',
                title: '学习JavaScript',
                description: '完成第5章的所有练习',
                status: '未开始',
                createdAt: new Date().toISOString()
            },
            {
                id: 2,
                type: '项目',
                title: '个人网站',
                description: '设计并开发个人作品展示网站',
                status: '进行中',
                createdAt: new Date().toISOString()
            },
            {
                id: 3,
                type: '目标',
                title: '掌握前端开发',
                description: '在6个月内成为合格的前端开发者',
                status: '进行中',
                createdAt: new Date().toISOString()
            }
        ];
        
        // 保存原始任务列表（用于筛选）
        let allTasks = [...tasks];
        
        // ==================== 渲染功能 ====================
        
        // 渲染单个任务卡片
        function createTaskCard(task) {
            // 根据状态决定按钮文字
            let buttonText = '开始';
            let buttonClass = 'btn-start';
            
            if (task.status === '进行中') {
                buttonText = '完成';
                buttonClass = 'btn-complete';
            } else if (task.status === '已完成') {
                buttonText = '重做';
                buttonClass = 'btn-redo';
            }
            
            // 根据类型决定颜色
            const typeColors = {
                '任务': '#3498db',
                '项目': '#9b59b6',
                '目标': '#e67e22'
            };
            
            const typeColor = typeColors[task.type] || '#95a5a6';
            
            // 创建HTML
            return `
                <div class="task-card" data-task-id="${task.id}">
                    <div class="task-header">
                        <span class="task-type" style="background-color: ${typeColor}">${task.type}</span>
                        <span class="task-status">${task.status}</span>
                    </div>
                    <h3 class="task-title">${task.title}</h3>
                    <p class="task-description">${task.description}</p>
                    <div class="task-footer">
                        <button class="btn ${buttonClass}" onclick="updateTaskStatus(${task.id})">
                            ${buttonText}
                        </button>
                        <button class="btn btn-delete" onclick="deleteTask(${task.id})">
                            删除
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 渲染所有任务
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            
            // 清空现有内容
            taskList.innerHTML = '';
            
            // 如果没有任务，显示提示
            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📭</div>
                        <p>还没有任务，点击上方按钮添加第一个任务吧！</p>
                    </div>
                `;
                return;
            }
            
            // 渲染每个任务
            tasks.forEach(task => {
                taskList.innerHTML += createTaskCard(task);
            });
        }
        
        // ==================== 任务操作 ====================
        
        // 更新任务状态
        function updateTaskStatus(taskId) {
            // 找到对应的任务
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // 更新状态（状态流转）
            if (task.status === '未开始') {
                task.status = '进行中';
            } else if (task.status === '进行中') {
                task.status = '已完成';
            } else if (task.status === '已完成') {
                task.status = '未开始';
            }
            
            // 同步到原始列表
            const originalTask = allTasks.find(t => t.id === taskId);
            if (originalTask) {
                originalTask.status = task.status;
            }
            
            // 保存数据
            saveTasks();
            
            // 重新渲染
            renderTasks();
            
            // 显示提示
            showMessage(`任务"${task.title}"状态已更新为：${task.status}`);
            
            // 同步到插件
            sendToPlugin('updateTask', task);
        }
        
        // 删除任务
        function deleteTask(taskId) {
            // 确认删除
            if (!confirm('确定要删除这个任务吗？')) {
                return;
            }
            
            // 找到任务的索引
            const index = tasks.findIndex(t => t.id === taskId);
            if (index === -1) return;
            
            // 保存任务标题用于提示
            const taskTitle = tasks[index].title;
            
            // 删除任务
            tasks.splice(index, 1);
            
            // 同时从原始列表删除
            const allIndex = allTasks.findIndex(t => t.id === taskId);
            if (allIndex !== -1) {
                allTasks.splice(allIndex, 1);
            }
            
            // 保存数据
            saveTasks();
            
            // 重新渲染
            renderTasks();
            
            // 显示提示
            showMessage(`任务"${taskTitle}"已删除`);
            
            // 同步到插件
            sendToPlugin('deleteTask', { id: taskId });
        }
        
        // 显示提示消息
        function showMessage(message) {
            // 创建提示元素
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            // 添加到页面
            document.body.appendChild(toast);
            
            // 3秒后自动消失
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // ==================== 添加任务功能 ====================
        
        // 显示添加任务表单
        function showAddTaskForm() {
            document.getElementById('addTaskModal').style.display = 'flex';
            // 聚焦到标题输入框
            document.getElementById('taskTitle').focus();
        }
        
        // 隐藏添加任务表单
        function hideAddTaskForm() {
            document.getElementById('addTaskModal').style.display = 'none';
            // 清空表单
            document.getElementById('taskType').value = '任务';
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
        }
        
        // 添加新任务
        function addTask() {
            // 获取表单数据
            const type = document.getElementById('taskType').value;
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            
            // 验证
            if (!title) {
                alert('请输入任务标题！');
                document.getElementById('taskTitle').focus();
                return;
            }
            
            // 创建新任务
            const newTask = {
                id: Date.now(), // 使用时间戳作为ID
                type: type,
                title: title,
                description: description || '暂无描述',
                status: '未开始',
                createdAt: new Date().toISOString()
            };
            
            // 添加到任务数组
            tasks.unshift(newTask); // 添加到开头
            allTasks.unshift(newTask); // 同时添加到原始列表
            
            // 保存数据
            saveTasks();
            
            // 重新渲染
            renderTasks();
            
            // 隐藏表单
            hideAddTaskForm();
            
            // 显示提示
            showMessage(`任务"${title}"已添加`);
            
            // 同步到插件
            sendToPlugin('addTask', newTask);
        }
        
        // 点击模态框背景关闭
        document.getElementById('addTaskModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAddTaskForm();
            }
        });
        
        // ==================== 筛选功能 ====================
        
        // 筛选任务
        function filterTasks() {
            const statusFilter = document.getElementById('filterStatus').value;
            const typeFilter = document.getElementById('filterType').value;
            
            // 从原始列表开始筛选
            let filteredTasks = [...allTasks];
            
            // 按状态筛选
            if (statusFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            // 按类型筛选
            if (typeFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.type === typeFilter);
            }
            
            // 更新当前显示的任务
            tasks = filteredTasks;
            
            // 重新渲染
            renderTasks();
            
            // 显示筛选结果统计
            const message = `找到 ${tasks.length} 个任务`;
            showMessage(message);
        }
        
        // ==================== 数据持久化 ====================
        
        // 保存任务到本地存储
        function saveTasks() {
            try {
                localStorage.setItem('mntask_tasks', JSON.stringify(allTasks));
                console.log('📁 任务已保存到本地');
            } catch (error) {
                console.error('❌ 保存任务失败:', error);
            }
        }
        
        // 从本地存储加载任务
        function loadTasks() {
            try {
                const saved = localStorage.getItem('mntask_tasks');
                if (saved) {
                    allTasks = JSON.parse(saved);
                    tasks = [...allTasks];
                    console.log('📂 已加载保存的任务');
                }
            } catch (error) {
                console.error('❌ 加载任务失败:', error);
            }
        }
        
        // ==================== 插件通信 ====================
        
        // 发送消息到插件
        function sendToPlugin(action, data = {}) {
            const message = {
                action: action,
                data: data,
                timestamp: Date.now()
            };
            
            const url = `mntask://taskboard?message=${encodeURIComponent(JSON.stringify(message))}`;
            console.log('📤 发送到插件:', message);
            window.location.href = url;
        }
        
        // 接收插件的数据
        window.receiveFromPlugin = function(action, jsonData) {
            console.log('📥 收到插件消息:', action, jsonData);
            
            try {
                const data = JSON.parse(jsonData);
                
                switch(action) {
                    case 'loadTasks':
                        // 加载插件提供的任务
                        allTasks = data.tasks || [];
                        tasks = [...allTasks];
                        renderTasks();
                        showMessage('任务已从插件加载');
                        break;
                        
                    case 'taskUpdated':
                        // 任务已在插件端更新
                        showMessage(data.message || '任务已更新');
                        break;
                        
                    default:
                        console.log('未知的操作:', action);
                }
            } catch (error) {
                console.error('❌ 处理插件数据失败:', error);
            }
        };
        
        // ==================== 初始化 ====================
        
        // 页面加载完成后
        window.onload = function() {
            console.log('✅ 任务看板加载完成');
            
            // 先尝试加载本地数据
            loadTasks();
            renderTasks();
            
            // 然后请求插件数据
            setTimeout(() => {
                sendToPlugin('requestTasks');
            }, 100);
            
            // 显示欢迎信息
            console.log('=====================================');
            console.log('🎉 欢迎使用任务看板！');
            console.log('💡 功能说明：');
            console.log('1. 添加新任务 - 点击"添加新任务"按钮');
            console.log('2. 更新状态 - 点击任务卡片上的状态按钮');
            console.log('3. 删除任务 - 点击删除按钮');
            console.log('4. 筛选任务 - 使用顶部的筛选器');
            console.log('5. 数据会自动保存到本地');
            console.log('=====================================');
        };
        
        // =====================================
        // 🎓 学习总结：
        // 
        // 这个任务看板展示了一个完整的 Web 应用：
        // 
        // 1. 数据管理
        //    - 使用数组存储任务
        //    - 实现增删改查操作
        //    - 维护原始数据用于筛选
        // 
        // 2. 用户界面
        //    - 动态渲染任务卡片
        //    - 模态框实现表单
        //    - 提示消息反馈
        // 
        // 3. 交互设计
        //    - 状态流转逻辑
        //    - 筛选功能
        //    - 确认对话框
        // 
        // 4. 数据持久化
        //    - localStorage 保存数据
        //    - 页面刷新不丢失
        // 
        // 5. 插件通信
        //    - 发送操作到插件
        //    - 接收插件的数据
        // =====================================
    </script>
</body>
</html>