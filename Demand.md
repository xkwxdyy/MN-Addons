请你精简 mnutils/xdyyutils.js 文件里的代码，不需要处理 MNMath 和 HtmlMarkdownUtils 类和 Pangu 类。其余的都需要处理。

精简依据，也就是下面情况的要删除
1. 没有在 mntask 里用到的
2. 没有在 mntoolbar 里用到的

尤其是 xdyyutils.js 里面有很多 MNNote 和 MNUtil 类的函数补充，但是很多内容都已经在 MNMath 类里实现了，所以不需要了，但是还是有一部分在 mntoolbar 里有用到，这些暂时保留先。

注意：最后再精简 String 类部分的代码，因为这个有些函数用在了需要删除的函数里，但是你因为这个而没有删除，为了避免这个，所以最后处理。 ultrathink
---
我刚更新了 mntoolbar 的按钮菜单（xdyy_menu_registry.js 文件中）
这个是最新的版本，请你基于这个菜单，查看 xdyy_custom_actions_registry.js 文件里的动作，没有在菜单里的动作全都删除。
然后查看按钮 xdyy_button_registry.js 文件，删除菜单不在菜单文件里的按钮。
ultrathink


---
优化一下 convertFieldContentToHtmlMDByPopup 函数，参考 manageCommentsByPopup 函数的处理，支持多选就行。ultrathink

---
继续开发 MNMath 的 smartLinkArrangement 函数。目前没有命题与命题的情况对吧？
或者是例子与例子，反例与反例，或者是这三种与这三种其一的情况，都按照下面的处理：和定义与定义的类似。

希望的效果是，假设是卡片 A 和 卡片 B
1. 检测卡片 A 的最后一条评论是否是 B 的链接，以及 B 的最后一条是否是 A 的链接，两个都是的话进行下一步
2. 在 A 的“相关思考”字段的 bottom 下方增加一个“- ”，然后把 B 的链接移动到这个“- ”下方，同理处理 B 卡片。其实这个操作和定义与定义的是一样的。

并且把上面说的这几种情况的功能优化到 mntoolbar 里的 moveUpThoughtPointsToBottom 动作，目前这个单击动作只有一个功能：把自动获取的内容移动到“相关思考”，但希望能够把上面的处理进行兼容。ultrathink
---
manageCommentsByPopup 需要优化:现在是把移动和删除的确认放在了新的弹窗里，但是这样会有点麻烦，我希望的是如果第一个弹窗里选择了“多选”，那么就把这个选项直接放在了多选的那个选择弹窗的下方（目前只有一个确认）。
因为弹窗多的话，确认起来就比较繁琐，虽然现在功能很丰富。ultrathink
---
今日看板那个功能继续开发：现在看不到任务类型，只能看到状态，这个不太好，因为我们启动任务肯定是做“动作”类型的任务。另外我是学生，很多时间都在读书，所以重点研究一下如何拆解读书任务？目前有的那些拆解是很久之前写的，并不完善！希望基于目前的框架和体系重新写。
注意一定要灵活，能方便地调整和追踪。 ultrathink
---
优化一下制卡功能：
目标、关键结果卡片比较特殊，他们在“同一条”下是唯一的，也就是一个目标的子卡片只能是关键结果类型的卡片，关键结果类型的卡片的子卡片只能是项目类型，所以这两种情况就不需要弹窗选择了，就按照上面说的制卡就行，其余的情况不确定，所以才需要手动选择。ultrathink
---
继续开发 mntask：
目前增加一个今日任务的识别符号，然后筛选的效果是把他们都移动到今日看板。但这样有个问题是还要考虑到后续把他们移动回去的问题。

所以我觉得就是在今日看板里通过链接或者 Markdown 形式的行内链接比较好，这样那个“今日看板”可以更加宏观地区看到任务情况，所以其实就是把今日任务的一些处理，都最后呈现为 “今日看板” 卡片里的评论的处理。

所以请你优化一下。ultrathink
---
MNMath 的 smartLinkArrangement 函数有点问题
1. 命题卡片A这种知识点卡片和归类卡片B双向链接之后触发的话，A 中的B 链接，应该移动到“相关链接”的 bottom，而不是 top，top 有个问题是会被后续制卡的时候 linkParent 给清除掉
2. 加一个新的支持：定义 A和归类卡片B 的情形：A 在 B 内的链接移动到“所属”字段的 bottom
---
有一个需求：我希望能够把一些卡片“pin 住”，相当于收藏一些卡片，并且能够随时调用，在 FloatMindMap 里显示。
具体的交互设想如下：
1. 如何收藏卡片
   - 我想的是在 toolbar 的视图里增加一个新的 view（你可以重点学习一下 toolbar 里的切换视图(搜索 tabView)功能。）然后里面提供两个输入框，第一个写标题，也就是最后调用的时候显示的内容，第二个就写卡片的 URL 或者 ID，mnutils/xdyyutils.js 里面有一些 String 的方法可以判定和处理，比如统一处理为 ID 之类的，但是其实问题都不大，因为正确的 URL 和 ID 都能作为 MNNote.new 的参数，然后 focusInFloatMindMap 就行了。
   - 但上面只是我暂时想的，重点其实是如何设计的可以方便加入，修改，删除和调顺序
     - 修改的话，就是点击之后两个输入框里就显示对应的信息，修改后保存就可以更新，有点类似于第一个按钮视图的设置那种感觉
     - 还希望能支持：如果ID 那个输入框是完全空的也能加入，因为这个时候会作为一种分隔符来分隔卡片（万一太多的话）
   - 我突然想到可以类似于第一个按钮视图那种，他也支持改顺序，每个按钮下方也是会有两个框！我发现可以仿照那个视图弄一个！
2. 如何调用卡片
   - 我其实之前弄过一个按钮，应该是带有 `pin` 的一个，然后 toolbar 支持替换软件原生的菜单，这样的话，我就用 pin 来替换原生的菜单，当然也可以不替换，但反正通过`pin`按钮，我单击一下就可以看到一个 pin 菜单，每个 item 都可能是卡片（也可能有一些 item 是用来划分的），然后点击具体的标题就可以在浮窗中定位到对应的卡片
   - 或者你想想看怎么弄比较好？

关键点
1. 这个信息需要能够被保存，所以你需要看看如何把这些信息存到 iCloud 里，这个在 toolbar 里是可以做到的。
2. 一旦你需要在 xdyy*.js 外的文件里进行修改，要注意这些文件是官方的文件，更新的时候需要用 update.py 来打补丁，免去我手动修改的麻烦。
ultrathink
---
请学习 mnai, mntoolbar, mnutils 项目，前两个学习卡片的更多处理的可能性以及一些结合插件实现的操作， mnutils 学习基础 API。请你进一步规划思考任务管理需要的筛选，并且完善今日任务的筛选以及后续处理，并增加其它类型的筛选 ultrathink
---
请你阅读 mntask 的 TaskFieldUtils 和 MNTaskManager 两个类，了解目前已经开发的一些功能。基础 API 参见 mnutils 项目
现在打算开始开发 mntask 的筛选功能了，因为目前只切换状态的话，会有很多进行中的任务
我们首先解决:
1. 要有一个今日看板？（在 Task Board 视图里添加绑定）
2. 如何标记哪些是今天要做的？比如在信息字段下加什么子字段？
3. 如何把这些卡片筛选出来？
4. 筛选出来之后如何确定这些任务的顺序、优先级？也就是先做哪件再做哪件？
5. 做完了带有今日任务标记的任务，今日看板内如何更新？
ultrathink
---
mntoolbar 里的 moveNewContentsByPopupTo 动作和 deleteCommentsByPopup 动作，本质上是 MNMath 里的两个函数。我希望他们能统一。

现在moveNewContentsByPopupTo 对应的 moveCommentsByPopup 函数对评论的多选处理和解析已经很完善了，后续就在这个上面进行进一步开发。我希望能把删除评论的功能加进来。我的大致思路如下：
1. 第一个弹窗整体，依旧是选择获取评论的方式
2. 第一个弹窗的几个选项触发的第二个弹窗里都加一个按钮，功能就是“删除”，然后原来的“确定移动”类型的功能，改成“移动”，具体的用词你可以调整，反正就是这个窗口就可以选择下一步行动是删除还是移动，如果是删除，就再给一个弹窗，弹窗的提示内容里把我选中的内容的类型和内容都列出来（就和弹窗里解析显示的是一样的），点击确认的话删除就可以了。
如果选择移动，则按照之前的处理即可

开发完之后应该更新一下 mntoolbar 那个菜单里的动作，应该是可以把删除评论的去掉，以及删除评论的函数也可以去掉了。
ultrathink
---
我发现移动和删除评论的弹窗函数里都有一个问题，就是归类卡片的前缀有问题
```
“xxx”相关yy
```
的归类卡片的类型应该写成 `[yy归类]` 而不是 `[yy]` ultrathink
---
刚测试了还是有个 bug: 命题卡片证明字段的内容,如果移动到"相关思考"字段下方的某个评论 A,我刚测试了点击"A上方"和"A 下方",结果都是到了 A 上方 ultrathink         
---
第二层解决了，但是第三层没有完全解决，虽然我也能接受，但是你看这个图 [Image #1], 明显是 HtmlMarkdown评论字段下方的内容暴露出来了! 比如那个"倒数第一"到"纯手写" 这个部分应该隐藏在 "的回答很好的"这一项里面 ultrathink
---
再补充一下，刚刚的例子中，第三层也是和第二层同理，要有一个第三层的粗略位置，也就是 1 前面，1 后面， A，A top，A bottom，B，B top，B bottom，点击 A 或者 B 进入更细节的位置控制 ultrathink
---
你说的第三层,我怕你没理解正确,我补充一下,这个时候暴露出来的普通评论的前面应该是没有任何 HtmlMarkdown 评论的,一旦有,就和前面说的一样,一定属于某个 HtmlMarkdown 评论,那么这个时候就不能暴露在这层,比如 1, A, 2,B 3. 其中  A 和 B 是 HtmlMarkdown 评论，然后从左到右 index 增加，这个时候 1 就是需要和 HtmlMarkdown 同层，因为它不属于任何 HtmlMarkdown 评论，但是 2 属于 A， 3 输入 B，所以 2 需要点击 A 才能看到，3 需要点击 B 才能看到。 ultrathink
---
还是有问题：这张图
第二个弹窗怎么又把字段里的内容暴露了？
这个部分
这个时候不应该显示的，这个部分的内容，应该点击“证明区”然后在第三个弹窗里显示
第三个弹窗也是这个类似的问题：
应该像第二个弹窗一样，先提供每个 HtmlMarkdown 评论的 top 和 bottom，然后如果有进一步需要，再点 HtmlMarkdown，比如我点击 “你干嘛啊”，才到第四个弹窗的内容。

总结一下，其实现在要的效果有了，但是第二个和第三个窗口都有暴露内容的问题。还没把这个“文件夹”分得很彻底 ultrathink
---
继续开发 mntask: 现在任务只有三个状态，但是其实第三个状态可以点击后进行归档，我希望在状态栏那个地方也增加一个“已归档”状态，来与“已完成”区分，因为“已完成”可能会退回“进行中”。 ultrathink
---
我刚发现应该还需要一个弹窗，因为目前第三个弹窗是 HtmlMarkdown 评论与其下方的所有内容都暴露在一起，容易混淆。
应该是类似于第二个弹窗，如果要更精细移动化，再点 HtmlMarkdown 评论，这样就进入到第三层弹窗，里面的内容是 HtmlMarkdown 下方的所有内容。 这样才真正能实现三层，像文件夹一样的效果。ultrathink
---
这张图左边是具体的卡片，右边是第二层弹窗，有个问题是这个时候 HtmlMarkdown 评论的字段不应该显示的，不应该在这一层就暴露出来，只有当我需要进一步点击证明区的时候才需要，但我看点击后第三层的功能确实也实现了，请把这个第二层优化一下  ultrathink
---
1. 现在第一个弹窗里根本无法像 deleteCommentsByFieldPopup 那样多选！ ultrathink
---
1. 如果是解析的是纯链接，那么弹窗里显示的应该是标题，不过如果有前缀的话需要处理，参考一下别的函数的处理，其实就是处理为`[类型] 标题`
2. 手写内容没有正确识别类型，可以学习一下 deleteCommentsByFieldPopup 函数的类型处理。要注意用 note.MNComments 来获取更精细的类型
3. 你目前也只是开发了两层，你相当于把 HtmlMarkdown 评论和其它评论看成一种了。在第二层的时候，其余类型的评论不应该“暴露出来”，应该要进一步点击某条 HtmlMarkdown 评论才行。所以你得学习 MNMath 的字段识别和字段下方内容获取，HtmlMarkdown 评论也要有一套类似的。ultrathink
---
继续开发 mnutils

## moveCommentsByPopup 增加新功能
目前我们 xdyyutils.js 里的 MNMath 类有一些能够解析普通评论的函数（不是函数本身，而是内部实现了），你可以学习一下。这里普通评论是指文本手写，图片，链接之类的，也就是说，不是我们 MNMath 里专门的字段或者是 HtmlMarkdownUtils 类里加的这种评论，虽然它们本质上也是 markdown 评论。

目前的 moveCommentsByPopup 函数的功能是只实现了两层。第一层是 HtmlComment 类型评论的字段，第二层是点击 xx 区“进入了第一层到达第二层”（这里的“进入了第一层”是指获取了这个字段下面的内容，也就是到下一个字段之间的内容。）

然后我们目前可以解析 HtmlMarkdown 评论。但现在有一些还没考虑到的场景：
1. 第二层里没有 HtmlComment 类型评论的字段，而是普通评论
   - 这种情况下就需要能够解析普通评论，从而能够移动内容到这种评论的位置，也就是能精准定位。
2. 如果有 HtmlComment 类型，先解析，然后在现在的基础上进一步处理：
   - 如果两个 HtmlComment 类型 A 和 HtmlComment 评论 B 之间有普通评论，那么 A 的两条（也就是 A 上方和 A 下方）就增加一条，点击后可以“进入 A”，也就是到了第三层，再有一个弹窗，里面的内容是解析的 A 和 B 之间的评论，然后这个时候就只需要有某条“下方”，以及最开始和最下方即可，因为这样已经可以取遍所有index 了
   - 如果 A 和 B 之间没有普通评论，那么就保持只有 A 的两条，也就是 A 上方和 A 下方


## moveCommentsByPopup 触发后的默认效果需要优化
- 不需要关键词（这个有其它函数处理过，你可以学习一下，关键是是不显示“关键词”，但是不要影响“关键词”上面一个和下面一个字段的处理
- 加一个“最后一条评论”按钮，和手动输入“Z”是一个效果，因为我发现我经常移动最后一条评论。
ultrathink

## 选择移动的内容也要继续优化
在选择移动什么内容（也就是第一个弹窗的选项）时，目前能选择的内容只有
- 自动获取
- 手动输入 Index
- 某个具体的字段下方的全部内容

无法更加精细化地选择。目前已经在其它函数里通过弹窗实现了多选。

希望也能像刚刚的提到的那样，进行三层的解析，如果进入到第三层，或者没有 HtmlComment 评论时的第二层，可以通过弹窗选择，也可以多选，多选其实就是涵盖了整个字段的处理。