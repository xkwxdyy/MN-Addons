<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNTask æ•°æ®è¿ç§»å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .port-selector {
            margin-bottom: 30px;
        }
        .port-selector label {
            display: block;
            margin-bottom: 10px;
            color: #555;
            font-weight: 500;
        }
        .port-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        input[type="number"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #5a67d8;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: #48bb78;
        }
        .btn-secondary:hover {
            background: #38a169;
        }
        .btn-danger {
            background: #f56565;
        }
        .btn-danger:hover {
            background: #e53e3e;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .status.show {
            display: block;
        }
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .status.info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }
        .data-info {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .data-info h3 {
            margin-top: 0;
            color: #2d3748;
            font-size: 18px;
        }
        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .data-item:last-child {
            border-bottom: none;
        }
        .data-item strong {
            color: #4a5568;
        }
        .data-item span {
            color: #667eea;
            font-weight: 600;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .action-buttons button {
            flex: 1;
        }
        .note {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .note h4 {
            margin: 0 0 10px 0;
            color: #e67e22;
        }
        .note p {
            margin: 5px 0;
            color: #7f8c8d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ MNTask æ•°æ®è¿ç§»å·¥å…·</h1>
        <p class="subtitle">å°†ä½ çš„ä»»åŠ¡æ•°æ®ä»æµè§ˆå™¨å­˜å‚¨è¿ç§»åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</p>

        <div class="note">
            <h4>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h4>
            <p>1. è¾“å…¥ä½ ä¹‹å‰ä½¿ç”¨çš„ç«¯å£å·ï¼ˆå¦‚ 3000 æˆ– 3001ï¼‰</p>
            <p>2. ç‚¹å‡»"æ£€æŸ¥æ•°æ®"æŸ¥çœ‹è¯¥ç«¯å£çš„å­˜å‚¨æ•°æ®</p>
            <p>3. å¦‚æœæœ‰æ•°æ®ï¼Œç‚¹å‡»"å¯¼å‡ºä¸ºJSON"ä¿å­˜å¤‡ä»½</p>
            <p>4. æ–°ç³»ç»Ÿä¼šè‡ªåŠ¨ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ•°æ®</p>
        </div>

        <div class="port-selector">
            <label for="port">é€‰æ‹©ç«¯å£å·ï¼š</label>
            <div class="port-input">
                <input type="number" id="port" value="3001" min="3000" max="9999">
                <button class="btn" onclick="checkData()">æ£€æŸ¥æ•°æ®</button>
            </div>
        </div>

        <div id="dataInfo" class="data-info" style="display: none;">
            <h3>ğŸ“Š å‘ç°çš„æ•°æ®</h3>
            <div class="data-item">
                <strong>ç„¦ç‚¹ä»»åŠ¡ï¼š</strong>
                <span id="tasksCount">0</span>
            </div>
            <div class="data-item">
                <strong>å¾…å¤„ç†ä»»åŠ¡ï¼š</strong>
                <span id="pendingCount">0</span>
            </div>
            <div class="data-item">
                <strong>æ‰€æœ‰ä»»åŠ¡ï¼š</strong>
                <span id="allTasksCount">0</span>
            </div>
            <div class="data-item">
                <strong>é€è§†é…ç½®ï¼š</strong>
                <span id="perspectivesCount">0</span>
            </div>
        </div>

        <div class="action-buttons" id="actionButtons" style="display: none;">
            <button class="btn btn-secondary" onclick="exportData()">
                ğŸ’¾ å¯¼å‡ºä¸ºJSON
            </button>
            <button class="btn btn-danger" onclick="clearData()">
                ğŸ—‘ï¸ æ¸…é™¤æ—§æ•°æ®
            </button>
        </div>

        <div id="status" class="status"></div>

        <script>
            let currentData = null;

            function checkData() {
                const port = document.getElementById('port').value;
                const baseUrl = `http://localhost:${port}`;
                
                // Create an iframe to access localStorage of specific port
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = `${baseUrl}/`;
                
                showStatus('info', `æ­£åœ¨è¿æ¥åˆ°ç«¯å£ ${port}...`);
                
                // Since we can't directly access localStorage across ports,
                // we'll provide instructions and manual export
                setTimeout(() => {
                    showManualInstructions(port);
                }, 1000);
            }

            function showManualInstructions(port) {
                const dataInfo = document.getElementById('dataInfo');
                const actionButtons = document.getElementById('actionButtons');
                
                showStatus('info', 
                    `<strong>æ‰‹åŠ¨å¯¼å‡ºæ­¥éª¤ï¼š</strong><br>
                    1. åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ <a href="http://localhost:${port}" target="_blank">http://localhost:${port}</a><br>
                    2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)<br>
                    3. è¿›å…¥ Console æ§åˆ¶å°<br>
                    4. å¤åˆ¶å¹¶è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š`
                );

                // Show export code
                const exportCode = `
// å¤åˆ¶è¿™æ®µä»£ç åˆ°æ§åˆ¶å°è¿è¡Œ
(function exportMNTaskData() {
    const data = {
        tasks: localStorage.getItem('mntask-tasks'),
        pendingTasks: localStorage.getItem('mntask-pending'),
        allTasks: localStorage.getItem('mntask-all-tasks'),
        perspectives: localStorage.getItem('mntask-perspectives'),
        exportDate: new Date().toISOString(),
        sourcePort: ${port}
    };
    
    // Parse and count
    let tasksCount = 0, pendingCount = 0, allCount = 0, perspectivesCount = 0;
    
    try {
        if (data.tasks) tasksCount = JSON.parse(data.tasks).length;
        if (data.pendingTasks) pendingCount = JSON.parse(data.pendingTasks).length;
        if (data.allTasks) allCount = JSON.parse(data.allTasks).length;
        if (data.perspectives) perspectivesCount = JSON.parse(data.perspectives).length;
    } catch (e) {}
    
    console.log(\`æ‰¾åˆ°æ•°æ®ï¼šç„¦ç‚¹ä»»åŠ¡ \${tasksCount} ä¸ªï¼Œå¾…å¤„ç†ä»»åŠ¡ \${pendingCount} ä¸ªï¼Œæ€»ä»»åŠ¡ \${allCount} ä¸ªï¼Œé€è§† \${perspectivesCount} ä¸ª\`);
    
    // Create download
    const jsonStr = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonStr], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = \`mntask-port-\${${port}}-backup-\${new Date().toISOString().slice(0,10)}.json\`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    console.log('âœ… æ•°æ®å·²å¯¼å‡ºï¼è¯·æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶å¤¹');
    return data;
})();
                `;

                // Add code block to status
                const statusEl = document.getElementById('status');
                statusEl.innerHTML += `
                    <pre style="background: #2d3748; color: #fff; padding: 15px; border-radius: 8px; margin-top: 15px; overflow-x: auto; font-size: 12px;">${exportCode}</pre>
                    <p style="margin-top: 15px;">5. è¿è¡Œåä¼šè‡ªåŠ¨ä¸‹è½½ JSON æ–‡ä»¶</p>
                    <p>6. å°†ä¸‹è½½çš„æ–‡ä»¶ä¿å­˜åˆ°å®‰å…¨çš„ä½ç½®ä½œä¸ºå¤‡ä»½</p>
                `;
            }

            function showStatus(type, message) {
                const status = document.getElementById('status');
                status.className = `status show ${type}`;
                status.innerHTML = message;
            }

            function exportData() {
                if (!currentData) {
                    showStatus('error', 'æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                    return;
                }

                const jsonStr = JSON.stringify(currentData, null, 2);
                const blob = new Blob([jsonStr], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mntask-migration-${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showStatus('success', 'âœ… æ•°æ®å·²å¯¼å‡ºï¼è¯·æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶å¤¹');
            }

            function clearData() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ—§çš„æµè§ˆå™¨å­˜å‚¨æ•°æ®å—ï¼Ÿå»ºè®®å…ˆå¯¼å‡ºå¤‡ä»½ï¼')) {
                    const port = document.getElementById('port').value;
                    showStatus('info', 
                        `è¯·åœ¨ http://localhost:${port} çš„æ§åˆ¶å°è¿è¡Œï¼š<br>
                        <code>localStorage.clear(); console.log("æ•°æ®å·²æ¸…é™¤");</code>`
                    );
                }
            }
        </script>
    </div>
</body>
</html>