# âœ… MN-Addon é¡¹ç›®å¼€å‘è§„èŒƒ

> æœ¬è§„èŒƒé€‚ç”¨äº MN-Addon é¡¹ç›®çš„å…¨éƒ¨å¼€å‘ä»»åŠ¡ï¼Œæ¡æ¬¾ä¸ºå¼ºåˆ¶æ€§ï¼Œé™¤éç”¨æˆ·æ˜¾å¼è±å…ã€‚
> å¦‚æœä½ å·²ç»äº†è§£æ‰€æœ‰çš„è§„èŒƒï¼Œä½ éœ€è¦åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿›è¡Œå¯¹è¯æ—¶å…ˆè¯´æ˜ "æˆ‘å·²å……åˆ†äº†è§£ MN-Addon é¡¹ç›®çš„å¼€å‘ä¸åä½œè§„èŒƒã€‚"ï¼Œéšåå†æ‰§è¡Œç”¨æˆ·éœ€æ±‚ã€‚

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#ğŸ“Œ-é¡¹ç›®æ¦‚è¿°)
2. [å¼€å‘åŸåˆ™](#ğŸ¯-å¼€å‘åŸåˆ™)
3. [MarginNote4 æ ¸å¿ƒæ¦‚å¿µ](#ğŸ“š-marginnote4-æ ¸å¿ƒæ¦‚å¿µ)
4. [æŠ€æœ¯æ ˆ](#ğŸ”§-æŠ€æœ¯æ ˆ)
5. [å­é¡¹ç›®è§„èŒƒ](#ğŸ“‹-å­é¡¹ç›®è§„èŒƒ)
6. [å¿«é€Ÿå¼€å§‹](#ğŸš€-å¿«é€Ÿå¼€å§‹)
7. [ä»£ç è§„èŒƒ](#ğŸ“-ä»£ç è§„èŒƒ)
8. [è°ƒè¯•æŠ€å·§](#ğŸ”-è°ƒè¯•æŠ€å·§)
9. [è´¡çŒ®æŒ‡å—](#ğŸ¤-è´¡çŒ®æŒ‡å—)
10. [æ’ä»¶ç”Ÿå‘½å‘¨æœŸ](#ğŸ”„-æ’ä»¶ç”Ÿå‘½å‘¨æœŸ)
11. [ç›¸å…³èµ„æº](#ğŸ“š-ç›¸å…³èµ„æº)

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

MN-Addon æ˜¯ MarginNote æ’ä»¶å¼€å‘çš„ç»¼åˆé¡¹ç›®ï¼ŒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒå­é¡¹ç›®ï¼š

1. **MNToolbar** - å¢å¼ºç‰ˆå·¥å…·æ æ’ä»¶ï¼Œæä¾›ä¸°å¯Œçš„è‡ªå®šä¹‰æŒ‰é’®å’Œå¿«æ·æ“ä½œ
2. **MNUtils** - æ ¸å¿ƒ API æ¡†æ¶å’Œæ’ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæ˜¯æ•´ä¸ª MarginNote æ’ä»¶ç”Ÿæ€çš„åŸºç¡€è®¾æ–½

### é¡¹ç›®ç»“æ„
```
MN-Addon/
â”œâ”€â”€ CLAUDE.md                    # æœ¬æ–‡æ¡£ - é¡¹ç›®æ€»ä½“å¼€å‘è§„èŒƒ
â”œâ”€â”€ MARGINNOTE4_CONCEPTS.md      # MarginNote 4 æ ¸å¿ƒæ¦‚å¿µ
â”œâ”€â”€ MNUTILS_API_GUIDE.md         # MNUtils API ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ mntoolbar/                   # å·¥å…·æ æ’ä»¶é¡¹ç›®
â”‚   â”œâ”€â”€ CLAUDE.md                # MNToolbar ä¸“ç”¨å¼€å‘è§„èŒƒ
â”‚   â”œâ”€â”€ mntoolbar/               # ç”¨æˆ·å¼€å‘ç‰ˆæœ¬
â”‚   â””â”€â”€ mntoolbar_official/      # å®˜æ–¹å‚è€ƒç‰ˆæœ¬
â””â”€â”€ mnutils/                     # æ ¸å¿ƒæ¡†æ¶é¡¹ç›®
    â”œâ”€â”€ CLAUDE.md                # MNUtils ä¸“ç”¨å¼€å‘æŒ‡å—
    â”œâ”€â”€ mnutils.js               # æ ¸å¿ƒ API (6,878è¡Œ)
    â””â”€â”€ xdyyutils.js             # å­¦æœ¯æ‰©å±• API (6,175è¡Œ)
```

## ğŸ¯ å¼€å‘åŸåˆ™

### æ ¸å¿ƒåŸåˆ™

1. **æ·±åº¦ç†è§£**ï¼šæ¯æ¬¡è¾“å‡ºå‰å¿…é¡»æ·±åº¦ç†è§£é¡¹ç›®èƒŒæ™¯ã€ç”¨æˆ·æ„å›¾å’ŒæŠ€æœ¯æ ˆç‰¹å¾
2. **æƒå¨å‚è€ƒ**ï¼šå½“ä¿¡æ¯ä¸ç¡®å®šæ—¶ï¼Œå…ˆæŸ¥è¯¢æƒå¨èµ„æ–™ï¼ˆå®˜æ–¹æ–‡æ¡£ã€æ ‡å‡†æˆ–æºç ï¼‰
3. **ç²¾ç¡®å›ç­”**ï¼šä»…å›ç­”ä¸é—®é¢˜ç›´æ¥ç›¸å…³å†…å®¹ï¼Œé¿å…å†—ä½™å’Œæ•™ç¨‹å¼é“ºé™ˆ
4. **ä»»åŠ¡åˆ†è§£**ï¼šé¢å¯¹å¤æ‚éœ€æ±‚ï¼Œæ‹†åˆ†ä¸ºå¯ç®¡ç†çš„å­ä»»åŠ¡

### âš ï¸ ä¸¥ç¦æ“…è‡ªä¿®æ”¹ç”¨æˆ·å†…å®¹ï¼ˆæå…¶é‡è¦ï¼‰

**ç»å¯¹ç¦æ­¢æ“…è‡ªç”Ÿæˆå†…å®¹æ›¿æ¢ç”¨æˆ·çš„åŸå§‹å†…å®¹ï¼**

åœ¨è¿›è¡Œä»»ä½•ä»£ç è§£è€¦ã€é‡æ„ã€è¿ç§»æˆ–æ•´ç†å·¥ä½œæ—¶ï¼š

1. **å¿…é¡»ä¸¥æ ¼å¤åˆ¶åŸå§‹å†…å®¹**ï¼š
   - ä» git å†å²ã€ç°æœ‰æ–‡ä»¶æˆ–ç”¨æˆ·æä¾›çš„å†…å®¹ä¸­é€å­—å¤åˆ¶
   - ä¿æŒæ‰€æœ‰æ³¨é‡Šã€ç©ºè¡Œã€æ ¼å¼å®Œå…¨ä¸€è‡´
   - å³ä½¿æ˜¯è¢«æ³¨é‡Šæ‰çš„ä»£ç ä¹Ÿå¿…é¡»ä¿ç•™

2. **ç¦æ­¢è‡ªåˆ›æˆ–ç®€åŒ–**ï¼š
   - ä¸å¾—ç®€åŒ–èœå•ç»“æ„æˆ–åˆ å‡èœå•é¡¹
   - ä¸å¾—æ”¹å˜å‡½æ•°å‚æ•°æˆ–é»˜è®¤å€¼
   - ä¸å¾—"ä¼˜åŒ–"ä»£ç æˆ–æ”¹è¿›å‘½å
   - ä¸å¾—åˆ é™¤çœ‹ä¼¼"æ— ç”¨"çš„ä»£ç 

3. **ä¿æŒå®Œæ•´æ€§**ï¼š
   - æ¯ä¸ªèœå•é¡¹ã€æ¯ä¸ªæŒ‰é’®é…ç½®ã€æ¯ä¸ªå‚æ•°éƒ½å¿…é¡»å®Œæ•´ä¿ç•™
   - ä¿æŒåŸæœ‰çš„å±‚çº§ç»“æ„å’Œé¡ºåº
   - ä¿æŒåŸæœ‰çš„ä¸­è‹±æ–‡å†…å®¹ã€emoji ç­‰

4. **é‡åˆ°ä¸ç¡®å®šç«‹å³è¯¢é—®**ï¼š
   - å¦‚æœæŸä¸ªéƒ¨åˆ†ä¸æ¸…æ¥šæˆ–ç¼ºå¤±ï¼Œå¿…é¡»è¯¢é—®ç”¨æˆ·
   - ä¸å¾—è‡ªè¡Œæ¨æµ‹æˆ–å¡«å……å†…å®¹
   - ä¸å¾—åŸºäº"å¸¸è§åšæ³•"æ¥è¡¥å……

**è¿åæ­¤åŸåˆ™ä¼šå¯¼è‡´åŠŸèƒ½ä¸¢å¤±ã€ç”¨æˆ·å·¥ä½œè¢«ç ´åï¼Œæ˜¯ç»å¯¹ä¸å¯æ¥å—çš„é”™è¯¯ã€‚**

### âš ï¸ JSB æ¡†æ¶ self å¼•ç”¨è§„èŒƒï¼ˆæå…¶é‡è¦ï¼‰

**ç»å¯¹ç¦æ­¢åœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ `var self = this` æˆ– `let self = this`ï¼**

åœ¨ JSB æ¡†æ¶ä¸­ï¼Œ`this` çš„è¡Œä¸ºä¸æ ‡å‡† JavaScript ä¸åŒï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š

1. **æ­£ç¡®åšæ³•**ï¼š
   ```javascript
   // æ–‡ä»¶é¡¶éƒ¨å®šä¹‰è·å–å®ä¾‹å‡½æ•°
   const getControllerName = () => self
   
   // åœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨
   viewDidLoad: function() {
     let self = getControllerName()  // âœ… æ­£ç¡®
     // ... ä½¿ç”¨ self
   }
   ```

2. **é”™è¯¯åšæ³•**ï¼š
   ```javascript
   viewDidLoad: function() {
     var self = this  // âŒ é”™è¯¯ï¼åœ¨ JSB æ¡†æ¶ä¸­ä¸èµ·ä½œç”¨
     let self = this  // âŒ é”™è¯¯ï¼åŒæ ·ä¸èµ·ä½œç”¨
   }
   ```

3. **å‚è€ƒç¤ºä¾‹**ï¼ˆæ¥è‡ª mnaiï¼‰ï¼š
   - webviewController.js: `const getChatglmController = ()=>self`
   - æ‰€æœ‰æ–¹æ³•å†…éƒ¨éƒ½ä½¿ç”¨ï¼š`let self = getChatglmController()`

**è®°ä½**ï¼šè¿™ä¸ªé”™è¯¯å·²ç»è¢«é‡å¤çŠ¯äº†å¤šæ¬¡ï¼Œå¿…é¡»å½»åº•é¿å…ï¼æ¯æ¬¡åœ¨ JSB.defineClass çš„æ–¹æ³•ä¸­éœ€è¦å¼•ç”¨å®ä¾‹æ—¶ï¼Œéƒ½å¿…é¡»ä½¿ç”¨è·å–å®ä¾‹å‡½æ•°çš„æ–¹å¼ã€‚

## ğŸ“š MarginNote4 æ ¸å¿ƒæ¦‚å¿µ

### æ–‡æ¡£ä¸ç¬”è®°ç³»ç»Ÿ

#### ç³»ç»Ÿå±‚çº§ç»“æ„
```
å­¦ä¹ é›† (Study Set)
  â””â”€â”€ ç¬”è®°æœ¬ (Notebook)
      â””â”€â”€ ç¬”è®° (Note)
          â”œâ”€â”€ æ‘˜å½• (Excerpt)
          â”œâ”€â”€ è¯„è®º (Comments)
          â”‚   â”œâ”€â”€ æ–‡æœ¬è¯„è®º
          â”‚   â”œâ”€â”€ å›¾ç‰‡è¯„è®º
          â”‚   â”œâ”€â”€ æ‰‹å†™è¯„è®º
          â”‚   â””â”€â”€ é“¾æ¥è¯„è®º
          â”œâ”€â”€ æ ‡ç­¾ (Tags)
          â””â”€â”€ å­ç¬”è®° (Child Notes)
```

#### ç¬”è®°ç±»å‹
1. **æ‘˜å½•ç¬”è®°**ï¼šä»æ–‡æ¡£ä¸­é€‰æ‹©æ–‡æœ¬æˆ–å›¾ç‰‡åˆ›å»ºï¼Œä¿ç•™åŸæ–‡ä½ç½®
2. **è„‘å›¾ç¬”è®°**ï¼šç‹¬ç«‹åˆ›å»ºï¼Œç”¨äºçŸ¥è¯†æ•´ç†
3. **å¡ç‰‡ç¬”è®°**ï¼šç”¨äºè®°å¿†å’Œå¤ä¹ ï¼Œæ”¯æŒæ­£åé¢è®¾è®¡

#### å­¦ä¹ æ¨¡å¼
1. **æ–‡æ¡£æ¨¡å¼**ï¼šé˜…è¯»å’Œæ ‡æ³¨æ–‡æ¡£
2. **å­¦ä¹ æ¨¡å¼**ï¼šæ–‡æ¡£ + è„‘å›¾åŒå±æ˜¾ç¤º
3. **å¤ä¹ æ¨¡å¼**ï¼šé—´éš”é‡å¤ç®—æ³•ï¼Œå¡ç‰‡å¼å¤ä¹ 

### é¢œè‰²ç³»ç»Ÿ
MarginNote4 ä½¿ç”¨ 16 è‰²ç´¢å¼•ç³»ç»Ÿï¼ˆ0-15ï¼‰ï¼Œä»æ·¡é»„è‰²åˆ°ç´«è‰²çš„å®Œæ•´è‰²è°±ã€‚

## ğŸ”§ æŠ€æœ¯æ ˆ

### JSB æ¡†æ¶
- MarginNote åŸºäº JSBox çš„ JavaScript è¿è¡Œæ—¶
- æ”¯æŒåŸç”Ÿ iOS/macOS API è°ƒç”¨
- ç‰¹æ®Šçš„ç±»å®šä¹‰è¯­æ³•ï¼š`JSB.defineClass`

### æ ¸å¿ƒæŠ€æœ¯
- JavaScript (ES6+)
- Objective-C Bridge
- UIKit/AppKit
- WebView (HTML/CSS)

### API ä½¿ç”¨æ³¨æ„äº‹é¡¹

#### âš ï¸ API ä½¿ç”¨ä»¥æºç ä¸ºå‡†ï¼ˆæå…¶é‡è¦ï¼‰

**è™½ç„¶ `mnutils/MNUTILS_API_GUIDE.md` æ–‡æ¡£å¾ˆæœ‰å‚è€ƒä»·å€¼ï¼Œä½†ä¸€åˆ‡ä»¥å®é™…æºç  `mnutils.js` å’Œ `xdyyutils.js` ä¸ºå‡†ï¼**

æ–‡æ¡£å¯èƒ½å­˜åœ¨ä»¥ä¸‹æƒ…å†µï¼š
- é—æ¼æŸäº›æ–¹æ³•ï¼ˆå¦‚ `getIncludingCommentIndex`ï¼‰
- æ–¹æ³•åç§°æˆ–å‚æ•°æœ‰è¯¯
- ç‰ˆæœ¬æ›´æ–°åæ–‡æ¡£æœªåŠæ—¶åŒæ­¥

æ­£ç¡®çš„ API ä½¿ç”¨æµç¨‹ï¼š
1. å…ˆæŸ¥é˜…æ–‡æ¡£äº†è§£å¤§æ¦‚
2. **åœ¨æºç ä¸­æœç´¢ç¡®è®¤æ–¹æ³•æ˜¯å¦å­˜åœ¨**
3. æŸ¥çœ‹æ–¹æ³•çš„å®é™…å®ç°å’Œå‚æ•°

ç¤ºä¾‹ï¼šæŸ¥æ‰¾åŒ…å«ç‰¹å®šæ–‡æœ¬çš„è¯„è®º
```javascript
// æ–‡æ¡£ä¸­å¯èƒ½æ²¡æœ‰æåˆ°ï¼Œä½† xdyyutils.js ä¸­å­˜åœ¨
const index = note.getIncludingCommentIndex("çŠ¶æ€ï¼š");  // âœ… æ­£ç¡®

// å…¶ä»–å¯ç”¨çš„æ–¹æ³•ï¼ˆåœ¨ xdyyutils.js ä¸­ï¼‰
note.getIncludingHtmlCommentIndex("å­—æ®µå")  // æŸ¥æ‰¾åŒ…å«æ–‡æœ¬çš„ HTML è¯„è®º
note.getTextCommentsIndexArr("å®Œæ•´æ–‡æœ¬")     // è·å–æ‰€æœ‰åŒ¹é…çš„æ–‡æœ¬è¯„è®ºç´¢å¼•æ•°ç»„
```

**è®°ä½**ï¼šæºç æ˜¯æœ€ç»ˆçš„çœŸç›¸ï¼é‡åˆ°é—®é¢˜æ—¶ç›´æ¥åœ¨ `mnutils.js` å’Œ `xdyyutils.js` ä¸­æœç´¢ã€‚

### JavaScript è¯­æ³•æ”¯æŒ

åŸºäºå¯¹ mnutilsã€mntoolbar å’Œ mnai æºç çš„æ·±å…¥åˆ†æï¼ŒJSBox/JSB æ¡†æ¶å®Œå…¨æ”¯æŒç°ä»£ ES6+ è¯­æ³•ç‰¹æ€§ï¼š

#### æ”¯æŒçš„è¯­æ³•ç‰¹æ€§

**å˜é‡å£°æ˜**
```javascript
const note = MNNote.getFocusNote()  // å¸¸é‡å£°æ˜
let cache = {}                       // å¯å˜å˜é‡
```

**ç®­å¤´å‡½æ•°**
```javascript
// å•è¡Œç®­å¤´å‡½æ•°
const doubled = arr.map(x => x * 2)

// å¤šè¡Œç®­å¤´å‡½æ•°
const processNote = (note) => {
  note.colorIndex = 2
  return note
}
```

**æ¨¡æ¿å­—ç¬¦ä¸²**
```javascript
MNUtil.log(`ç¬”è®°æ ‡é¢˜: ${note.noteTitle}`)
const message = `å¤„ç†äº† ${count} ä¸ªç¬”è®°`
```

**ç±»è¯­æ³•**
```javascript
class MNMath {
  static types = {
    å®šä¹‰: { colorIndex: 2 }
  }
  
  constructor() {
    this.name = "MNMath"
  }
}
```

**å¼‚æ­¥ç¼–ç¨‹**
```javascript
// async/await
notebookWillOpen: async function(notebookId) {
  await chatAIUtils.checkMNUtil(true)
  const result = await fetchData()
}

// Promise
MNUtil.delay(1).then(() => {
  // å»¶è¿Ÿæ‰§è¡Œ
})
```

**è§£æ„èµ‹å€¼**
```javascript
const {title, content} = note
const [first, second] = array
```

**æ‰©å±•è¿ç®—ç¬¦**
```javascript
const newArray = [...oldArray]
const merged = {...obj1, ...obj2}
const unique = [...new Set(array)]
```

**é»˜è®¤å‚æ•°**
```javascript
function createNote(title = "æœªå‘½å", color = 0) {
  // å‡½æ•°ä½“
}
```

**ç°ä»£æ•°ç»„æ–¹æ³•**
```javascript
notes.filter(n => n.colorIndex === 2)
     .map(n => n.noteTitle)
     .forEach(title => console.log(title))

const found = notes.find(n => n.noteId === id)
const hasNote = notes.includes(targetNote)
```

**ç°ä»£å¯¹è±¡æ–¹æ³•**
```javascript
Object.keys(obj).forEach(key => {})
Object.values(obj)
Object.entries(obj)
Object.assign(target, source)
```

#### æ³¨æ„äº‹é¡¹

1. **ä¸è¦å› ä¸ºè¯­æ³•æŠ¥é”™è€Œç›²ç›®ä¿®æ”¹**ï¼šå¦‚æœé‡åˆ°çœ‹ä¼¼"è¯­æ³•é”™è¯¯"ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦æ˜¯ API ä½¿ç”¨é—®é¢˜
2. **ä¼˜å…ˆä½¿ç”¨ç°ä»£è¯­æ³•**ï¼šæ—¢ç„¶æ”¯æŒ ES6+ï¼Œåº”è¯¥å……åˆ†åˆ©ç”¨è¿™äº›ç‰¹æ€§æ¥ç¼–å†™æ›´ç®€æ´çš„ä»£ç 
3. **ä¸åŸç”Ÿ API ç»“åˆ**ï¼šè™½ç„¶æ”¯æŒç°ä»£ JSï¼Œä½†ä»éœ€è¦é€šè¿‡ JSB æ¡¥æ¥è°ƒç”¨åŸç”Ÿ API

## ğŸ“‹ å­é¡¹ç›®è§„èŒƒ

### MNToolbar é¡¹ç›®

MNToolbar æ˜¯ä¸€ä¸ªé«˜åº¦å¯å®šåˆ¶çš„å·¥å…·æ æ’ä»¶ï¼Œé‡‡ç”¨è§£è€¦æ¶æ„è®¾è®¡ï¼š

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- è‡ªå®šä¹‰æŒ‰é’®å’Œèœå•ç³»ç»Ÿ
- æ³¨å†Œè¡¨æ¨¡å¼çš„è§£è€¦æ¶æ„
- æ”¯æŒ macOS å’Œ iOS åŒå¹³å°
- ä¸°å¯Œçš„å¿«æ·æ“ä½œé›†åˆ

**å¼€å‘è¦ç‚¹**ï¼š
- æŸ¥çœ‹ `mntoolbar/CLAUDE.md` è·å–è¯¦ç»†å¼€å‘è§„èŒƒ
- ä½¿ç”¨ `xdyy_` å‰ç¼€çš„æ–‡ä»¶è¿›è¡ŒåŠŸèƒ½æ‰©å±•
- ä¸è¦ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶ï¼ˆmain.js, utils.js ç­‰ï¼‰

### MNUtils é¡¹ç›®

MNUtils æ˜¯æ•´ä¸ª MarginNote æ’ä»¶ç”Ÿæ€çš„åŸºç¡€è®¾æ–½ï¼š

**åŒé‡èº«ä»½**ï¼š
1. **æ’ä»¶ç®¡ç†ç³»ç»Ÿ**ï¼šè®¢é˜…ç®¡ç†ã€æ’ä»¶å•†åº—ã€æ›´æ–°ç®¡ç†
2. **API æ¡†æ¶**ï¼šä¸ºå…¶ä»–æ’ä»¶æä¾› 300+ æ ¸å¿ƒ API

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `mnutils.js`ï¼š9 ä¸ªæ ¸å¿ƒç±»ï¼Œ304+ API æ–¹æ³•
- `xdyyutils.js`ï¼šå­¦æœ¯æ‰©å±•ï¼ŒMNMath æ•°å­¦å¡ç‰‡ç³»ç»Ÿ
- è®¢é˜…å’Œç½‘ç»œç®¡ç†ç³»ç»Ÿ

#### MNUtils æ ¸å¿ƒç±»æ¦‚è§ˆ

| ç±»å | åŠŸèƒ½æè¿° | ä¸»è¦ç”¨é€” |
|------|----------|----------|
| **Menu** | å¼¹å‡ºèœå•ç»„ä»¶ | åˆ›å»ºè‡ªå®šä¹‰å³é”®èœå• |
| **MNUtil** | æ ¸å¿ƒå·¥å…·ç±» | ç³»ç»ŸåŠŸèƒ½ã€UIäº¤äº’ã€æ–‡ä»¶æ“ä½œç­‰ |
| **MNConnection** | ç½‘ç»œè¯·æ±‚ | HTTPè¯·æ±‚ã€WebDAVã€WebViewæ§åˆ¶ |
| **MNButton** | æŒ‰é’®ç»„ä»¶ | åˆ›å»ºè‡ªå®šä¹‰UIæŒ‰é’® |
| **MNDocument** | æ–‡æ¡£æ“ä½œ | PDF/ePubæ–‡æ¡£ç®¡ç† |
| **MNNotebook** | ç¬”è®°æœ¬ç®¡ç† | å­¦ä¹ é›†å’Œç¬”è®°æœ¬æ“ä½œ |
| **MNNote** | ç¬”è®°æ ¸å¿ƒç±» | ç¬”è®°çš„åˆ›å»ºã€ä¿®æ”¹ã€æŸ¥è¯¢ç­‰ |
| **MNComment** | è¯„è®ºç®¡ç† | å„ç±»è¯„è®ºçš„æ·»åŠ å’Œç®¡ç† |
| **MNExtensionPanel** | æ’ä»¶é¢æ¿ | æ§åˆ¶æ’ä»¶UIé¢æ¿ |

#### å­¦æœ¯æ‰©å±• - MNMath
æä¾›13ç§çŸ¥è¯†å¡ç‰‡ç±»å‹ï¼Œä¸“ä¸ºæ•°å­¦å’Œå­¦æœ¯ç ”ç©¶è®¾è®¡ï¼š
- å®šä¹‰ã€å‘½é¢˜ã€ä¾‹å­ã€åä¾‹ï¼ˆçŸ¥è¯†ç»“æ„ç±»ï¼‰
- ä½œè€…ã€è®ºæ–‡ã€ç ”ç©¶è¿›å±•ï¼ˆæ–‡çŒ®ç®¡ç†ç±»ï¼‰
- æ™ºèƒ½åˆ¶å¡ã€æ‰¹é‡å¤„ç†ã€æ¨¡æ¿ç®¡ç†

**å¼€å‘è¦ç‚¹**ï¼š
- æŸ¥çœ‹ `mnutils/CLAUDE.md` è·å–è¯¦ç»†å¼€å‘æŒ‡å—
- API å¼€å‘éµå¾ªå‘åå…¼å®¹åŸåˆ™
- æ–°åŠŸèƒ½ä¼˜å…ˆè€ƒè™‘æ‰©å±•è€Œéä¿®æ”¹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç†è§£é¡¹ç›®æ¶æ„
```bash
# å…ˆé˜…è¯»é¡¹ç›®æ–‡æ¡£
1. é˜…è¯»æœ¬æ–‡æ¡£ï¼ˆCLAUDE.mdï¼‰
2. é˜…è¯» MARGINNOTE4_CONCEPTS.md ç†è§£æ ¸å¿ƒæ¦‚å¿µ
3. æ ¹æ®éœ€æ±‚é˜…è¯»å¯¹åº”å­é¡¹ç›®çš„ CLAUDE.md
```

### 2. é€‰æ‹©å¼€å‘æ–¹å‘

#### å¼€å‘å·¥å…·æ åŠŸèƒ½
```javascript
// åœ¨ mntoolbar é¡¹ç›®ä¸­
// 1. åœ¨ xdyy_button_registry.js æ³¨å†ŒæŒ‰é’®
// 2. åœ¨ xdyy_menu_registry.js å®šä¹‰èœå•
// 3. åœ¨ xdyy_custom_actions_registry.js å®ç°åŠŸèƒ½
```

#### ä½¿ç”¨ MNUtils API
```javascript
// åœ¨ä»»ä½• MarginNote æ’ä»¶ä¸­
JSB.require('mnutils')

// åˆå§‹åŒ–ï¼ˆå¿…é¡»ï¼‰
MNUtil.init(self.path)

// è·å–ç„¦ç‚¹ç¬”è®°
const note = MNNote.getFocusNote()
if (note) {
  // ä¿®æ”¹ç¬”è®°
  MNUtil.undoGrouping(() => {
    note.noteTitle = "æ–°æ ‡é¢˜"
    note.appendTextComment("æ·»åŠ è¯„è®º")
    note.colorIndex = 2  // è®¾ç½®ä¸ºæ·¡è“è‰²
  })
}

// UI äº¤äº’
MNUtil.showHUD("æ“ä½œå®Œæˆï¼")

// å¼¹å‡ºé€‰æ‹©èœå•
const menu = new Menu(button, self, 250)
menu.addMenuItem("å¤åˆ¶", "copyNote:", note)
menu.addMenuItem("åˆ¶å¡", "makeCard:", note)
menu.show()
```

### 3. è°ƒè¯•å’Œæµ‹è¯•
- ä½¿ç”¨ `MNUtil.log()` è¿›è¡Œæ—¥å¿—è¾“å‡º
- ä½¿ç”¨ Safari Web Inspector è°ƒè¯• WebView
- åœ¨ MN3 å’Œ MN4 ä¸­éƒ½è¦æµ‹è¯•

### 4. æ’ä»¶æ–‡ä»¶ç»“æ„
```
your-plugin/
â”œâ”€â”€ mnaddon.json          # æ’ä»¶é…ç½®æ¸…å•ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ main.js               # æ’ä»¶å…¥å£æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ logo.png              # æ’ä»¶å›¾æ ‡
â”œâ”€â”€ utils.js              # å·¥å…·å‡½æ•°
â”œâ”€â”€ resources/            # èµ„æºæ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ images/           # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ html/             # HTML æ–‡ä»¶
â””â”€â”€ lib/                  # ç¬¬ä¸‰æ–¹åº“
```

### 5. æ’ä»¶æ‰“åŒ…ï¼ˆæå…¶é‡è¦ï¼‰

#### âš ï¸ é”™è¯¯çš„æ‰“åŒ…æ–¹å¼ï¼ˆä¼šå¯¼è‡´æ’ä»¶æ— æ³•åŠ è½½ç”šè‡³é—ªé€€ï¼‰
```bash
# âŒ é”™è¯¯ï¼šä»å¤–éƒ¨ç›®å½•å‹ç¼©ï¼Œä¼šåŒ…å«æ–‡ä»¶å¤¹è·¯å¾„
zip ../plugin.mnaddon ../plugin-folder/*

# âŒ é”™è¯¯ï¼šå‹ç¼©æ•´ä¸ªæ–‡ä»¶å¤¹
zip -r plugin.mnaddon plugin-folder/

# âŒ é”™è¯¯ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„
zip plugin.mnaddon ../plugin/main.js ../plugin/mnaddon.json
```

è¿™äº›é”™è¯¯æ–¹å¼ä¼šå¯¼è‡´å‹ç¼©åŒ…å†…çš„æ–‡ä»¶å¸¦æœ‰è·¯å¾„å‰ç¼€ï¼ˆå¦‚ `../plugin/main.js`ï¼‰ï¼ŒMarginNote æ— æ³•æ­£ç¡®è§£æï¼Œå¯èƒ½å¯¼è‡´ï¼š
- æ’ä»¶æ— æ³•åŠ è½½
- æ’ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºä½†æ— æ³•å‹¾é€‰
- ä¸¥é‡æ—¶å¯¼è‡´ MarginNote é—ªé€€

#### âœ… æ­£ç¡®çš„æ‰“åŒ…æ–¹å¼
```bash
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ mnaddon4 å·¥å…·ï¼ˆæ¨èï¼‰
cd your-plugin-folder
mnaddon4 build plugin-name

# æ–¹æ³•äºŒï¼šåœ¨æ’ä»¶ç›®å½•å†…ç›´æ¥å‹ç¼©
cd your-plugin-folder
zip plugin-name.mnaddon main.js mnaddon.json logo.png utils.js
```

#### éªŒè¯æ‰“åŒ…ç»“æœ
```bash
# ä½¿ç”¨ unzip -l æ£€æŸ¥æ–‡ä»¶ç»“æ„
unzip -l plugin-name.mnaddon

# æ­£ç¡®çš„è¾“å‡ºåº”è¯¥æ˜¯ï¼š
Archive:  plugin-name.mnaddon
  Length      Date    Time    Name
---------  ---------- -----   ----
     1234  06-30-2025 18:00   main.js
      567  06-30-2025 18:00   mnaddon.json
     1803  06-30-2025 18:00   logo.png
---------                     -------
     3604                     3 files

# æ³¨æ„ï¼šæ–‡ä»¶åå‰é¢ä¸åº”è¯¥æœ‰ä»»ä½•è·¯å¾„å‰ç¼€ï¼
```

## ğŸ“ ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ
```javascript
// âœ… æ­£ç¡®
const error = new Error()
const focusNote = MNNote.getFocusNote()
let cache, redisCache

// âŒ é”™è¯¯
const e = new Error()
const data = getSomething()
let cache, cache2
```

### æ–‡ä»¶åŠ è½½é¡ºåº
```javascript
// âŒ é”™è¯¯ï¼šåœ¨æ–‡ä»¶å¼€å¤´åŠ è½½æ‰©å±•
JSB.require('extension')
var MyClass = JSB.defineClass(...)

// âœ… æ­£ç¡®ï¼šåœ¨æ–‡ä»¶æœ«å°¾åŠ è½½æ‰©å±•
var MyClass = JSB.defineClass(...)
JSB.require('extension')
```

### é”™è¯¯å¤„ç†
```javascript
try {
  // è¾¹ç•Œæ£€æŸ¥
  if (typeof MNUtil === 'undefined') return
  
  // ä¸šåŠ¡é€»è¾‘
  MNUtil.undoGrouping(() => {
    // æ“ä½œ
  })
} catch (error) {
  MNUtil.addErrorLog(error, "functionName", context)
  MNUtil.showHUD("æ“ä½œå¤±è´¥ï¼š" + error.message)
}
```

### å¹³å°å…¼å®¹
```javascript
const isMac = MNUtil.isMacOS()
if (isMac) {
  // macOS ç‰¹å®šé€»è¾‘
} else {
  // iOS ç‰¹å®šé€»è¾‘
}
```

## ğŸ” è°ƒè¯•æŠ€å·§

### æ—¥å¿—ç³»ç»Ÿ
```javascript
// å¿…é¡»ä½¿ç”¨ MNUtil.log() è€Œä¸æ˜¯ console.log()
if (typeof MNUtil !== "undefined" && MNUtil.log) {
  MNUtil.log("ğŸ”§ åˆå§‹åŒ–å®Œæˆ")
  MNUtil.log("âœ… æ“ä½œæˆåŠŸ")
  MNUtil.log("âŒ é”™è¯¯ï¼š" + error.message)
}
```

### å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| "Can't find variable" | åŠ è½½é¡ºåºé”™è¯¯ | è°ƒæ•´ JSB.require ä½ç½® |
| "undefined is not an object" | å¯¹è±¡æœªåˆå§‹åŒ– | æ·»åŠ å­˜åœ¨æ€§æ£€æŸ¥ |
| æŒ‰é’®ä¸æ˜¾ç¤º | æ³¨å†Œè¡¨æœªåŠ è½½ | æ£€æŸ¥æ–‡ä»¶åŠ è½½é¡ºåº |
| API è°ƒç”¨å¤±è´¥ | MNUtils æœªå®‰è£… | æç¤ºç”¨æˆ·å®‰è£… MNUtils |

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **Fork é¡¹ç›®**
2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**ï¼š`git checkout -b feature/amazing-feature`
3. **æäº¤æ›´æ”¹**ï¼š`git commit -m 'Add amazing feature'`
4. **æ¨é€åˆ†æ”¯**ï¼š`git push origin feature/amazing-feature`
5. **æäº¤ PR**ï¼šè¯¦ç»†æè¿°ä½ çš„æ›´æ”¹

## ğŸ“š ç›¸å…³èµ„æº

### é¡¹ç›®æ–‡æ¡£
- [MNToolbar å¼€å‘è§„èŒƒ](./mntoolbar/CLAUDE.md)
- [MNUtils å¼€å‘æŒ‡å—](./mnutils/CLAUDE.md)
- [MNUtils API æŒ‡å—](./MNUTILS_API_GUIDE.md)
- [MarginNote 4 æ¦‚å¿µ](./MARGINNOTE4_CONCEPTS.md)

### å¤–éƒ¨èµ„æº
- [MarginNote å®˜ç½‘](https://www.marginnote.com/)
- [JSBox æ–‡æ¡£](https://docs.xteko.com/)

## ğŸ”„ æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

ç†è§£ MarginNote æ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯¹å¼€å‘è‡³å…³é‡è¦ï¼š

### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
```javascript
JSB.defineClass("YourPlugin : JSExtension", {
  // 1. åœºæ™¯è¿æ¥æ—¶è°ƒç”¨ï¼ˆæ’ä»¶å¯åŠ¨ï¼‰
  sceneWillConnect: function() {
    // åˆå§‹åŒ–æ’ä»¶
  },
  
  // 2. ç¬”è®°æœ¬æ‰“å¼€æ—¶è°ƒç”¨
  notebookWillOpen: function(notebookId) {
    // ç¬”è®°æœ¬ç›¸å…³åˆå§‹åŒ–
  },
  
  // 3. æ–‡æ¡£æ‰“å¼€æ—¶è°ƒç”¨
  documentDidOpen: function(docMd5) {
    // æ–‡æ¡£ç›¸å…³å¤„ç†
  },
  
  // 4. ç¬”è®°å¼¹å‡ºèœå•
  onPopupMenuOnNote: function(info) {
    // æ·»åŠ è‡ªå®šä¹‰èœå•é¡¹
  },
  
  // 5. é€‰æ‹©åŒºåŸŸå¼¹å‡ºèœå•
  onPopupMenuOnSelection: function(info) {
    // å¤„ç†é€‰æ‹©åŒºåŸŸ
  },
  
  // 6. åœºæ™¯æ–­å¼€æ—¶è°ƒç”¨ï¼ˆæ’ä»¶å…³é—­ï¼‰
  sceneDidDisconnect: function() {
    // æ¸…ç†èµ„æº
  }
})
```

### èµ„æºç®¡ç†
- åœ¨ `sceneDidDisconnect` ä¸­é‡Šæ”¾æ‰€æœ‰èµ„æº
- åŠæ—¶æ¸…ç†å®šæ—¶å™¨ã€ç›‘å¬å™¨å’Œå¤§å¯¹è±¡
- ä¿å­˜ç”¨æˆ·é…ç½®å’ŒçŠ¶æ€

## ğŸ› å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### æ’ä»¶æ— æ³•æ­£å¸¸åŠ è½½ï¼ˆæ’ä»¶åˆ—è¡¨ä¸­æœªå‹¾é€‰ï¼‰

å½“æ’ä»¶å‡ºç°åœ¨åˆ—è¡¨ä¸­ä½†æœªè‡ªåŠ¨å‹¾é€‰æ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸ºä»¥ä¸‹åŸå› ï¼š

0. **æ’ä»¶æ‰“åŒ…é”™è¯¯ï¼ˆæœ€å¸¸è§ï¼‰**
   - é—®é¢˜ï¼šä½¿ç”¨é”™è¯¯çš„æ–¹å¼æ‰“åŒ…å¯¼è‡´æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®
   - ç—‡çŠ¶ï¼šæ’ä»¶å‡ºç°åœ¨åˆ—è¡¨ä½†æ— æ³•å‹¾é€‰ï¼Œä¸¥é‡æ—¶å¯¼è‡´ MarginNote é—ªé€€
   - è§£å†³ï¼šå‚è§ä¸Šé¢çš„"æ’ä»¶æ‰“åŒ…"ç« èŠ‚ï¼Œä½¿ç”¨æ­£ç¡®çš„æ‰“åŒ…æ–¹å¼

1. **MNUtils æ£€æŸ¥å¤±è´¥**
   - é”™è¯¯åšæ³•ï¼šåœ¨æ’ä»¶å¼€å§‹å°±ç›´æ¥ `JSB.require('mnutils')` æˆ–è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥
   - æ­£ç¡®åšæ³•ï¼šè®© MarginNote è‡ªåŠ¨åŠ è½½ MNUtilsï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è¿›è¡Œè¿è¡Œæ—¶æ£€æŸ¥

2. **self å¼•ç”¨é”™è¯¯**
   - é”™è¯¯åšæ³•ï¼šåœ¨æ–¹æ³•å†…ä½¿ç”¨ `let self = this` æˆ– `var self = this`
   - æ­£ç¡®åšæ³•ï¼šå®šä¹‰ `const getInstanceName = () => self`ï¼Œç„¶åä½¿ç”¨ `let self = getInstanceName()`

3. **ç±»å®šä¹‰ vs å®ä¾‹å±æ€§é™·é˜±ï¼ˆæå…¶é‡è¦ï¼‰**
   - é—®é¢˜ï¼šåœ¨ JSB.defineClass ä¸­ç›´æ¥å®šä¹‰å¯¹è±¡å±æ€§å¯¼è‡´è¯¥å±æ€§æˆä¸º"ç±»å±æ€§"è€Œé"å®ä¾‹å±æ€§"
   - ç—‡çŠ¶ï¼šå±æ€§æ˜¾ç¤ºä¸º undefinedï¼Œç‰¹åˆ«æ˜¯å¤§å‹å¯¹è±¡å¦‚ viewManager
   - è§£å†³ï¼šå¿…é¡»åœ¨ prototype ä¸Šå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨å®ä¾‹åŒ–ååˆ›å»ºå¯¹è±¡å±æ€§

4. **ä½œç”¨åŸŸé—®é¢˜**
   - é”™è¯¯ï¼šåœ¨å·¥å…·ç±»ä¸­ç›´æ¥å¼•ç”¨å…¶ä»–æ§åˆ¶å™¨ç±»ï¼ˆå¦‚ `panelController.new()`ï¼‰
   - æ­£ç¡®ï¼šå°†æ§åˆ¶å™¨ç®¡ç†æ–¹æ³•æ”¾åœ¨æ’ä»¶ä¸»ç±»ä¸­ï¼Œæˆ–ç¡®ä¿å¼•ç”¨æ—¶ç±»å·²åŠ è½½

5. **ç”Ÿå‘½å‘¨æœŸæ–¹æ³•é”™è¯¯**
   - é”™è¯¯ï¼šåœ¨ `JSB.defineClass` å†…éƒ¨å®šä¹‰ `init` æ–¹æ³•
   - æ­£ç¡®ï¼šä½¿ç”¨ `prototype.init` æ‰©å±•åŸå‹æ–¹æ³•

6. **èœå•å¤„ç†é”™è¯¯**
   - å§‹ç»ˆæ£€æŸ¥ `sender.userInfo.menuController` æ˜¯å¦å­˜åœ¨
   - å¯¹æ‰€æœ‰å¤–éƒ¨è¾“å…¥è¿›è¡Œé˜²å¾¡æ€§ç¼–ç¨‹

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æ—¥å¿—**
   - ä½¿ç”¨ `MNUtil.log()` è¾“å‡ºè°ƒè¯•ä¿¡æ¯
   - æ£€æŸ¥ MNUtils çš„é”™è¯¯æ—¥å¿—

2. **é”™è¯¯å¤„ç†**
   - åœ¨æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ä½¿ç”¨ try-catch
   - ä½¿ç”¨ `MNUtil.addErrorLog()` è®°å½•é”™è¯¯

3. **ç‰ˆæœ¬ç®¡ç†**
   - æ¯æ¬¡ä¿®æ”¹éƒ½æ›´æ–° `mnaddon.json` ä¸­çš„ç‰ˆæœ¬å·
   - ä¾¿äºè¯†åˆ«åŠ è½½çš„æ˜¯å“ªä¸ªç‰ˆæœ¬

### JSB æ¡†æ¶ç±»å®šä¹‰é™·é˜±ï¼ˆæå…¶é‡è¦ï¼‰

åœ¨ JSB.defineClass ä¸­ç›´æ¥å®šä¹‰å¯¹è±¡å±æ€§ä¼šå¯¼è‡´æ„å¤–çš„é—®é¢˜ã€‚

#### âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆå¯¼è‡´å±æ€§ undefinedï¼‰
```javascript
var MyController = JSB.defineClass('MyController', {
  viewDidLoad: function() {
    let self = getInstance()
    self.manager.doSomething()  // âŒ self.manager æ˜¯ undefinedï¼
  },
  
  // âŒ é”™è¯¯ï¼šè¿™ä¼šæˆä¸ºç±»å±æ€§ï¼Œä¸æ˜¯å®ä¾‹å±æ€§
  manager: {
    doSomething: function() { /* ... */ }
  }
})
```

#### âœ… æ­£ç¡®åšæ³•
```javascript
// 1. åœ¨ prototype ä¸Šå®šä¹‰åˆå§‹åŒ–æ–¹æ³•
MyController.prototype.init = function() {
  this.initManager()  // åˆå§‹åŒ–å®ä¾‹å±æ€§
}

MyController.prototype.initManager = function() {
  this.manager = {  // åˆ›å»ºå®ä¾‹å±æ€§
    doSomething: function() { /* ... */ }
  }
}

// 2. åœ¨ viewDidLoad ä¸­è°ƒç”¨ init
var MyController = JSB.defineClass('MyController', {
  viewDidLoad: function() {
    let self = getInstance()
    self.init()  // åˆå§‹åŒ–
    self.manager.doSomething()  // âœ… ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ
  }
})
```

#### ğŸ’¡ é‡è¦è§„åˆ™
**åœ¨ JSB.defineClass ä¸­ï¼Œåªèƒ½å®šä¹‰æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰ï¼Œä¸èƒ½å®šä¹‰å¯¹è±¡å±æ€§ï¼æ‰€æœ‰å¯¹è±¡å±æ€§å¿…é¡»åœ¨å®ä¾‹åˆå§‹åŒ–æ—¶åˆ›å»ºã€‚**

#### å¸¸è§åº”ç”¨åœºæ™¯
- viewManagerï¼ˆè§†å›¾ç®¡ç†å™¨ï¼‰
- dataManagerï¼ˆæ•°æ®ç®¡ç†å™¨ï¼‰
- eventHandlersï¼ˆäº‹ä»¶å¤„ç†å™¨é›†åˆï¼‰
- configï¼ˆé…ç½®å¯¹è±¡ï¼‰

### æ³¨é‡Šä¸­çš„è¯­æ³•é™·é˜±ï¼ˆæå…¶é‡è¦ï¼‰

åœ¨ JSDoc æˆ–å¤šè¡Œæ³¨é‡Šä¸­åŒ…å«ç¤ºä¾‹ä»£ç æ—¶ï¼Œ**ç»å¯¹ä¸èƒ½åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸­åŒ…å« `*/`**ï¼Œè¿™ä¼šå¯¼è‡´æ³¨é‡Šæå‰ç»“æŸï¼Œå¼•å‘å¤§é‡è¯­æ³•é”™è¯¯ã€‚

#### âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼‰
```javascript
/**
 * @example
 * let template = "/**\n * {{cursor}}\n */\nfunction name() {\n\n}"
 */
```

#### âœ… æ­£ç¡®åšæ³•ï¼ˆè½¬ä¹‰æ³¨é‡Šç»“æŸç¬¦ï¼‰
```javascript
/**
 * @example
 * let template = "/**\\n * {{cursor}}\\n *\\/\\nfunction name() {\\n\\n}"
 */
```

#### ç—‡çŠ¶è¯†åˆ«
- ç¼–è¾‘å™¨çªç„¶æŠ¥å‘Šå¤§é‡è¯­æ³•é”™è¯¯ï¼ˆå¦‚ 270 ä¸ªé”™è¯¯ï¼‰
- é”™è¯¯é›†ä¸­åœ¨æŸä¸ªæ³¨é‡Šå—ä¹‹å
- ä»£ç é«˜äº®æ˜¾ç¤ºå¼‚å¸¸

#### è§£å†³æ–¹æ³•
1. åœ¨æ³¨é‡Šä¸­çš„ç¤ºä¾‹ä»£ç é‡Œï¼Œå°† `*/` æ›¿æ¢ä¸º `*\/`
2. æˆ–è€…é¿å…åœ¨æ³¨é‡Šç¤ºä¾‹ä¸­ä½¿ç”¨åŒ…å«æ³¨é‡Šç¬¦å·çš„å­—ç¬¦ä¸²
3. ä½¿ç”¨ `node -c filename.js` éªŒè¯è¯­æ³•æ­£ç¡®æ€§

### MNMath ç±»å¼€å‘é™·é˜±ï¼ˆå¡ç‰‡ç±»å‹è½¬æ¢ï¼‰

åœ¨å®ç°å¡ç‰‡ç±»å‹è½¬æ¢æ—¶çš„å­—æ®µæ›¿æ¢åŠŸèƒ½æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š

#### åœºæ™¯è¯´æ˜
å½“å¡ç‰‡é€šè¿‡ç§»åŠ¨åˆ°ä¸åŒå½’ç±»å¡ç‰‡ä¸‹æ–¹æ¥æ”¹å˜ç±»å‹æ—¶ï¼ˆå¦‚ä»"ä¾‹å­"è½¬æ¢ä¸º"åä¾‹"ï¼‰ï¼Œéœ€è¦æ›¿æ¢ç¬¬ä¸€ä¸ª HtmlComment å­—æ®µä»¥åŒ¹é…æ–°ç±»å‹ã€‚

#### å¸¸è§é”™è¯¯

1. **é”™è¯¯ç†è§£ç±»å‹è½¬æ¢æœºåˆ¶**
   - âŒ é”™è¯¯ï¼šè®¤ä¸ºæ˜¯é€šè¿‡ä¿®æ”¹æ ‡é¢˜æ¥è½¬æ¢ç±»å‹
   - âœ… æ­£ç¡®ï¼šé€šè¿‡ç§»åŠ¨å¡ç‰‡åˆ°ä¸åŒå½’ç±»å¡ç‰‡ä¸‹æ–¹ï¼Œ`getNoteType` ä¼šæ ¹æ®å½’ç±»å¡ç‰‡è¿”å›æ–°ç±»å‹

2. **é”™è¯¯ä½¿ç”¨ API**
   - âŒ é”™è¯¯ï¼š`note.note.insertCommentToIndex(comment, index)` - æ­¤æ–¹æ³•ä¸å­˜åœ¨
   - âœ… æ­£ç¡®ï¼šä½¿ç”¨ `cloneAndMergeById` + `moveComment` çš„ç»„åˆ

3. **é”™è¯¯è®¿é—®å±æ€§**
   - âŒ é”™è¯¯ï¼š`firstFieldObj.fieldIndex`ã€`firstFieldObj.field` - è¿™äº›å±æ€§ä¸å­˜åœ¨
   - âœ… æ­£ç¡®ï¼šä½¿ç”¨ `firstFieldObj.index` å’Œ `firstFieldObj.text`

#### æ­£ç¡®å®ç°æ–¹å¼
```javascript
// 1. åˆ é™¤åŸå­—æ®µ
note.removeCommentByIndex(firstFieldIndex);

// 2. å…‹éš†å¹¶åˆå¹¶æ–°å­—æ®µæ¨¡æ¿
this.cloneAndMergeById(note, templateNoteId);

// 3. å°†æ–°å­—æ®µç§»åŠ¨åˆ°åŸä½ç½®
let newFieldIndex = note.comments.length - 1;
note.moveComment(newFieldIndex, firstFieldIndex);
```

#### è°ƒè¯•å»ºè®®
- ä½¿ç”¨ `MNUtil.log()` è¾“å‡ºå…³é”®ä¿¡æ¯ï¼Œä¾¿äºè¿½è¸ªæ‰§è¡Œæµç¨‹
- æ£€æŸ¥ `parseNoteComments` è¿”å›çš„æ•°æ®ç»“æ„ï¼Œäº†è§£å¯ç”¨å±æ€§
- å‚è€ƒç°æœ‰çš„ç±»ä¼¼å®ç°ï¼ˆå¦‚ `mergeTemplate` æ–¹æ³•ï¼‰

### æ•°ç»„ç´¢å¼•ç®¡ç†é™·é˜±ï¼ˆè¯„è®ºç§»åŠ¨æ“ä½œï¼‰

åœ¨å¤„ç† MNNote è¯„è®ºæ•°ç»„çš„ç§»åŠ¨æ“ä½œæ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ç´¢å¼•å˜åŒ–å¸¦æ¥çš„é—®é¢˜ï¼š

#### åœºæ™¯è¯´æ˜
å®ç°æ™ºèƒ½é“¾æ¥æ’åˆ—åŠŸèƒ½ï¼ˆ`smartLinkArrangement`ï¼‰æ—¶ï¼Œéœ€è¦åœ¨è¯„è®ºæ•°ç»„ä¸­æ·»åŠ æ–°å…ƒç´ å¹¶ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚

#### é”™è¯¯çš„å¤æ‚æ–¹æ¡ˆ
```javascript
// âŒ è¿‡åº¦å¤æ‚ï¼šè¯•å›¾ç®¡ç†æ‰€æœ‰ç´¢å¼•å˜åŒ–
// 1. è®°å½•åŸå§‹é“¾æ¥ç´¢å¼•
let linkIndex = comments.length - 1;
// 2. æ·»åŠ æ–°å…ƒç´ 
note.appendMarkdownComment("- ");
// 3. è®¡ç®—æ–°ç´¢å¼•ï¼ˆå®¹æ˜“å‡ºé”™ï¼‰
let dashIndex = note.MNComments.length - 1;
// 4. ç§»åŠ¨æ“ä½œï¼ˆç´¢å¼•å¯èƒ½å·²ç»å˜åŒ–ï¼‰
this.moveCommentsArrToField(note, [dashIndex], "ç›¸å…³æ€è€ƒ", true);
this.moveCommentsArrToField(note, [linkIndex], "ç›¸å…³æ€è€ƒ", true);
```

#### æ­£ç¡®çš„ç®€æ´æ–¹æ¡ˆ
```javascript
// âœ… ç®€æ´ä¼˜é›…ï¼šåˆ©ç”¨æ•°ç»„åŠ¨æ€å˜åŒ–
// 1. æ·»åŠ æ–°å…ƒç´ 
note.appendMarkdownComment("- ");
// 2. è¿ç»­ä¸¤æ¬¡ç§»åŠ¨æœ€åä¸€ä¸ªå…ƒç´ 
this.moveCommentsArrToField(note, [note.MNComments.length - 1], "ç›¸å…³æ€è€ƒ");  // ç§»åŠ¨ "- "
this.moveCommentsArrToField(note, [note.MNComments.length - 1], "ç›¸å…³æ€è€ƒ");  // ç§»åŠ¨é“¾æ¥
```

#### å…³é”®æ´å¯Ÿ
- **é¿å…é¢„å…ˆè®¡ç®—ç´¢å¼•**ï¼šæ•°ç»„æ“ä½œä¼šæ”¹å˜åç»­å…ƒç´ çš„ä½ç½®
- **åˆ©ç”¨åŠ¨æ€ç‰¹æ€§**ï¼šæ¯æ¬¡æ“ä½œåé‡æ–°è·å–"æœ€åä¸€ä¸ªå…ƒç´ "
- **ä¿æŒä»£ç ç®€æ´**ï¼šè¶Šç®€å•çš„æ–¹æ¡ˆè¶Šä¸å®¹æ˜“å‡ºé”™

#### ç»éªŒæ€»ç»“
1. **åŠ¨æ€è·å–ç´¢å¼•**ï¼šä½¿ç”¨ `array.length - 1` è€Œä¸æ˜¯é¢„å­˜ç´¢å¼•å€¼
2. **é¡ºåºæ“ä½œ**ï¼šåˆ©ç”¨å…ƒç´ ç§»èµ°åæ•°ç»„è‡ªåŠ¨è°ƒæ•´çš„ç‰¹æ€§
3. **é¿å…è¿‡åº¦è®¾è®¡**ï¼šç®€å•é—®é¢˜ç”¨ç®€å•æ–¹æ³•è§£å†³

### MNUtil.select() æ–¹æ³•ä¸å­˜åœ¨é™·é˜±ï¼ˆAPI æ–‡æ¡£é”™è¯¯ï¼‰

åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°æ–‡æ¡£ä¸­è®°è½½çš„ `MNUtil.select()` æ–¹æ³•å®é™…ä¸Šä¸å­˜åœ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æ–‡æ¡£ä¸æºç ä¸åŒæ­¥çš„é—®é¢˜ã€‚

#### é—®é¢˜æè¿°
å½“ä½¿ç”¨æ–‡æ¡£ä¸­æåˆ°çš„ `MNUtil.select()` æ–¹æ³•æ—¶ï¼Œä¼šé‡åˆ° "Not supported yet" æˆ–æ–¹æ³•æœªå®šä¹‰çš„é”™è¯¯ã€‚

#### é”™è¯¯ç¤ºä¾‹
```javascript
// âŒ é”™è¯¯ï¼šMNUtil.select() ä¸å­˜åœ¨
const selectedIndex = await MNUtil.select("é€‰æ‹©ä»»åŠ¡ç±»å‹", options, false);
if (selectedIndex === null) return;

// âŒ é”™è¯¯ï¼šMNUtil.selectIndex() ä¹Ÿä¸å­˜åœ¨
const index = await MNUtil.selectIndex("é€‰æ‹©", ["é€‰é¡¹1", "é€‰é¡¹2"]);
```

#### æ­£ç¡®çš„ API
é€šè¿‡æŸ¥çœ‹ `mnutils.js` æºç ï¼ˆç¬¬ 921 è¡Œï¼‰ï¼Œæ­£ç¡®çš„æ–¹æ³•æ˜¯ `MNUtil.userSelect()`ï¼š

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ MNUtil.userSelect()
const selectedIndex = await MNUtil.userSelect("é€‰æ‹©ä»»åŠ¡ç±»å‹", "", options);
if (selectedIndex === 0) return; // 0 æ˜¯å–æ¶ˆæŒ‰é’®

// API ç­¾å
static async userSelect(mainTitle, subTitle, items) {
  // è¿”å› Promise<number>
  // 0: å–æ¶ˆæŒ‰é’®
  // 1+: å®é™…é€‰é¡¹ï¼ˆä» 1 å¼€å§‹ï¼‰
}
```

#### æŒ‰é’®ç´¢å¼•å·®å¼‚
1. **å–æ¶ˆæŒ‰é’®**ï¼š
   - æ–‡æ¡£æè¿°ï¼šè¿”å› `null`
   - å®é™…æƒ…å†µï¼šè¿”å› `0`

2. **é€‰é¡¹ç´¢å¼•**ï¼š
   - æ–‡æ¡£æè¿°ï¼šä» `0` å¼€å§‹
   - å®é™…æƒ…å†µï¼šä» `1` å¼€å§‹

#### æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼
```javascript
// åŒæ­¥æ–¹å¼ï¼ˆä½¿ç”¨ async/awaitï¼‰
const options = ["é€‰é¡¹1", "é€‰é¡¹2", "é€‰é¡¹3"];
const selectedIndex = await MNUtil.userSelect("è¯·é€‰æ‹©", "", options);

switch(selectedIndex) {
  case 0:  // ç”¨æˆ·ç‚¹å‡»å–æ¶ˆ
    return;
  case 1:  // ç”¨æˆ·é€‰æ‹©äº†"é€‰é¡¹1"
    handleOption1();
    break;
  case 2:  // ç”¨æˆ·é€‰æ‹©äº†"é€‰é¡¹2"
    handleOption2();
    break;
  // ...
}

// å¼‚æ­¥æ–¹å¼ï¼ˆä½¿ç”¨ .then()ï¼‰
MNUtil.userSelect("è¯·é€‰æ‹©", "", options).then(selectedIndex => {
  if (selectedIndex === 0) return; // å–æ¶ˆ
  // å¤„ç†é€‰æ‹©...
});
```

#### ç»éªŒæ•™è®­
1. **å§‹ç»ˆä»¥æºç ä¸ºå‡†**ï¼šå½“æ–‡æ¡£ä¸­çš„ API ä¸å·¥ä½œæ—¶ï¼Œç›´æ¥åœ¨æºç ä¸­æœç´¢
2. **ä½¿ç”¨ grep å·¥å…·éªŒè¯**ï¼š`grep -n "methodName" mnutils.js`
3. **æ³¨æ„å‚æ•°å·®å¼‚**ï¼š`userSelect` éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼ˆmainTitle, subTitle, itemsï¼‰
4. **æµ‹è¯•è¾¹ç•Œæƒ…å†µ**ï¼šç‰¹åˆ«æ˜¯å–æ¶ˆæŒ‰é’®çš„å¤„ç†

### UI å¸ƒå±€é™·é˜±ï¼ˆScrollView ä¸å›ºå®šå…ƒç´ ï¼‰

åœ¨å¼€å‘è®¾ç½®é¢æ¿ç­‰å¤æ‚ UI æ—¶ï¼Œç»å¸¸éœ€è¦å¤„ç†å¯æ»šåŠ¨åŒºåŸŸä¸å›ºå®šå…ƒç´ çš„å¸ƒå±€å…³ç³»ã€‚

#### åœºæ™¯è¯´æ˜
å®ç°ç±»ä¼¼ mnai çš„æ ‡ç­¾æ å¸ƒå±€ï¼Œéœ€è¦æ¨ªå‘æ»šåŠ¨çš„æ ‡ç­¾æŒ‰é’®å’Œå›ºå®šçš„å…³é—­æŒ‰é’®ã€‚

#### å¸¸è§é”™è¯¯

1. **å…³é—­æŒ‰é’®éšå†…å®¹æ»šåŠ¨**
   ```javascript
   // âŒ é”™è¯¯ï¼šå°†å…³é—­æŒ‰é’®æ”¾åœ¨ ScrollView å†…
   this.createButton("closeButton","closeButtonTapped:","tabView")
   ```

2. **åæ ‡ç³»æ··ä¹±**
   ```javascript
   // âŒ é”™è¯¯ï¼šä¸åŒçˆ¶è§†å›¾å¯¼è‡´åæ ‡ç³»ä¸ä¸€è‡´
   this.createScrollView("tabView","view")
   this.createButton("closeButton","closeButtonTapped:","settingView")
   // tabView åœ¨ view ä¸­ï¼ŒcloseButton åœ¨ settingView ä¸­ï¼Œåæ ‡ç³»ä¸åŒ
   ```

#### æ­£ç¡®å®ç°
```javascript
// âœ… æ­£ç¡®ï¼šç¼©çŸ­ ScrollView å®½åº¦ï¼Œä¸ºå›ºå®šå…ƒç´ é¢„ç•™ç©ºé—´
// 1. åˆ›å»º ScrollView å’Œå…³é—­æŒ‰é’®åœ¨åŒä¸€çˆ¶è§†å›¾ä¸­
this.createScrollView("tabView","view")
this.createButton("closeButton","closeButtonTapped:","view")

// 2. å¸ƒå±€æ—¶ä¸ºå…³é—­æŒ‰é’®é¢„ç•™ç©ºé—´
let tabViewFrame = {
  x: 0,
  y: 20,
  width: width - 45,  // é¢„ç•™ 45 åƒç´ ç»™å…³é—­æŒ‰é’®
  height: 30
}
this.tabView.frame = tabViewFrame

// 3. å…³é—­æŒ‰é’®å®šä½åœ¨ ScrollView å³ä¾§
taskFrame.set(this.closeButton, tabViewFrame.width + 5, tabViewFrame.y)
```

### ScrollView æ–¹å‘é”å®š

#### é—®é¢˜æè¿°
æ¨ªå‘æ»šåŠ¨çš„ ScrollView ä¹Ÿèƒ½å‚ç›´ç§»åŠ¨ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

#### è§£å†³æ–¹æ¡ˆ
```javascript
// åˆ›å»ºåªèƒ½æ¨ªå‘æ»šåŠ¨çš„ ScrollView
this.tabView.alwaysBounceHorizontal = true
this.tabView.alwaysBounceVertical = false    // ç¦ç”¨å‚ç›´å¼¹æ€§
this.tabView.directionalLockEnabled = true   // é”å®šæ»šåŠ¨æ–¹å‘
this.tabView.showsHorizontalScrollIndicator = false
this.tabView.showsVerticalScrollIndicator = false

// ç¡®ä¿ contentSize é«˜åº¦ä¸ frame é«˜åº¦ç›¸åŒ
this.tabView.contentSize = {width: contentWidth, height: 30}
this.tabView.frame = {x: 0, y: 20, width: width - 45, height: 30}
```

### iOS é¢œè‰²å€¼è®¾ç½®é™·é˜±

#### é”™è¯¯ç”¨æ³•
```javascript
// âŒ é”™è¯¯ï¼šiOS ä¸æ”¯æŒ "transparent" å­—ç¬¦ä¸²
MNButton.setConfig(button, {color:"transparent"})
```

#### æ­£ç¡®ç”¨æ³•
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ alpha é€šé“å®ç°é€æ˜
MNButton.setConfig(button, {color:"#ffffff", alpha:0.0})

// æˆ–è€…ä½¿ç”¨ MNUtil çš„é¢œè‰²æ–¹æ³•
button.backgroundColor = MNUtil.hexColorAlpha("#ffffff", 0.0)
```

### è§†å›¾å±‚çº§ä¸åæ ‡ç³»ç»Ÿ

ç†è§£è§†å›¾å±‚çº§å¯¹äºæ­£ç¡®å¸ƒå±€è‡³å…³é‡è¦ã€‚æ¯ä¸ªè§†å›¾éƒ½æœ‰è‡ªå·±çš„åæ ‡ç³»ç»Ÿï¼Œå­è§†å›¾çš„åæ ‡æ˜¯ç›¸å¯¹äºçˆ¶è§†å›¾çš„ã€‚

#### å…¸å‹çš„è®¾ç½®é¢æ¿å±‚çº§ç»“æ„
```
view (ä¸»è§†å›¾, åæ ‡ç³»åŸç‚¹)
â”œâ”€â”€ moveButton (y=0, é¡¶éƒ¨ç§»åŠ¨æ‰‹æŸ„)
â”œâ”€â”€ maxButton (y=0, æœ€å¤§åŒ–æŒ‰é’®)
â”œâ”€â”€ tabView (y=20, ScrollView å®¹å™¨)
â”‚   â”œâ”€â”€ configButton (y=0, ç›¸å¯¹äº tabView)
â”‚   â”œâ”€â”€ dynamicButton (y=0)
â”‚   â””â”€â”€ ...å…¶ä»–æ ‡ç­¾æŒ‰é’®
â”œâ”€â”€ closeButton (y=20, ä¸ tabView åŒçº§åŒé«˜åº¦)
â””â”€â”€ settingView (y=55, ä¸»å†…å®¹åŒºåŸŸ)
    â”œâ”€â”€ configView (y=0, ç›¸å¯¹äº settingView)
    â”œâ”€â”€ advanceView (y=0)
    â””â”€â”€ ...å…¶ä»–å†…å®¹è§†å›¾
```

#### åæ ‡è®¡ç®—è¦ç‚¹
1. **ç›¸å¯¹åæ ‡**ï¼šå­è§†å›¾çš„åæ ‡æ˜¯ç›¸å¯¹äºç›´æ¥çˆ¶è§†å›¾çš„
2. **åŒçº§å¯¹é½**ï¼šè¦å¯¹é½çš„å…ƒç´ åº”è¯¥åœ¨åŒä¸€çˆ¶è§†å›¾ä¸­
3. **é¢„ç•™ç©ºé—´**ï¼šå›ºå®šå…ƒç´ éœ€è¦åœ¨å¸ƒå±€æ—¶é¢„ç•™ç©ºé—´

> ğŸ’¡ **æç¤º**ï¼šå¼€å‘å‰è¯·å…ˆä»”ç»†é˜…è¯»å¯¹åº”å­é¡¹ç›®çš„ CLAUDE.md æ–‡ä»¶ï¼Œå®ƒä»¬åŒ…å«äº†æ›´è¯¦ç»†çš„æŠ€æœ¯å®ç°å’Œè§„èŒƒè¦æ±‚ã€‚

### JSB æ¡†æ¶ä¸­çš„æ–¹æ³•å®šä¹‰é™·é˜±ï¼ˆäº‹ä»¶å¤„ç† vs åŸå‹æ–¹æ³•ï¼‰

åœ¨å¼€å‘å¤šçœ‹æ¿ç»‘å®šåŠŸèƒ½æ—¶å‘ç°çš„é‡è¦é—®é¢˜ï¼šJSB.defineClass ä¸­å®šä¹‰çš„æ–¹æ³•å’Œ prototype ä¸Šå®šä¹‰çš„æ–¹æ³•æœ‰æœ¬è´¨åŒºåˆ«ã€‚

#### é—®é¢˜æè¿°
ä½¿ç”¨é€šç”¨å‡½æ•°åˆ›å»ºçš„ç›®æ ‡çœ‹æ¿æŒ‰é’®ç‚¹å‡»æ— å“åº”ï¼Œè€Œæ ¹ç›®å½•çœ‹æ¿çš„æŒ‰é’®æ­£å¸¸å·¥ä½œã€‚

#### é”™è¯¯ç¤ºä¾‹
```javascript
// âŒ é”™è¯¯ï¼šåœ¨ JSB.defineClass ä¸­å®šä¹‰çš„å¯¹è±¡å†…éƒ¨è°ƒç”¨å…¶ä»–æ–¹æ³•
JSB.defineClass('SettingController : UIViewController', {
  // äº‹ä»¶å¤„ç†æ–¹æ³•
  focusTargetBoard: function() {
    this.focusBoard('target')  // âŒ this.focusBoard is not a function
  },
  
  // è¯•å›¾åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸­å®šä¹‰é€šç”¨æ–¹æ³•
  focusBoard: function(boardKey) {
    // é€šç”¨é€»è¾‘
  }
})
```

#### æ­£ç¡®å®ç°
```javascript
// âœ… æ­£ç¡®ï¼šåˆ†ç¦»äº‹ä»¶å¤„ç†å’Œé€šç”¨é€»è¾‘
JSB.defineClass('SettingController : UIViewController', {
  // äº‹ä»¶å¤„ç†æ–¹æ³•ï¼ˆå“åº”æŒ‰é’®ç‚¹å‡»ï¼‰
  focusTargetBoard: function() {
    let self = getSettingController()
    self.focusBoard('target')  // è°ƒç”¨åŸå‹æ–¹æ³•
  },
  
  clearTargetBoard: async function() {
    let self = getSettingController()
    await self.clearBoard('target')
  }
})

// é€šç”¨æ–¹æ³•å®šä¹‰åœ¨åŸå‹ä¸Š
SettingController.prototype.focusBoard = function(boardKey) {
  // é€šç”¨é€»è¾‘
  let noteId = taskConfig.getBoardNoteId(boardKey)
  // ...
}

SettingController.prototype.clearBoard = async function(boardKey) {
  // é€šç”¨é€»è¾‘
  // ...
}
```

#### å…³é”®åŸåˆ™
1. **äº‹ä»¶å¤„ç†æ–¹æ³•**ï¼šå¿…é¡»åœ¨ JSB.defineClass ä¸­å®šä¹‰ï¼Œç”¨äºå“åº” UI äº‹ä»¶
2. **é€šç”¨/å¯å¤ç”¨æ–¹æ³•**ï¼šåº”è¯¥å®šä¹‰åœ¨ prototype ä¸Šï¼Œä¾¿äºå†…éƒ¨è°ƒç”¨
3. **æ–¹æ³•è°ƒç”¨**ï¼šåœ¨ JSB.defineClass å†…éƒ¨è°ƒç”¨åŸå‹æ–¹æ³•æ—¶ï¼Œéœ€è¦å…ˆè·å–å®ä¾‹ï¼ˆ`let self = getInstance()`ï¼‰

#### æœ€ä½³å®è·µï¼šå¤šçœ‹æ¿ç®¡ç†æ¶æ„

å½“éœ€è¦ç®¡ç†å¤šä¸ªç›¸ä¼¼çš„ UI ç»„ä»¶ï¼ˆå¦‚å¤šä¸ªçœ‹æ¿ï¼‰æ—¶ï¼Œæ¨èä»¥ä¸‹æ¶æ„ï¼š

```javascript
// 1. é€šç”¨ç»„ä»¶åˆ›å»ºå‡½æ•°ï¼ˆprototypeï¼‰
SettingController.prototype.createBoardBinding = function(config) {
  const {key, title, parent} = config
  // åˆ›å»ºæ ‡ç­¾ã€æŒ‰é’®ç­‰ UI å…ƒç´ 
  // æŒ‰é’®çš„ action æŒ‡å‘ JSB.defineClass ä¸­çš„æ–¹æ³•
  this.createButton(buttonName, `focus${Key}Board:`, parent)
}

// 2. äº‹ä»¶å¤„ç†æ–¹æ³•ï¼ˆJSB.defineClassï¼‰
// æ¯ä¸ªçœ‹æ¿éƒ½éœ€è¦å¯¹åº”çš„ä¸‰ä¸ªæ–¹æ³•
focusRootBoard: function() { /* ... */ },
clearRootBoard: function() { /* ... */ },
pasteRootBoard: function() { /* ... */ },

focusTargetBoard: function() { /* ... */ },
clearTargetBoard: function() { /* ... */ },
pasteTargetBoard: function() { /* ... */ },

// 3. é€šç”¨æ“ä½œé€»è¾‘ï¼ˆprototypeï¼‰
SettingController.prototype.focusBoard = function(boardKey) { /* ... */ }
SettingController.prototype.clearBoard = function(boardKey) { /* ... */ }
SettingController.prototype.pasteBoard = function(boardKey) { /* ... */ }
```

è¿™ç§æ¶æ„ç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼ŒåŒæ—¶ç¬¦åˆ JSB æ¡†æ¶çš„è¦æ±‚ã€‚