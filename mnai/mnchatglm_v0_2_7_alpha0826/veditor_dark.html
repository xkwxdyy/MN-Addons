<!DOCTYPE html>
<html lang="zh-cmn-Hans" style="height: 0px;">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Vditor</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <script src="veditor.min.js" defer></script>
    <script src="subfunc.js"></script>
    <script src="veditor.func.js"></script>
    <script src="pdf.js"></script>
    <script src="pdf.worker.js"></script>
    <script src="html2canvas.js" defer></script>
    <link rel="stylesheet" href="notyf.min.css">
    <script src="notyf.min.js" defer></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" defer></script> -->
    <link rel="stylesheet" href="veditor.css" />
    <script src="marked.js"></script>
    <script src="jsonrepair.js"></script>
    <!-- <script src="https://unpkg.com/vditor/dist/index.min.js"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" defer></script> -->
  <script src="katex.min.js"></script>
  <link rel="stylesheet" href="katex.min.css" defer/>
    <style>
      body{
        margin: 0px;
        background-color: #24292e;
      }
      a {
        color:rgb(0, 166, 255);
      }
      .vditor {
        --border-color: rgba(180, 142, 142, 0);
        --second-color: rgba(88, 96, 105, 0.36);
        --panel-background-color: #24292e;
        --panel-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        --toolbar-background-color: #f6f8fa;
        --toolbar-icon-color: #586069;
        --toolbar-icon-hover-color: #4285f4;
        --toolbar-height: 35px;
        --toolbar-divider-margin-top: 0px;
        --textarea-background-color: #24292e;
        --textarea-text-color: #fafbfc;
        --resize-icon-color: var(--toolbar-icon-color);
        --resize-background-color: var(--toolbar-background-color);
        --resize-hover-icon-color: var(--panel-background-color);
        --resize-hover-background-color: var(--toolbar-icon-hover-color);
        --count-background-color: rgba(27, 31, 35, 0.05);
        --heading-border-color: #eaecef;
        --blockquote-color: #6a737d;
        --ir-heading-color: #660e7a;
        --ir-title-color: #808080;
        --ir-bi-color: #0033b3;
        --ir-link-color: #008000;
        --ir-bracket-color: #0000ff;
        --ir-paren-color: #008000;
      }
      .vditor-reset table tr {
        background-color: #24292e !important;
        border-top: 1px solid #c6cbd1;
      }
      .vditor-reset table tbody tr:nth-child(2n) {
        background-color: #24292e !important;
      }
      .vditor-reset {
        color: #fafbfc;
        font-variant-ligatures: no-common-ligatures;
        font-family: "PingFang SC","Helvetica Neue", "Luxi Sans", "DejaVu Sans", "Hiragino Sans GB", "Microsoft Yahei",  sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", "Android Emoji", "EmojiSymbols";
        word-wrap: break-word;
        overflow: auto;
        line-height: 1.5;
        font-size: 16px;
        word-break: break-word;
        padding: 5px !important;
        padding-top: 0 !important;
      }
    </style>
</head>
<body>
    <div id="other"></div>
    <!-- <div id="funcResponse"></div>
    <div id="reasoningResponse"></div>
    <div id="search-results"></div> -->
    <div id="vditor"></div>
<script>


let selectingText = ""
let selectingTime = 0
let editor
let theme = "dark"
// let preContent = `
// ### åé¦ˆä¸è§£æ  
// **é€‰é¡¹Aæ­£ç¡®ï¼**  
// - è®ºæ–‡æ˜ç¡®è¯´æ˜"Overbars and primes indicate basic-state quantities and perturbations"ï¼Œå³**ä¸Šæ¨ªçº¿ï¼ˆ$\\overline{}$ï¼‰è¡¨ç¤ºåŸºæœ¬æ€ï¼Œæ’‡å·ï¼ˆ$'$ï¼‰è¡¨ç¤ºæ‰°åŠ¨é‡**ï¼Œä¸¤è€…é€šè¿‡**åŠ æ³•åˆ†è§£**æ„æˆæ€»å˜é‡ï¼ˆæ€»æ¶¡åº¦$\\zeta = \\overline{\\zeta} + \\zeta'$ï¼‰ã€‚  
// - å…¶ä»–é€‰é¡¹é”™è¯¯åŸå› ï¼š  
//   - Bé€‰é¡¹ç¬¦å·é¢ å€’ï¼ˆåº”ä¸º$\T = \\overline{T} + T'$ï¼‰ï¼›  
//   - Cé€‰é¡¹ä½¿ç”¨ä¹˜æ³•åˆ†è§£ï¼ˆä¸ç¬¦åˆçº¿æ€§æ¨¡å‹çš„åŠ æ³•åˆ†è§£å‡è®¾ï¼‰ï¼›  
//   - Dé€‰é¡¹ä½¿ç”¨å‡æ³•åˆ†è§£ï¼ˆåº”ä¸º$\\mathbf{u} = \\overline{\\mathbf{u}} + \\mathbf{u}'$ï¼‰ã€‚  


// ### ç¬¬å››æ­¥ï¼šè¯†åˆ«æ¶¡åº¦æ–¹ç¨‹çš„æ ¸å¿ƒé¡¹  
// è®ºæ–‡ç»™å‡ºçš„æ–¹ç¨‹(1)æ˜¯å‡†åœ°è½¬æ¶¡åº¦æ–¹ç¨‹ï¼š  
// $$



// \\overline{\\mathbf{u}} \\cdot \\nabla \\zeta' + u' \\frac{\\partial \\overline{\\zeta}}{\\partial x} + v' \\left( \\beta + \\frac{\\partial \\overline{\\zeta}}{\\partial y} \\right) - f_0 \\frac{\\partial \\omega'}{\\partial p} = \\kappa \\nabla^2 \\zeta'
// $$  

// å…¶ä¸­å“ªä¸€é¡¹ä»£è¡¨**åŸºæœ¬æ°”æµå¯¹æ‰°åŠ¨æ¶¡åº¦çš„å¹³æµè¾“é€**ï¼Ÿ  

// \`\`\`userSelect
// A. $\\overline{\\mathbf{u}} \\cdot \\nabla \\zeta'$ï¼ˆåŸºæœ¬æ€é£é€Ÿä¸æ‰°åŠ¨æ¶¡åº¦æ¢¯åº¦çš„ç‚¹ç§¯ï¼‰
// \`\`\`

// \`\`\`userSelect
// B. $u' \\frac{\\partial \\overline{\\zeta}}{\\partial x}$ï¼ˆæ‰°åŠ¨ç»å‘é£ä¸åŸºæœ¬æ€æ¶¡åº¦ç»å‘æ¢¯åº¦çš„ä¹˜ç§¯ï¼‰
// \`\`\`

// \`\`\`userSelect
// C. $v' \\left( \\beta + \\frac{\\partial \\overline{\\zeta}}{\\partial y} \\right)$ï¼ˆæ‰°åŠ¨çº¬å‘é£ä¸ç»å¯¹æ¶¡åº¦æ¢¯åº¦çš„ä¹˜ç§¯ï¼‰
// \`\`\`

// \`\`\`userSelect
// D. $- f_0 \\frac{\\partial \\omega'}{\\partial p}$ï¼ˆç§‘é‡Œå¥¥åˆ©å‚æ•°ä¸å‚ç›´é€Ÿåº¦æ•£åº¦çš„ä¹˜ç§¯ï¼‰
// \`\`\`
// `
// preContent = replaceButtonCodeBlocks(preContent)
let preContent = `ğŸ¤” I'm thinking...`

let preHtml = ""
let preFunc = ""
let preReasoning = ""
let reasoningBegin
let option = {
      theme:theme,
      math:{
        engine:"MathJax",
        mathJaxOptions:{
          tex: {
              inlineMath: [ ['$','$'], ["\\(","\\)"] ]
          }
        },
        inlineDigit: true
      },
      cdn:"https://unpkg.com/vditor@3.11.0",
      after: notifyRefreshHeight
    }
const logElement = document.getElementById('funcResponse')
let tem = document.getElementById('vditor')
document.addEventListener('DOMContentLoaded', function () {
    Vditor.preview(tem,preContent,option)
    notyf = new Notyf({position: {x: 'center', y: 'top'}, duration: 1000,ripple:false});
})

    function openEdit(allowEdit) {
      if (!preContent) {
        return
      }
      editor = new Vditor('vditor', {
      cache: {
        enable: false,
      },
      theme:theme,
      preview:{
        math:{
          engine:"MathJax",
          mathJaxOptions:{
            tex: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ]
            }
          },
          inlineDigit: true
        },
        markdown:{
          html:true,
          mark:true
        }
      },
      select:(text)=>{
        // æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯
        // notyf.success("Select text: "+text.slice(0,10)+"...")
        window.location.href = "chataction://selectText"
      },
      image:{
        isPreview:false,
        preview:(element)=>{
          window.location.href = "chataction://copyimage="+encodeURIComponent(element.src)
        }
      },
      toolbar:[],
      mode: "wysiwyg",
      i18n:{
        'alignCenter': 'å±…ä¸­',
        'alignLeft': 'å±…å·¦',
        'alignRight': 'å±…å³',
        'alternateText': 'æ›¿ä»£æ–‡æœ¬',
        'bold': 'ç²—ä½“',
        'both': 'ç¼–è¾‘ & é¢„è§ˆ',
        'check': 'ä»»åŠ¡åˆ—è¡¨',
        'close': 'å…³é—­',
        'code': 'ä»£ç å—',
        'code-theme': 'ä»£ç å—ä¸»é¢˜é¢„è§ˆ',
        'column': 'åˆ—',
        'comment': 'è¯„è®º',
        'confirm': 'ç¡®å®š',
        'content-theme': 'å†…å®¹ä¸»é¢˜é¢„è§ˆ',
        'copied': 'å·²å¤åˆ¶',
        'copy': 'å¤åˆ¶',
        'delete-column': 'åˆ é™¤åˆ—',
        'delete-row': 'åˆ é™¤è¡Œ',
        'devtools': 'å¼€å‘è€…å·¥å…·',
        'down': 'ä¸‹',
        'downloadTip': 'è¯¥æµè§ˆå™¨ä¸æ”¯æŒä¸‹è½½åŠŸèƒ½',
        'edit': 'ç¼–è¾‘',
        'edit-mode': 'åˆ‡æ¢ç¼–è¾‘æ¨¡å¼',
        'emoji': 'è¡¨æƒ…',
        'export': 'å¯¼å‡º',
        'fileTypeError': 'æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·å‹ç¼©åå†è¯•',
        'footnoteRef': 'è„šæ³¨æ ‡è¯†',
        'fullscreen': 'å…¨å±åˆ‡æ¢',
        'generate': 'ç”Ÿæˆä¸­',
        'headings': 'æ ‡é¢˜',
        'heading1': 'ä¸€çº§æ ‡é¢˜',
        'heading2': 'äºŒçº§æ ‡é¢˜',
        'heading3': 'ä¸‰çº§æ ‡é¢˜',
        'heading4': 'å››çº§æ ‡é¢˜',
        'heading5': 'äº”çº§æ ‡é¢˜',
        'heading6': 'å…­çº§æ ‡é¢˜',
        'help': 'å¸®åŠ©',
        'imageURL': 'å›¾ç‰‡åœ°å€',
        'indent': 'åˆ—è¡¨ç¼©è¿›',
        'info': 'å…³äº',
        'inline-code': 'è¡Œå†…ä»£ç ',
        'insert-after': 'æœ«å°¾æ’å…¥è¡Œ',
        'insert-before': 'èµ·å§‹æ’å…¥è¡Œ',
        'insertColumnLeft': 'åœ¨å·¦è¾¹æ’å…¥ä¸€åˆ—',
        'insertColumnRight': 'åœ¨å³è¾¹æ’å…¥ä¸€åˆ—',
        'insertRowAbove': 'åœ¨ä¸Šæ–¹æ’å…¥ä¸€è¡Œ',
        'insertRowBelow': 'åœ¨ä¸‹æ–¹æ’å…¥ä¸€è¡Œ',
        'instantRendering': 'å³æ—¶æ¸²æŸ“',
        'italic': 'æ–œä½“',
        'language': 'è¯­è¨€',
        'line': 'åˆ†éš”çº¿',
        'link': 'é“¾æ¥',
        'linkRef': 'å¼•ç”¨æ ‡è¯†',
        'list': 'æ— åºåˆ—è¡¨',
        'more': 'æ›´å¤š',
        'nameEmpty': 'æ–‡ä»¶åä¸èƒ½ä¸ºç©º',
        'ordered-list': 'æœ‰åºåˆ—è¡¨',
        'outdent': 'åˆ—è¡¨åå‘ç¼©è¿›',
        'outline': 'å¤§çº²',
        'over': 'è¶…è¿‡',
        'performanceTip': 'å®æ—¶é¢„è§ˆéœ€ ${x}msï¼Œå¯ç‚¹å‡»ç¼–è¾‘ & é¢„è§ˆæŒ‰é’®è¿›è¡Œå…³é—­',
        'preview': 'é¢„è§ˆ',
        'quote': 'å¼•ç”¨',
        'record': 'å¼€å§‹å½•éŸ³/ç»“æŸå½•éŸ³',
        'record-tip': 'è¯¥è®¾å¤‡ä¸æ”¯æŒå½•éŸ³åŠŸèƒ½',
        'recording': 'å½•éŸ³ä¸­...',
        'redo': 'é‡åš',
        'remove': 'åˆ é™¤',
        'row': 'è¡Œ',
        'spin': 'æ—‹è½¬',
        'splitView': 'åˆ†å±é¢„è§ˆ',
        'strike': 'åˆ é™¤çº¿',
        'table': 'è¡¨æ ¼',
        'textIsNotEmpty': 'æ–‡æœ¬ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰',
        'title': 'æ ‡é¢˜',
        'tooltipText': 'æç¤ºæ–‡æœ¬',
        'undo': 'æ’¤é”€',
        'up': 'ä¸Š',
        'update': 'æ›´æ–°',
        'upload': 'ä¸Šä¼ å›¾ç‰‡æˆ–æ–‡ä»¶',
        'uploadError': 'ä¸Šä¼ é”™è¯¯',
        'uploading': 'ä¸Šä¼ ä¸­...',
        'wysiwyg': 'æ‰€è§å³æ‰€å¾—',
      },
      customRenders:[
{
    renderHeading: (node, entering) => {
      const id = Lute.GetHeadingID(node)
      if (entering) {
        return [
          `<h${node.__internal_object__.HeadingLevel} id='${id}' class='heading'><span class='heading__prefix'></span><span class='heading__content'>`,
          Lute.WalkContinue]
      } else {
        return [
          `</span><span class='heading__suffix'></span><a id='vditorAnchor-${id}' class='vditor-anchor' href='#${id}'><svg viewBox='0 0 16 16' version='1.1' width='16' height='16'><path fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'></path></svg></a></h${node.__internal_object__.HeadingLevel}>`,
          Lute.WalkContinue]
      }
    },
  }
      ],
      value: preContent,
      after:()=>{
        // editor.setValue(preContent,true)
        if (!allowEdit) {
          editor.disabled()
        }
        setTimeout(() => {

        const mermaidElements = document.querySelectorAll('.language-mermaid');
    
    mermaidElements.forEach(element => {
        // åˆ›å»ºå®¹å™¨div
        // const container = document.createElement('div');
        // container.className = 'mermaid-container';
        
        // å°†å…ƒç´ åŒ…è£¹åœ¨å®¹å™¨ä¸­
        // element.parentNode.insertBefore(container, element);
        // container.appendChild(element);
        
        // åˆ›å»ºå¤åˆ¶æŒ‰é’®
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.textContent = 'Copy';
        copyBtn.title = 'Copy to clipboard'
        const element2Draw = element.children[0]
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        copyBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            // ä½¿ç”¨ html2canvas æˆªå–æ•´ä¸ª body
            // ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´æˆªå›¾çš„é…ç½®å‚æ•°
            copyBtn.style.display = "none"
            let scale = 6
            if (element.scrollHeight < 500) {
              scale = 12
            }
            html2canvas(element, {
                scale: scale,
                allowTaint: true, // å…è®¸è·¨åŸŸå›¾ç‰‡ï¼Œä½†å¯èƒ½ä¼šæ±¡æŸ“ canvas
                useCORS: true,    // å°è¯•ä½¿ç”¨ CORS åŠ è½½å›¾ç‰‡ï¼Œé¿å…æ±¡æŸ“
            }).then(canvas => {
                console.log('æˆªå›¾å®Œæˆï¼');
                
                // å°† canvas è½¬æ¢ä¸ºå›¾ç‰‡
                const image = canvas.toDataURL('image/png'); // ä¹Ÿå¯ä»¥æ˜¯ 'image/jpeg'
                // console.log(image);
                copyBtn.style.display = "block"
                window.location.href = 'chataction://copyimage='+encodeURIComponent(image)
            }).catch(error => {
                console.error('æˆªå›¾å¤±è´¥:', error);
            });
        });
        
        // æ·»åŠ æŒ‰é’®åˆ°å®¹å™¨
        // element.appendChild(copyBtn);
        element.insertBefore(copyBtn, element2Draw);
    });
        if (!allowEdit) {
          editor.disabled()
        }

          notifyRefreshHeight()
          // window.location.href = "chataction://showerror="+encodeURIComponent("test")
        }, 1000);
      }
    })
    }
</script>
<script src="./es5/tex-svg-full.js"></script>

<!-- <script src="./es5/tex-chtml.js"></script> -->
</body>
</html>