{
  "currentState": "memory_saved",
  "stateHistory": [
    {
      "from": "initial",
      "command": "init",
      "timestamp": "2025-06-28T12:03:19.937Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "remember",
      "timestamp": "2025-06-28T12:35:43.405Z",
      "args": [
        "## MarginNote æ’ä»¶å¼€å‘è¸©å‘è®°å½• (MNTask 2025-06-28)\n\n### 1. MarginNote å®Œå…¨å¡æ­»é—®é¢˜\n- åŸå› ï¼šJSB.newAddon ç¼ºå°‘ mainPath å‚æ•°ï¼›ä½¿ç”¨ new TaskController() è€Œé TaskController.new()ï¼›æ¨¡å—åŠ è½½å¾ªç¯ä¾èµ–\n- è§£å†³ï¼šå¿…é¡»æ¥æ”¶ mainPathï¼›ä½¿ç”¨ .new() åˆ›å»º JSB å¯¹è±¡ï¼›å»¶è¿ŸåŠ è½½ä¾èµ–æ¨¡å—\n\n### 2. æ’ä»¶ä¸åœ¨æ’ä»¶æ æ˜¾ç¤º  \n- åŸå› ï¼šç¼ºå°‘ queryAddonCommandStatus æ–¹æ³•ï¼›ç¼ºå°‘é™æ€æ–¹æ³•å¯¹è±¡ï¼›å›¾æ ‡å°ºå¯¸é”™è¯¯\n- è§£å†³ï¼šå®ç° queryAddonCommandStatus è¿”å›å›¾æ ‡é…ç½®ï¼›JSB.defineClass éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼ˆå®ä¾‹+é™æ€ï¼‰ï¼›logo.png å¿…é¡»æ˜¯ 44x44\n\n### 3. toggleAddon æ— å“åº”\n- åŸå› ï¼šJavaScript ä½œç”¨åŸŸé—®é¢˜ï¼›self æœªå®šä¹‰\n- è§£å†³ï¼šåœ¨æ–‡ä»¶é¡¶éƒ¨å®šä¹‰ var self = nullï¼›åœ¨ sceneWillConnect ä¸­è®¾ç½® self = this\n\n### 4. å…¶ä»–é‡è¦ç»éªŒ\n- UIAlertView ä¸å¯é ï¼Œä½¿ç”¨ MNUtil.input\n- å§‹ç»ˆæ£€æŸ¥ typeof MNUtil !== \"undefined\"\n- ä½¿ç”¨ UIWebView è€Œé WKWebView\n- æ¯ä¸ªå±é™©æ“ä½œéƒ½è¦ try-catch\n- å‚è€ƒ mntoolbar å’Œ mnutils çš„å®ç°æ¨¡å¼\n\n### å¼€å‘æ£€æŸ¥æ¸…å•\nâœ“ JSB.newAddon(mainPath)\nâœ“ queryAddonCommandStatus æ–¹æ³•\nâœ“ JSB.defineClass ä¸¤ä¸ªå‚æ•°\nâœ“ sceneWillConnect ä¸­ self = this\nâœ“ MNUtil å­˜åœ¨æ€§æ£€æŸ¥\nâœ“ ä½¿ç”¨ .new() åˆ›å»ºå¯¹è±¡\nâœ“ logo.png 44x44 åƒç´ ",
        "--tags",
        "marginnote plugin development mntask troubleshooting jsb"
      ]
    },
    {
      "from": "memory_saved",
      "command": "recall",
      "timestamp": "2025-06-28T12:37:18.579Z",
      "args": []
    },
    {
      "from": "recall-waiting",
      "command": "remember",
      "timestamp": "2025-06-28T12:59:27.730Z",
      "args": [
        "## MarginNote æ’ä»¶é—ªé€€é—®é¢˜ç»ˆæè§£å†³æ–¹æ¡ˆ (MNTask 2025-06-28)\n\n### é—®é¢˜ï¼šå®‰è£…æ’ä»¶å MarginNote4 å®Œå…¨é—ªé€€ï¼Œé‡å¯ä»ç„¶é—ªé€€\n\n### æ ¹æœ¬åŸå› ï¼š\n1. **æ¨¡å—åŠ è½½æ—¶æœºé”™è¯¯** - åœ¨ JSB.newAddon å‡½æ•°å†…éƒ¨åŠ è½½æ¨¡å—ä¼šå¯¼è‡´é—ªé€€\n2. **ES6 è¯­æ³•å…¼å®¹æ€§** - è™½ç„¶ MNUtils ä½¿ç”¨äº† classï¼Œä½†åœ¨æ’ä»¶åˆå§‹åŒ–é˜¶æ®µä½¿ç”¨å¯èƒ½æœ‰é—®é¢˜\n\n### è§£å†³æ–¹æ¡ˆï¼š\n\n1. **å°†æ¨¡å—åŠ è½½ç§»åˆ°æ–‡ä»¶æœ«å°¾**ï¼ˆæœ€å…³é”®ï¼‰ï¼š\n```javascript\n// âŒ é”™è¯¯ - åœ¨ JSB.newAddon å†…éƒ¨åŠ è½½\nJSB.newAddon = function(mainPath) {\n  JSB.require('taskModel');  // å¯¼è‡´é—ªé€€ï¼\n  // ...\n}\n\n// âœ… æ­£ç¡® - åœ¨æ–‡ä»¶æœ«å°¾åŠ è½½\nJSB.newAddon = function(mainPath) {\n  // åªå®šä¹‰ç±»ï¼Œä¸åŠ è½½æ¨¡å—\n  return MNTaskMain;\n};\n\n// æ–‡ä»¶æœ«å°¾\nJSB.require('mnutils');\nJSB.require('taskModel');\nJSB.require('taskController');\n```\n\n2. **ES6 class æ”¹ä¸ºä¼ ç»Ÿå‡½æ•°å¼**ï¼š\n```javascript\n// âŒ å¯èƒ½æœ‰é—®é¢˜\nclass TaskModel { }\n\n// âœ… æ›´å®‰å…¨\nfunction TaskModel() { }\nTaskModel.prototype.method = function() { }\n```\n\n3. **ç§»é™¤å±é™©çš„çˆ¶ç±»è°ƒç”¨**ï¼š\n```javascript\n// âŒ é”™è¯¯\nself.super.init();\n\n// âœ… ç›´æ¥åˆå§‹åŒ–\n// ä¸è°ƒç”¨çˆ¶ç±»\n```\n\n### è°ƒè¯•æŠ€å·§ï¼š\n- ä½¿ç”¨ Console.app æŸ¥çœ‹å´©æºƒæ—¥å¿—\n- é€æ­¥æ’é™¤æ³•ï¼šå…ˆåˆ›å»ºæœ€ç®€å•çš„æ’ä»¶ï¼Œé€æ­¥æ·»åŠ åŠŸèƒ½\n- å¯¹æ¯”æˆåŠŸè¿è¡Œçš„æ’ä»¶ï¼ˆå¦‚ MNToolbarï¼‰çš„ç»“æ„\n\n### å…³é”®ç»éªŒï¼š\n- MarginNote çš„ JSB ç¯å¢ƒåœ¨ä¸åŒé˜¶æ®µå¯¹ JS ç‰¹æ€§çš„æ”¯æŒä¸åŒ\n- æ¨¡å—åŠ è½½é¡ºåºæå…¶é‡è¦ï¼Œå¿…é¡»åœ¨æ–‡ä»¶æœ«å°¾åŠ è½½\n- å‚è€ƒæˆåŠŸæ’ä»¶çš„æ¨¡å¼ï¼Œä¸è¦åˆ›æ–°",
        "--tags",
        "marginnote plugin crash mntask troubleshooting jsb module-loading"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-28T13:06:21.873Z",
      "args": [
        "## MarginNote æ’ä»¶é—ªé€€é—®é¢˜æ·±åº¦åˆ†æ (2025-06-28)\n\n### é—®é¢˜ç±»å‹ï¼šåº”ç”¨é—ªé€€ vs åº”ç”¨å¡æ­»\n- **é—ªé€€**ï¼šMarginNote ç›´æ¥å´©æºƒé€€å‡ºï¼Œé‡å¯ä»ç„¶é—ªé€€ï¼ˆæœ¬æ¬¡é‡åˆ°çš„é—®é¢˜ï¼‰\n- **å¡æ­»**ï¼šMarginNote æ— å“åº”ä½†ä¸é€€å‡ºï¼Œéœ€è¦å¼ºåˆ¶é€€å‡º\n\n### é—ªé€€æ ¹æœ¬åŸå› ï¼šæ¨¡å—åŠ è½½æ—¶æœºé”™è¯¯ ğŸš¨\n\n**æœ€å…³é”®å‘ç°**ï¼šMarginNote çš„ JSB ç¯å¢ƒå¯¹æ¨¡å—åŠ è½½æ—¶æœºæå…¶æ•æ„Ÿï¼\n\n```javascript\n// âŒ è‡´å‘½é”™è¯¯ - åœ¨ JSB.newAddon å†…éƒ¨åŠ è½½æ¨¡å—\nJSB.newAddon = function(mainPath) {\n  JSB.require('taskModel');     // ğŸ’¥ å¯¼è‡´é—ªé€€ï¼\n  JSB.require('taskController'); // ğŸ’¥ å¯¼è‡´é—ªé€€ï¼\n  \n  var Plugin = JSB.defineClass(...);\n  return Plugin;\n};\n\n// âœ… æ­£ç¡®åšæ³• - æ–‡ä»¶æœ«å°¾åŠ è½½\nJSB.newAddon = function(mainPath) {\n  var Plugin = JSB.defineClass(...);\n  return Plugin;  // åªè¿”å›ç±»å®šä¹‰\n};\n\n// æ‰€æœ‰æ¨¡å—åŠ è½½å¿…é¡»åœ¨æ–‡ä»¶æœ«å°¾\nJSB.require('mnutils');\nJSB.require('taskModel');\nJSB.require('taskController');\n```\n\n### ä¸ºä»€ä¹ˆä¼šé—ªé€€ï¼Ÿ\n1. JSB.newAddon åœ¨æ’ä»¶åˆå§‹åŒ–çš„æ—©æœŸé˜¶æ®µæ‰§è¡Œ\n2. æ­¤æ—¶ JSB ç¯å¢ƒå¯èƒ½è¿˜æœªå®Œå…¨å‡†å¤‡å¥½\n3. åŠ è½½åŒ…å«ç‰¹å®šè¯­æ³•çš„æ¨¡å—ä¼šè§¦å‘å´©æºƒ\n4. æˆåŠŸè¿è¡Œçš„æ’ä»¶ï¼ˆMNToolbarã€MNUtilsï¼‰éƒ½åœ¨æ–‡ä»¶æœ«å°¾åŠ è½½æ¨¡å—\n\n### å…¶ä»–å¯¼è‡´é—ªé€€çš„å› ç´ \n1. **ES6 è¯­æ³•**ï¼šè™½ç„¶ MNUtils ä½¿ç”¨ classï¼Œä½†åœ¨æ’ä»¶åˆå§‹åŒ–é˜¶æ®µä½¿ç”¨å¯èƒ½å¯¼è‡´é—ªé€€\n2. **çˆ¶ç±»è°ƒç”¨**ï¼šé”™è¯¯çš„ super.init() è°ƒç”¨\n3. **å¾ªç¯ä¾èµ–**ï¼šæ¨¡å—é—´çš„å¾ªç¯å¼•ç”¨\n\n### è°ƒè¯•é—ªé€€çš„æ–¹æ³•\n1. ä½¿ç”¨ Console.app æŸ¥çœ‹å´©æºƒæ—¥å¿—\n2. æœç´¢ \"marginnote\" ç›¸å…³æ¡ç›®\n3. é€æ­¥æ’é™¤æ³•ï¼šä»æœ€ç®€å•çš„æ’ä»¶å¼€å§‹ï¼Œé€æ­¥æ·»åŠ åŠŸèƒ½\n4. å¯¹æ¯”æˆåŠŸæ’ä»¶çš„ä»£ç ç»“æ„\n\n### é¢„é˜²é—ªé€€çš„æœ€ä½³å®è·µ\n1. **ä¸¥æ ¼éµå®ˆæ¨¡å—åŠ è½½è§„åˆ™**ï¼šæ‰€æœ‰ JSB.require å¿…é¡»åœ¨æ–‡ä»¶æœ«å°¾\n2. **JSB.newAddon ä¿æŒçº¯å‡€**ï¼šåªå®šä¹‰å’Œè¿”å›ç±»ï¼Œä¸æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œ\n3. **é¿å…é«˜çº§è¯­æ³•**ï¼šåœ¨æ’ä»¶åˆå§‹åŒ–é˜¶æ®µä½¿ç”¨ä¼ ç»Ÿè¯­æ³•\n4. **å‚è€ƒæˆåŠŸæ¡ˆä¾‹**ï¼šä»¥ MNToolbar ä¸ºæ¨¡æ¿è¿›è¡Œå¼€å‘\n\n### é—ªé€€ vs å¡æ­»çš„åŒºåˆ«å¤„ç†\n- é—ªé€€ï¼šæ£€æŸ¥æ¨¡å—åŠ è½½æ—¶æœºã€è¯­æ³•å…¼å®¹æ€§\n- å¡æ­»ï¼šæ£€æŸ¥æ­»å¾ªç¯ã€æ— é™é€’å½’ã€åŒæ­¥é˜»å¡æ“ä½œ",
        "--tags",
        "marginnote plugin crash debugging jsb module-loading best-practices"
      ]
    },
    {
      "from": "memory_saved",
      "command": "recall",
      "timestamp": "2025-06-28T13:07:03.740Z",
      "args": []
    },
    {
      "from": "recall-waiting",
      "command": "init",
      "timestamp": "2025-06-28T13:49:21.530Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "init",
      "timestamp": "2025-06-28T14:37:33.903Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "init",
      "timestamp": "2025-06-28T15:14:04.647Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "init",
      "timestamp": "2025-06-28T15:27:44.964Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "init",
      "timestamp": "2025-06-29T03:17:05.815Z",
      "args": [
        {
          "workingDirectory": "/Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon"
        }
      ]
    },
    {
      "from": "initialized",
      "command": "remember",
      "timestamp": "2025-06-29T03:43:43.100Z",
      "args": [
        "## MN-Addon æ’ä»¶å¼€å‘æ¡†æ¶å­¦ä¹ è¿›å±• (2025-06-29)\n\n### å®Œæˆçš„ä»»åŠ¡\n\n1. **åˆ†æ mntexthandler æ’ä»¶æ¡†æ¶**\n   - ç†è§£äº†å¦‚ä½•åœ¨æ’ä»¶æ æ˜¾ç¤ºå›¾æ ‡ (queryAddonCommandStatus)\n   - æŒæ¡äº†ç‚¹å‡»å›¾æ ‡æ˜¾ç¤ºæ§åˆ¶é¢æ¿çš„æœºåˆ¶ (toggleAddon)\n   - å­¦ä¹ äº† UIViewController åˆ›å»ºæµ®åŠ¨é¢æ¿çš„æ–¹æ³•\n   - ç†è§£äº†æ‹–åŠ¨å’Œè°ƒæ•´å¤§å°çš„æ‰‹åŠ¿å¤„ç†\n\n2. **åˆ›å»º mntexthandler/CLAUDE.md æ–‡æ¡£**\n   - è¯¦ç»†è¯´æ˜äº†æ’ä»¶æ¡†æ¶çš„æ ¸å¿ƒç»“æ„\n   - æä¾›äº†ç²¾ç®€çš„ä»£ç ç¤ºä¾‹\n   - æ ‡æ³¨äº†å¯ä»¥ç”¨ MNUtils API ä¼˜åŒ–çš„éƒ¨åˆ†\n\n3. **å¼€å‘ simple-panel-plugin ç¤ºä¾‹æ’ä»¶**\n   - åˆ›å»ºäº†å®Œæ•´å¯è¿è¡Œçš„æœ€å°æ’ä»¶æ¡†æ¶\n   - å®ç°äº†æ’ä»¶æ å›¾æ ‡ã€æµ®åŠ¨é¢æ¿ã€è¾“å…¥è¾“å‡ºæ¡†ã€æŒ‰é’®å’Œèœå•\n   - æ”¯æŒæ‹–åŠ¨ä½ç½®å’Œè°ƒæ•´å¤§å°\n   - é›†æˆäº† MNUtils API å¹¶æä¾›é™çº§æ–¹æ¡ˆ\n\n4. **MNUtils API ä¼˜åŒ–**\n   - æ·±å…¥å­¦ä¹ äº† MNButton ç±»ï¼š\n     * é…ç½®å¯¹è±¡åˆ›å»ºæŒ‰é’®\n     * Proxy æ¨¡å¼çš„å±æ€§æ“ä½œ\n     * å¤šç§æ‰‹åŠ¿æ”¯æŒï¼ˆç‚¹å‡»ã€é•¿æŒ‰ã€æ‹–åŠ¨ã€æ»‘åŠ¨ï¼‰\n   - æŒæ¡äº† Menu ç±»çš„ä½¿ç”¨ï¼š\n     * è‡ªåŠ¨ä½ç½®è°ƒæ•´é¿å…è¶…å‡ºå±å¹•\n     * è‡ªå®šä¹‰è¡Œé«˜å’Œå­—ä½“å¤§å°\n     * æ‰¹é‡æ·»åŠ èœå•é¡¹\n     * dismiss() æ–¹æ³•ä¼˜é›…å…³é—­\n\n### å…³é”®ä»£ç æ¨¡å¼\n\n```javascript\n// MNButton åˆ›å»ºæ¨¡å¼\nconst button = MNButton.new({\n  title: \"æŒ‰é’®\",\n  font: 16,\n  color: \"#5982c4\",\n  radius: 8,\n  opacity: 0.9\n}, parentView);\nbutton.addClickAction(self, \"action:\");\n\n// Menu åˆ›å»ºæ¨¡å¼\nconst menu = new Menu(sender, self, 200, 2);\nmenu.rowHeight = 40;\nmenu.addMenuItem(\"é€‰é¡¹\", \"action:\", param, checked);\nmenu.show();\n```\n\n### é‡è¦æ–‡ä»¶ä½ç½®\n- /Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/mntexthandler/CLAUDE.md\n- /Users/xiakangwei/Nutstore/Github/repository/MN-addon-develop/MN-Addon/simple-panel-plugin/\n\n### ä¸‹ä¸€æ­¥è®¡åˆ’\n- å¯ä»¥åŸºäº simple-panel-plugin æ¡†æ¶å¼€å‘å…·ä½“åŠŸèƒ½æ’ä»¶\n- æ·±å…¥å­¦ä¹  MNNoteã€MNDocument ç­‰å…¶ä»–æ ¸å¿ƒç±»\n- ç ”ç©¶ xdyyutils.js ä¸­çš„å­¦æœ¯æ‰©å±•åŠŸèƒ½",
        "--tags",
        "MN-Addon MarginNote æ’ä»¶å¼€å‘ MNUtils MNButton Menu"
      ]
    },
    {
      "from": "memory_saved",
      "command": "recall",
      "timestamp": "2025-06-29T03:45:36.865Z",
      "args": []
    },
    {
      "from": "recall-waiting",
      "command": "remember",
      "timestamp": "2025-06-29T03:48:07.884Z",
      "args": [
        "## MarginNote æ’ä»¶ä¸åœ¨æ’ä»¶æ æ˜¾ç¤ºçš„é—®é¢˜æ’æŸ¥\n\n### é—®é¢˜ç°è±¡\nsimple-panel-plugin æ’ä»¶å®‰è£…åä¸åœ¨æ’ä»¶æ æ˜¾ç¤ºå›¾æ ‡ã€‚\n\n### é—®é¢˜åŸå› \nåœ¨ main.js ä¸­ä½¿ç”¨äº†å…¨å±€ `var self = null;` å£°æ˜ï¼Œè¿™ä¸ MarginNote çš„æ’ä»¶æ¡†æ¶ä¸å…¼å®¹ã€‚\n\n### è§£å†³æ–¹æ¡ˆ\n1. **ç§»é™¤å…¨å±€ self å£°æ˜**ï¼šåˆ é™¤æ–‡ä»¶å¼€å¤´çš„ `var self = null;`\n2. **åœ¨æ¯ä¸ªæ–¹æ³•å†…å£°æ˜ self**ï¼šåœ¨æ¯ä¸ªå®ä¾‹æ–¹æ³•å¼€å§‹æ—¶ä½¿ç”¨ `var self = this;`\n\n### æ­£ç¡®çš„ä»£ç æ¨¡å¼\n```javascript\nJSB.newAddon = function (mainPath) {\n  var PluginClass = JSB.defineClass('PluginClass : JSExtension', {\n    sceneWillConnect: function() {\n      var self = this;  // æ­£ç¡®ï¼šåœ¨æ–¹æ³•å†…å£°æ˜\n      // ...\n    },\n    \n    queryAddonCommandStatus: function() {\n      var self = this;  // æ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦\n      // ...\n    }\n  });\n  return PluginClass;\n};\n```\n\n### è°ƒè¯•æŠ€å·§\n1. åœ¨å…³é”®æ–¹æ³•ä¸­æ·»åŠ  HUD æç¤ºï¼š\n   ```javascript\n   self.appInstance.showHUD(\"è°ƒè¯•ä¿¡æ¯\", self.window, 2);\n   ```\n\n2. åœ¨ queryAddonCommandStatus ä¸­ä½¿ç”¨ NSLogï¼ˆå› ä¸ºè¿™ä¸ªæ–¹æ³•è¢«é¢‘ç¹è°ƒç”¨ï¼‰ï¼š\n   ```javascript\n   if (typeof NSLog !== \"undefined\") {\n     NSLog(\"queryAddonCommandStatus called\");\n   }\n   ```\n\n3. åˆ›å»ºæ‰“åŒ…è„šæœ¬è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹\n\n### æ’ä»¶æ˜¾ç¤ºçš„å¿…è¦æ¡ä»¶\n1. æ­£ç¡®å®ç° `queryAddonCommandStatus` æ–¹æ³•\n2. è¿”å›åŒ…å« `image`ã€`object`ã€`selector` çš„å¯¹è±¡\n3. å›¾æ ‡æ–‡ä»¶å¿…é¡»æ˜¯ 44x44 åƒç´ çš„ PNG\n4. åªåœ¨ studyMode < 3 æ—¶æ˜¾ç¤ºï¼ˆéå¤ä¹ æ¨¡å¼ï¼‰\n5. åœ¨ notebookWillOpen æ—¶è°ƒç”¨ refreshAddonCommands()\n\n### å…¶ä»–æ³¨æ„äº‹é¡¹\n- JSB.require åº”è¯¥åœ¨æ–‡ä»¶æœ«å°¾\n- ä¸è¦åœ¨å…¨å±€ä½œç”¨åŸŸå£°æ˜å®ä¾‹å˜é‡\n- å§‹ç»ˆæ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨å†ä½¿ç”¨",
        "--tags",
        "MarginNote æ’ä»¶å¼€å‘ è°ƒè¯•æŠ€å·§ æ’ä»¶æ æ˜¾ç¤º"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-29T03:54:01.122Z",
      "args": [
        "## MarginNote æ’ä»¶å¼€å‘å…³é”®æ•™è®­ï¼šJSB æ¡†æ¶ä¸­çš„ self ä½¿ç”¨\n\n### ä¸¥é‡é”™è¯¯æ¡ˆä¾‹\nåœ¨ JSB.defineClass ä¸­é”™è¯¯åœ°é‡æ–°å£°æ˜ self ä¼šå¯¼è‡´å´©æºƒï¼š\n\n```javascript\n// âŒ é”™è¯¯ç”¨æ³• - å¯¼è‡´æ— é™é€’å½’å´©æºƒ\nJSB.defineClass('Plugin : JSExtension', {\n  sceneWillConnect: function() {\n    var self = this;  // é”™è¯¯ï¼ä¸è¦é‡æ–°å£°æ˜\n  },\n  queryAddonCommandStatus: function() {\n    var self = this;  // é”™è¯¯ï¼ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨\n    return { object: self, ... };\n  }\n});\n```\n\n### æ­£ç¡®ç”¨æ³•\nJSB æ¡†æ¶è‡ªåŠ¨æä¾› self å®ä¾‹å¼•ç”¨ï¼š\n\n```javascript\n// âœ… æ­£ç¡®ç”¨æ³• - ç›´æ¥ä½¿ç”¨ self\nJSB.defineClass('Plugin : JSExtension', {\n  sceneWillConnect: function() {\n    self.appInstance = Application.sharedInstance();  // ç›´æ¥ä½¿ç”¨ self\n  },\n  queryAddonCommandStatus: function() {\n    return { \n      object: self,  // å®‰å…¨ä½¿ç”¨\n      selector: 'togglePanel:'\n    };\n  }\n});\n```\n\n### å´©æºƒç‰¹å¾\n- Exception Type: EXC_BAD_ACCESS (SIGSEGV)\n- å †æ ˆæ˜¾ç¤ºå¤§é‡ `-[NSDictionary isEqualToDictionary:]` é€’å½’è°ƒç”¨\n- åŸå› ï¼šé‡æ–°å£°æ˜ self åˆ›å»ºäº†ä¸åŒçš„å¯¹è±¡å¼•ç”¨ï¼Œå¯¼è‡´å†…éƒ¨æ¯”è¾ƒæ—¶äº§ç”Ÿå¾ªç¯\n\n### é‡è¦æé†’\n1. JSB æ¡†æ¶ä¸åŒäºæ™®é€š JavaScript\n2. self æ˜¯ç‰¹æ®Šçš„è‡ªåŠ¨å˜é‡ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½é‡æ–°å£°æ˜\n3. è¿™æ˜¯ MarginNote æ’ä»¶å¼€å‘çš„ç‰¹æœ‰é™·é˜±",
        "--tags",
        "MarginNote æ’ä»¶å¼€å‘ JSBæ¡†æ¶ å´©æºƒè°ƒè¯• selfå˜é‡"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-29T04:01:14.130Z",
      "args": [
        "## MarginNote æ’ä»¶ç•Œé¢å¡æ­»é—®é¢˜æ’æŸ¥ä¸ä¿®å¤\n\n### é—®é¢˜è¡¨ç°\n- ç‚¹å‡»æ’ä»¶æ å›¾æ ‡åç•Œé¢å®Œå…¨å¡æ­»\n- åªæœ‰åˆ†å‰²æŒ‰é’®èƒ½ç‚¹å‡»ï¼Œå…¶ä»–æ‰€æœ‰æ§ä»¶æ— å“åº”\n- æ’ä»¶èƒ½æ­£å¸¸åŠ è½½ä½†æ— æ³•äº¤äº’\n\n### é—®é¢˜åŸå› \n1. **ä¸»çº¿ç¨‹é˜»å¡**ï¼šåœ¨ notebookWillOpen ä¸­ç«‹å³æ·»åŠ è§†å›¾å¯èƒ½å¯¼è‡´é˜»å¡\n2. **HUD è°ƒè¯•æ—¥å¿—**ï¼šé¢‘ç¹ä½¿ç”¨ showHUD ä¼šé˜»å¡ä¸»çº¿ç¨‹\n3. **shadowColor è®¾ç½®é—®é¢˜**ï¼šæŸäº› layer å±æ€§è®¾ç½®å¯èƒ½å¼•èµ·æ¸²æŸ“é—®é¢˜\n\n### è§£å†³æ–¹æ¡ˆ\n\n1. **ä½¿ç”¨ MNUtil.log ä»£æ›¿ HUD**ï¼š\n```javascript\n// âŒ é”™è¯¯ï¼šé˜»å¡ä¸»çº¿ç¨‹\nself.appInstance.showHUD(\"è°ƒè¯•ä¿¡æ¯\", self.window, 2);\n\n// âœ… æ­£ç¡®ï¼šä½¿ç”¨ MNUtil.log\nif (typeof MNUtil !== \"undefined\" && MNUtil.log) {\n  MNUtil.log(\"ğŸ”§ è°ƒè¯•ä¿¡æ¯\");\n}\n```\n\n2. **å»¶è¿Ÿæ·»åŠ è§†å›¾**ï¼š\n```javascript\n// ä½¿ç”¨ NSTimer å»¶è¿Ÿæ·»åŠ è§†å›¾\nNSTimer.scheduledTimerWithTimeInterval(0.1, false, function() {\n  var studyView = self.appInstance.studyController(self.window).view;\n  if (studyView && self.panelController && self.panelController.view) {\n    studyView.addSubview(self.panelController.view);\n  }\n});\n```\n\n3. **å»¶è¿Ÿåˆ·æ–°æ’ä»¶æ **ï¼š\n```javascript\n// é¿å…ç«‹å³åˆ·æ–°å¯¼è‡´é˜»å¡\nNSTimer.scheduledTimerWithTimeInterval(0.1, false, function() {\n  self.appInstance.studyController(self.window).refreshAddonCommands();\n});\n```\n\n4. **å®‰å…¨æ£€æŸ¥**ï¼š\n```javascript\n// åœ¨æ“ä½œå‰è¿›è¡Œå®‰å…¨æ£€æŸ¥\nif (!self.view || !frame || frame.width <= 0) return;\n```\n\n### æŸ¥çœ‹æ—¥å¿—æ–¹æ³•\n1. æ‰“å¼€ MNUtils æ’ä»¶\n2. è¿›å…¥æ—¥å¿—æŸ¥çœ‹å™¨\n3. å¯ä»¥çœ‹åˆ°æ‰€æœ‰ MNUtil.log è¾“å‡ºçš„å†…å®¹\n\n### è°ƒè¯•æŠ€å·§\n- ä½¿ç”¨ emoji æ ‡è®°ä¸åŒç±»å‹çš„æ—¥å¿—ï¼šğŸš€ å¯åŠ¨ã€âœ… æˆåŠŸã€âŒ é”™è¯¯ã€âš ï¸ è­¦å‘Š\n- åœ¨å…³é”®æµç¨‹èŠ‚ç‚¹æ·»åŠ æ—¥å¿—\n- ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸å¹¶è®°å½•",
        "--tags",
        "MarginNote æ’ä»¶å¼€å‘ ç•Œé¢å¡æ­» è°ƒè¯•æŠ€å·§ MNUtil.log"
      ]
    },
    {
      "from": "memory_saved",
      "command": "remember",
      "timestamp": "2025-06-29T04:06:13.211Z",
      "args": [
        "## JSB æ¡†æ¶ä¸­ self å˜é‡çš„æ­£ç¡®ä½¿ç”¨ - å®Œæ•´æŒ‡å—\n\n### æ ¸å¿ƒåŸåˆ™\nåœ¨ JSB.defineClass ä¸­ï¼Œ`self` æ˜¯æ¡†æ¶è‡ªåŠ¨æä¾›çš„å®ä¾‹å¼•ç”¨ï¼Œç»å¯¹ä¸èƒ½é‡æ–°å£°æ˜ï¼\n\n### é”™è¯¯ç¤ºä¾‹å¯¼è‡´çš„é—®é¢˜\n\n1. **ä¸»ç±»ä¸­é‡æ–°å£°æ˜ self å¯¼è‡´å´©æºƒ**ï¼š\n```javascript\n// âŒ é”™è¯¯ - å¯¼è‡´æ— é™é€’å½’å´©æºƒ\nJSB.defineClass('Plugin : JSExtension', {\n  sceneWillConnect: function() {\n    var self = this;  // å´©æºƒï¼\n  }\n});\n```\n\n2. **UIViewController ä¸­é‡æ–°å£°æ˜ self å¯¼è‡´ view ä¸º null**ï¼š\n```javascript\n// âŒ é”™è¯¯ - å¯¼è‡´ view æ— æ³•åˆ›å»º\nJSB.defineClass('Controller : UIViewController', {\n  viewDidLoad: function() {\n    var self = this;  // view ä¼šæ˜¯ nullï¼\n    self.view.backgroundColor = ...  // å¤±è´¥\n  }\n});\n```\n\n### æ­£ç¡®ç”¨æ³•\n```javascript\n// âœ… æ­£ç¡® - ç›´æ¥ä½¿ç”¨ self\nJSB.defineClass('Plugin : JSExtension', {\n  sceneWillConnect: function() {\n    self.appInstance = Application.sharedInstance();\n  }\n});\n\nJSB.defineClass('Controller : UIViewController', {\n  viewDidLoad: function() {\n    // ç›´æ¥ä½¿ç”¨ selfï¼Œä¸è¦å£°æ˜\n    self.view.backgroundColor = UIColor.whiteColor();\n    self.view.layer.cornerRadius = 11;\n  }\n});\n```\n\n### ç—‡çŠ¶å¯¹ç…§è¡¨\n| ç—‡çŠ¶ | åŸå›  | è§£å†³æ–¹æ¡ˆ |\n|------|------|----------|\n| å´©æºƒï¼Œæ— é™é€’å½’ | ä¸»ç±»ä¸­ var self = this | ç§»é™¤å£°æ˜ |\n| UIViewController.view ä¸º null | æ§åˆ¶å™¨ä¸­ var self = this | ç§»é™¤å£°æ˜ |\n| ç•Œé¢ä¸æ˜¾ç¤º | view åˆ›å»ºå¤±è´¥ | æ£€æŸ¥æ‰€æœ‰ self ä½¿ç”¨ |\n\n### è°ƒè¯•æ–¹æ³•\n```javascript\n// æ£€æŸ¥ view æ˜¯å¦å­˜åœ¨\nif (self.view) {\n  MNUtil.log(\"âœ… view å­˜åœ¨: \" + JSON.stringify(self.view.frame));\n} else {\n  MNUtil.log(\"âŒ view æ˜¯ null!\");\n}\n```\n\n### é‡è¦æé†’\n- JSB ä¸æ˜¯æ ‡å‡† JavaScriptï¼Œæœ‰è‡ªå·±çš„è§„åˆ™\n- self æ˜¯ç‰¹æ®Šå˜é‡ï¼Œç±»ä¼¼äº Python çš„ self\n- è¿™æ˜¯ MarginNote æ’ä»¶å¼€å‘æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ä¹‹ä¸€",
        "--tags",
        "MarginNote JSBæ¡†æ¶ selfå˜é‡ UIViewController è°ƒè¯•"
      ]
    }
  ],
  "lastUpdated": "2025-06-29T04:06:13.214Z"
}
