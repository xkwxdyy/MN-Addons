<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MNTask ç„¦ç‚¹ä»»åŠ¡çœ‹æ¿</title>
    
    <style>
        /* ========================================
           ğŸ¨ CSS å˜é‡å®šä¹‰ - ç°ä»£åŒ–è®¾è®¡ç³»ç»Ÿ
           ======================================== */
        :root {
            /* ä¸»é¢˜è‰² - æ·±è‰²ç³» */
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-hover: rgba(255, 255, 255, 0.06);
            --bg-active: rgba(102, 126, 234, 0.15);
            --bg-focus: rgba(102, 126, 234, 0.25);
            
            /* ç»ç’ƒæ•ˆæœ */
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: blur(10px);
            
            /* æ–‡å­—é¢œè‰² */
            --text-primary: #ffffff;
            --text-secondary: #a8a8b8;
            --text-muted: #6c6c7c;
            --text-disabled: #4a4a5a;
            
            /* ä»»åŠ¡ç±»å‹é¢œè‰² */
            --type-goal: #667eea;        /* ç›®æ ‡ - ç´«è“ */
            --type-kr: #f687b3;          /* å…³é”®ç»“æœ - ç²‰çº¢ */
            --type-project: #48bb78;     /* é¡¹ç›® - ç»¿è‰² */
            --type-action: #ed8936;      /* åŠ¨ä½œ - æ©™è‰² */
            
            /* çŠ¶æ€é¢œè‰² */
            --status-todo: #718096;      /* æœªå¼€å§‹ - ç°è‰² */
            --status-doing: #f6ad55;     /* è¿›è¡Œä¸­ - æ©™é»„ */
            --status-done: #48bb78;      /* å·²å®Œæˆ - ç»¿è‰² */
            
            /* ä¼˜å…ˆçº§é¢œè‰² */
            --priority-high: #fc8181;    /* é«˜ - çº¢è‰² */
            --priority-medium: #f6e05e;  /* ä¸­ - é»„è‰² */
            --priority-low: #68d391;     /* ä½ - ç»¿è‰² */
            
            /* å…¶ä»–æ ·å¼å˜é‡ */
            --radius: 12px;
            --radius-sm: 6px;
            --radius-lg: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* é—´è·ç³»ç»Ÿ */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
        }

        /* ========================================
           ğŸ“ åŸºç¡€æ ·å¼é‡ç½®
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--glass-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-disabled);
        }

        /* ========================================
           ğŸ—ï¸ ä¸»å¸ƒå±€ç»“æ„
           ======================================== */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 100;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            flex: 1;
        }

        .navbar-title {
            font-size: 1.25rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--type-goal) 0%, var(--type-kr) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* å¿«é€Ÿæ·»åŠ ä»»åŠ¡è¾“å…¥æ¡† */
        .quick-add-container {
            flex: 1;
            max-width: 500px;
        }

        .quick-add-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .quick-add-input:focus {
            outline: none;
            border-color: var(--type-goal);
            background: var(--bg-hover);
        }

        .quick-add-input::placeholder {
            color: var(--text-muted);
        }

        /* è§†å›¾åˆ‡æ¢æŒ‰é’®ç»„ */
        .view-switcher {
            display: flex;
            gap: var(--spacing-xs);
            background: var(--bg-card);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
        }

        .view-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .view-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .view-btn.active {
            background: var(--bg-active);
            color: var(--type-goal);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ  - è‡ªå®šä¹‰è§†å›¾ */
        .sidebar {
            width: 240px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-right: 1px solid var(--glass-border);
            padding: var(--spacing-lg);
            overflow-y: auto;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-240px);
            margin-right: -240px;
        }

        .sidebar-section {
            margin-bottom: var(--spacing-xl);
        }

        .sidebar-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* è‡ªå®šä¹‰è§†å›¾åˆ—è¡¨ */
        .custom-view-item {
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.875rem;
        }

        .custom-view-item:hover {
            background: var(--bg-hover);
        }

        .custom-view-item.active {
            background: var(--bg-active);
            color: var(--type-goal);
        }

        /* å·¥ä½œåŒº */
        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }

        /* è§†å›¾å®¹å™¨ */
        .view-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-lg);
        }

        /* ========================================
           ğŸ¯ ç„¦ç‚¹ä»»åŠ¡è§†å›¾
           ======================================== */
        .focus-view {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* å½“å‰ç„¦ç‚¹ä»»åŠ¡ */
        .current-focus-section {
            margin-bottom: var(--spacing-xl);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .focus-task-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-lg);
        }

        .focus-task-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .focus-task-card:hover {
            border-color: var(--type-goal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .focus-task-card.active {
            border-color: var(--type-goal);
            background: var(--bg-focus);
        }

        /* ä»»åŠ¡ç±»å‹æ ‡ç­¾ */
        .task-type-badge {
            display: inline-flex;
            align-items: center;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: var(--spacing-md);
        }

        .task-type-badge.goal {
            background: rgba(102, 126, 234, 0.2);
            color: var(--type-goal);
        }

        .task-type-badge.kr {
            background: rgba(246, 135, 179, 0.2);
            color: var(--type-kr);
        }

        .task-type-badge.project {
            background: rgba(72, 187, 120, 0.2);
            color: var(--type-project);
        }

        .task-type-badge.action {
            background: rgba(237, 137, 54, 0.2);
            color: var(--type-action);
        }

        .focus-task-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            line-height: 1.4;
        }

        .focus-task-meta {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .focus-task-actions {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .btn-primary {
            background: var(--type-goal);
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd6;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--text-muted);
        }

        /* å¯åŠ¨æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .btn-launch {
            background: linear-gradient(135deg, var(--type-goal) 0%, var(--type-kr) 100%);
            color: white;
            font-weight: 600;
        }

        .btn-launch:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            margin-top: var(--spacing-md);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
            font-size: 0.875rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--type-goal) 0%, var(--type-kr) 100%);
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ========================================
           ğŸ“… ä»Šæ—¥æ—¶é—´è½´è§†å›¾
           ======================================== */
        .timeline-section {
            margin-top: var(--spacing-xl);
        }

        .timeline-container {
            position: relative;
            padding-left: var(--spacing-xl);
        }

        .timeline-line {
            position: absolute;
            left: 12px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--glass-border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .timeline-dot {
            position: absolute;
            left: -20px;
            top: 8px;
            width: 8px;
            height: 8px;
            background: var(--type-goal);
            border-radius: 50%;
            box-shadow: 0 0 0 4px var(--bg-primary), 0 0 0 6px var(--glass-border);
        }

        .timeline-time {
            min-width: 60px;
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .timeline-content {
            flex: 1;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            transition: var(--transition);
        }

        .timeline-content:hover {
            border-color: var(--type-goal);
            background: var(--bg-hover);
        }

        /* ========================================
           ğŸ” ç­›é€‰å™¨é¢æ¿
           ======================================== */
        .filter-panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .filter-row {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .filter-input {
            width: 100%;
            padding: var(--spacing-sm);
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .filter-tag {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-tag:hover {
            border-color: var(--type-goal);
        }

        .filter-tag.active {
            background: var(--bg-active);
            border-color: var(--type-goal);
            color: var(--type-goal);
        }

        /* ========================================
           ğŸ’¾ å¯ä¿å­˜è§†å›¾ç®¡ç†
           ======================================== */
        .save-view-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: transparent;
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .save-view-btn:hover {
            border-color: var(--type-goal);
            color: var(--type-goal);
        }

        /* ========================================
           ğŸ“Š è¿›å±•è®°å½•é¢æ¿
           ======================================== */
        .progress-log-panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-md);
        }

        .progress-log-item {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .progress-log-item:last-child {
            border-bottom: none;
        }

        .progress-log-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            min-width: 120px;
        }

        .progress-log-content {
            flex: 1;
            font-size: 0.875rem;
        }

        .progress-log-value {
            font-weight: 600;
            color: var(--type-goal);
        }

        /* ========================================
           ğŸ¨ åŠ¨ç”»æ•ˆæœ
           ======================================== */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ========================================
           ğŸ“± å“åº”å¼è®¾è®¡
           ======================================== */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
                box-shadow: var(--shadow-lg);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .navbar {
                flex-wrap: wrap;
                gap: var(--spacing-md);
            }

            .quick-add-container {
                order: 3;
                flex-basis: 100%;
            }

            .focus-task-container {
                grid-template-columns: 1fr;
            }
        }

        /* ========================================
           ğŸ› ï¸ å·¥å…·ç±»
           ======================================== */
        .hidden {
            display: none !important;
        }

        .text-muted {
            color: var(--text-muted);
        }

        .text-small {
            font-size: 0.875rem;
        }

        .mt-1 { margin-top: var(--spacing-sm); }
        .mt-2 { margin-top: var(--spacing-md); }
        .mt-3 { margin-top: var(--spacing-lg); }
        .mb-1 { margin-bottom: var(--spacing-sm); }
        .mb-2 { margin-bottom: var(--spacing-md); }
        .mb-3 { margin-bottom: var(--spacing-lg); }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="navbar-left">
                <h1 class="navbar-title">MNTask ç„¦ç‚¹çœ‹æ¿</h1>
                
                <!-- å¿«é€Ÿæ·»åŠ ä»»åŠ¡ -->
                <div class="quick-add-container">
                    <input type="text" 
                           class="quick-add-input" 
                           placeholder="å¿«é€Ÿæ·»åŠ ä»»åŠ¡... (è¾“å…¥åæŒ‰Enterï¼Œæ”¯æŒ #æ ‡ç­¾ @é¡¹ç›® !ä¼˜å…ˆçº§)"
                           onkeypress="handleQuickAdd(event)">
                </div>
            </div>
            
            <!-- è§†å›¾åˆ‡æ¢ -->
            <div class="view-switcher">
                <button class="view-btn active" data-view="focus" onclick="switchView('focus')">
                    ğŸ¯ ç„¦ç‚¹ä»»åŠ¡
                </button>
                <button class="view-btn" data-view="today" onclick="switchView('today')">
                    ğŸ“… ä»Šæ—¥æ—¶é—´è½´
                </button>
                <button class="view-btn" data-view="board" onclick="switchView('board')">
                    ğŸ“‹ çœ‹æ¿è§†å›¾
                </button>
                <button class="view-btn" data-view="list" onclick="switchView('list')">
                    ğŸ“ åˆ—è¡¨è§†å›¾
                </button>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- ä¾§è¾¹æ  - è‡ªå®šä¹‰è§†å›¾ -->
            <aside class="sidebar" id="sidebar">
                <!-- å¿«é€Ÿç­›é€‰ -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">å¿«é€Ÿç­›é€‰</h3>
                    <div class="custom-view-item active" onclick="applyQuickFilter('current')">
                        <span>ğŸ¯ å½“å‰ç„¦ç‚¹</span>
                        <span class="text-small text-muted">3</span>
                    </div>
                    <div class="custom-view-item" onclick="applyQuickFilter('today')">
                        <span>ğŸ“… ä»Šæ—¥ä»»åŠ¡</span>
                        <span class="text-small text-muted">8</span>
                    </div>
                    <div class="custom-view-item" onclick="applyQuickFilter('high-priority')">
                        <span>ğŸ”´ é«˜ä¼˜å…ˆçº§</span>
                        <span class="text-small text-muted">5</span>
                    </div>
                    <div class="custom-view-item" onclick="applyQuickFilter('in-progress')">
                        <span>ğŸš€ è¿›è¡Œä¸­</span>
                        <span class="text-small text-muted">12</span>
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰è§†å›¾ -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <span>è‡ªå®šä¹‰è§†å›¾</span>
                        <button class="save-view-btn" onclick="saveCurrentView()">
                            + ä¿å­˜å½“å‰
                        </button>
                    </h3>
                    <div id="customViewsList">
                        <div class="custom-view-item" onclick="loadCustomView('plugin-bugs')">
                            <span>ğŸ› æ’ä»¶Bugæ±‡æ€»</span>
                            <span class="text-small text-muted">15</span>
                        </div>
                        <div class="custom-view-item" onclick="loadCustomView('week-focus')">
                            <span>ğŸ¯ æœ¬å‘¨é‡ç‚¹</span>
                            <span class="text-small text-muted">7</span>
                        </div>
                        <div class="custom-view-item" onclick="loadCustomView('review-needed')">
                            <span>ğŸ‘€ å¾…Review</span>
                            <span class="text-small text-muted">4</span>
                        </div>
                    </div>
                </div>

                <!-- é¡¹ç›®åˆ†ç»„ -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">é¡¹ç›®åˆ†ç»„</h3>
                    <div class="custom-view-item" onclick="filterByProject('mntask')">
                        <span>ğŸ“¦ MNTaskæ’ä»¶</span>
                        <span class="text-small text-muted">23</span>
                    </div>
                    <div class="custom-view-item" onclick="filterByProject('mnai')">
                        <span>ğŸ¤– MNAIæ’ä»¶</span>
                        <span class="text-small text-muted">18</span>
                    </div>
                    <div class="custom-view-item" onclick="filterByProject('research')">
                        <span>ğŸ”¬ ç ”ç©¶é¡¹ç›®</span>
                        <span class="text-small text-muted">12</span>
                    </div>
                </div>
            </aside>

            <!-- å·¥ä½œåŒº -->
            <div class="workspace">
                <!-- ç„¦ç‚¹ä»»åŠ¡è§†å›¾ -->
                <div id="view-focus" class="view-container">
                    <div class="focus-view">
                        <!-- å½“å‰ç„¦ç‚¹ä»»åŠ¡ -->
                        <div class="current-focus-section">
                            <div class="section-header">
                                <h2 class="section-title">ğŸ¯ å½“å‰ç„¦ç‚¹ä»»åŠ¡</h2>
                                <button class="btn btn-secondary" onclick="selectFocusTasks()">
                                    é€‰æ‹©ç„¦ç‚¹ä»»åŠ¡
                                </button>
                            </div>
                            
                            <div class="focus-task-container" id="focusTaskContainer">
                                <!-- ç„¦ç‚¹ä»»åŠ¡å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- æ™ºèƒ½ç­›é€‰å™¨ -->
                        <div class="filter-panel">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <div class="filter-label">æ ‡é¢˜åŒ…å«</div>
                                    <input type="text" class="filter-input" placeholder="æœç´¢ä»»åŠ¡æ ‡é¢˜..." onkeyup="filterTasks()">
                                </div>
                                <div class="filter-group">
                                    <div class="filter-label">æ ‡ç­¾ç­›é€‰</div>
                                    <input type="text" class="filter-input" placeholder="è¾“å…¥æ ‡ç­¾..." onkeyup="filterByTags()">
                                </div>
                                <div class="filter-group">
                                    <div class="filter-label">é¡¹ç›®ç­›é€‰</div>
                                    <select class="filter-input" onchange="filterBySelectedProject()">
                                        <option value="">æ‰€æœ‰é¡¹ç›®</option>
                                        <option value="mntask">MNTaskæ’ä»¶</option>
                                        <option value="mnai">MNAIæ’ä»¶</option>
                                        <option value="research">ç ”ç©¶é¡¹ç›®</option>
                                    </select>
                                </div>
                            </div>
                            <div class="filter-tags" id="activeFilters">
                                <!-- æ´»è·ƒçš„ç­›é€‰æ ‡ç­¾ -->
                            </div>
                        </div>

                        <!-- å¾…å¤„ç†ä»»åŠ¡æ¦‚è§ˆ -->
                        <div class="section-header mt-3">
                            <h2 class="section-title">ğŸ“‹ å¾…å¤„ç†ä»»åŠ¡</h2>
                            <span class="text-muted">å…± <span id="pendingCount">0</span> é¡¹</span>
                        </div>
                        <div id="pendingTasksList">
                            <!-- å¾…å¤„ç†ä»»åŠ¡åˆ—è¡¨ -->
                        </div>
                    </div>
                </div>

                <!-- ä»Šæ—¥æ—¶é—´è½´è§†å›¾ -->
                <div id="view-today" class="view-container hidden">
                    <div class="timeline-section">
                        <div class="section-header">
                            <h2 class="section-title">ğŸ“… ä»Šæ—¥ä»»åŠ¡æ—¶é—´è½´</h2>
                            <button class="btn btn-secondary" onclick="autoScheduleTasks()">
                                ğŸ¤– æ™ºèƒ½æ’æœŸ
                            </button>
                        </div>
                        
                        <div class="timeline-container" id="todayTimeline">
                            <div class="timeline-line"></div>
                            <!-- æ—¶é—´è½´é¡¹ç›®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- çœ‹æ¿è§†å›¾ï¼ˆå¾…å®ç°ï¼‰ -->
                <div id="view-board" class="view-container hidden">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ“‹ çœ‹æ¿è§†å›¾</h2>
                    </div>
                    <p class="text-muted">çœ‹æ¿è§†å›¾å¼€å‘ä¸­...</p>
                </div>

                <!-- åˆ—è¡¨è§†å›¾ï¼ˆå¾…å®ç°ï¼‰ -->
                <div id="view-list" class="view-container hidden">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ“ åˆ—è¡¨è§†å›¾</h2>
                    </div>
                    <p class="text-muted">åˆ—è¡¨è§†å›¾å¼€å‘ä¸­...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ========================================
           ğŸ“Š æ•°æ®æ¨¡å‹
           ======================================== */
        
        // ä»»åŠ¡æ•°æ®ç»“æ„
        let tasks = [];
        let currentView = 'focus';
        let focusTasks = new Set(); // å½“å‰ç„¦ç‚¹ä»»åŠ¡IDé›†åˆ
        let customViews = {}; // è‡ªå®šä¹‰è§†å›¾é…ç½®
        let activeFilters = {}; // å½“å‰æ¿€æ´»çš„ç­›é€‰å™¨

        // æ‰©å±•çš„ä»»åŠ¡æ•°æ®ç»“æ„ç¤ºä¾‹
        const taskTemplate = {
            id: "task_1",
            type: "åŠ¨ä½œ", // ç›®æ ‡ã€å…³é”®ç»“æœã€é¡¹ç›®ã€åŠ¨ä½œ
            status: "è¿›è¡Œä¸­", // æœªå¼€å§‹ã€è¿›è¡Œä¸­ã€å·²å®Œæˆ
            title: "ä¿®å¤MNTaskæ’ä»¶Bug",
            path: "Q1ç›®æ ‡ >> äº§å“ä¼˜åŒ– >> æ’ä»¶å¼€å‘",
            
            // æ–°å¢å­—æ®µ
            launchLink: "marginnote4app://note/xxx", // MN uistateé“¾æ¥
            currentFocus: true, // æ˜¯å¦æ˜¯å½“å‰ç„¦ç‚¹ä»»åŠ¡
            todayPlannedTime: "14:00-16:00", // ä»Šæ—¥è®¡åˆ’æ—¶é—´æ®µ
            
            // åŸæœ‰å­—æ®µ
            fields: {
                priority: "é«˜", // é«˜ã€ä¸­ã€ä½
                dueDate: "2025-01-25",
                tags: ["æ’ä»¶", "Bug", "ç´§æ€¥"],
                progress: 30,
                today: true, // æ˜¯å¦æ˜¯ä»Šæ—¥ä»»åŠ¡
                
                // æ–°å¢è¿›å±•è®°å½•
                progressLog: [
                    {
                        date: "2025-01-20 10:00",
                        progress: 30,
                        note: "å®Œæˆé—®é¢˜å®šä½ï¼Œå‘ç°æ˜¯TaskFieldUtilsæ–¹æ³•åå†²çª"
                    }
                ],
                
                // æ‰€å±çš„è‡ªå®šä¹‰è§†å›¾
                customViews: ["æ’ä»¶Bugæ±‡æ€»", "æœ¬å‘¨é‡ç‚¹"],
                
                // é¡¹ç›®å½’å±
                project: "mntask"
            }
        };

        /* ========================================
           ğŸš€ åˆå§‹åŒ–
           ======================================== */
        
        // ç”Ÿæˆæµ‹è¯•æ•°æ®
        function generateTestData() {
            let taskId = 1;
            
            // ç”Ÿæˆä¸€äº›ç„¦ç‚¹ä»»åŠ¡
            tasks.push({
                id: `task_${taskId++}`,
                type: "åŠ¨ä½œ",
                status: "è¿›è¡Œä¸­",
                title: "ä¿®å¤TaskFieldUtilsæ–¹æ³•åå†²çªé—®é¢˜",
                path: "MNTaskæ’ä»¶å¼€å‘ >> Bugä¿®å¤",
                launchLink: "marginnote4app://note/12345",
                currentFocus: true,
                todayPlannedTime: "09:00-11:00",
                fields: {
                    priority: "é«˜",
                    dueDate: "2025-01-20",
                    tags: ["MNTask", "Bug", "ç´§æ€¥"],
                    progress: 60,
                    today: true,
                    progressLog: [
                        {
                            date: "2025-01-20 09:00",
                            progress: 30,
                            note: "å®šä½åˆ°é—®é¢˜åŸå› "
                        },
                        {
                            date: "2025-01-20 10:30",
                            progress: 60,
                            note: "å®Œæˆä»£ç ä¿®å¤ï¼Œå‡†å¤‡æµ‹è¯•"
                        }
                    ],
                    customViews: ["æ’ä»¶Bugæ±‡æ€»", "ä»Šæ—¥å¿…åš"],
                    project: "mntask"
                }
            });

            tasks.push({
                id: `task_${taskId++}`,
                type: "é¡¹ç›®",
                status: "è¿›è¡Œä¸­",
                title: "å®ç°ä»»åŠ¡ç„¦ç‚¹çœ‹æ¿åŠŸèƒ½",
                path: "MNTaskæ’ä»¶å¼€å‘ >> æ–°åŠŸèƒ½",
                launchLink: "marginnote4app://note/67890",
                currentFocus: true,
                todayPlannedTime: "14:00-17:00",
                fields: {
                    priority: "é«˜",
                    dueDate: "2025-01-22",
                    tags: ["MNTask", "æ–°åŠŸèƒ½", "çœ‹æ¿"],
                    progress: 20,
                    today: true,
                    progressLog: [
                        {
                            date: "2025-01-20 14:00",
                            progress: 20,
                            note: "å®Œæˆç•Œé¢è®¾è®¡å’ŒåŸºç¡€æ¶æ„"
                        }
                    ],
                    customViews: ["æœ¬å‘¨é‡ç‚¹"],
                    project: "mntask"
                }
            });

            tasks.push({
                id: `task_${taskId++}`,
                type: "åŠ¨ä½œ",
                status: "æœªå¼€å§‹",
                title: "ä¼˜åŒ–MNAIæ’ä»¶æ€§èƒ½",
                path: "MNAIæ’ä»¶å¼€å‘ >> æ€§èƒ½ä¼˜åŒ–",
                launchLink: "",
                currentFocus: false,
                todayPlannedTime: "17:00-18:00",
                fields: {
                    priority: "ä¸­",
                    dueDate: "2025-01-21",
                    tags: ["MNAI", "æ€§èƒ½", "ä¼˜åŒ–"],
                    progress: 0,
                    today: true,
                    progressLog: [],
                    customViews: ["æœ¬å‘¨é‡ç‚¹"],
                    project: "mnai"
                }
            });

            // ç”Ÿæˆæ›´å¤šæµ‹è¯•ä»»åŠ¡
            const taskTitles = [
                "å®Œå–„æ’ä»¶æ–‡æ¡£",
                "å¤„ç†ç”¨æˆ·åé¦ˆçš„Issue",
                "ç ”ç©¶æ–°çš„APIæ¥å£",
                "é‡æ„æ ¸å¿ƒæ¨¡å—ä»£ç ",
                "æ·»åŠ å•å…ƒæµ‹è¯•",
                "æ›´æ–°ç‰ˆæœ¬å‘å¸ƒè¯´æ˜",
                "è°ƒç ”ç«å“åŠŸèƒ½",
                "è®¾è®¡æ–°çš„UIç»„ä»¶"
            ];

            const projects = ["mntask", "mnai", "research"];
            const priorities = ["é«˜", "ä¸­", "ä½"];
            const statuses = ["æœªå¼€å§‹", "è¿›è¡Œä¸­", "å·²å®Œæˆ"];

            for (let i = 0; i < 20; i++) {
                const isToday = Math.random() > 0.6;
                const project = projects[Math.floor(Math.random() * projects.length)];
                
                tasks.push({
                    id: `task_${taskId++}`,
                    type: ["ç›®æ ‡", "å…³é”®ç»“æœ", "é¡¹ç›®", "åŠ¨ä½œ"][Math.floor(Math.random() * 4)],
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    title: taskTitles[Math.floor(Math.random() * taskTitles.length)] + ` #${i + 1}`,
                    path: `${project} >> å­é¡¹ç›® ${Math.floor(i / 3)}`,
                    launchLink: Math.random() > 0.5 ? `marginnote4app://note/${Math.random().toString(36).substr(2, 9)}` : "",
                    currentFocus: false,
                    todayPlannedTime: isToday ? `${9 + Math.floor(Math.random() * 10)}:00-${10 + Math.floor(Math.random() * 10)}:00` : "",
                    fields: {
                        priority: priorities[Math.floor(Math.random() * priorities.length)],
                        dueDate: new Date(Date.now() + Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        tags: [project, priorities[Math.floor(Math.random() * priorities.length)]],
                        progress: Math.floor(Math.random() * 101),
                        today: isToday,
                        progressLog: [],
                        customViews: Math.random() > 0.7 ? ["æ’ä»¶Bugæ±‡æ€»"] : [],
                        project: project
                    }
                });
            }

            // å°†å‰3ä¸ªä»»åŠ¡è®¾ä¸ºç„¦ç‚¹ä»»åŠ¡
            focusTasks.add(tasks[0].id);
            focusTasks.add(tasks[1].id);
            focusTasks.add(tasks[2].id);

            console.log(`âœ… ç”Ÿæˆäº† ${tasks.length} ä¸ªæµ‹è¯•ä»»åŠ¡`);
        }

        /* ========================================
           ğŸ¯ ç„¦ç‚¹ä»»åŠ¡åŠŸèƒ½
           ======================================== */
        
        // æ¸²æŸ“ç„¦ç‚¹ä»»åŠ¡å¡ç‰‡
        function renderFocusTasks() {
            const container = document.getElementById('focusTaskContainer');
            const focusTasksList = tasks.filter(task => focusTasks.has(task.id));
            
            container.innerHTML = focusTasksList.map(task => `
                <div class="focus-task-card ${task.currentFocus ? 'active' : ''} fade-in" onclick="toggleCurrentFocus('${task.id}')">
                    <div class="task-type-badge ${task.type.toLowerCase()}">
                        ${getTaskTypeIcon(task.type)} ${task.type}
                    </div>
                    
                    <h3 class="focus-task-title">${task.title}</h3>
                    
                    <div class="focus-task-meta">
                        <span>${getStatusIcon(task.status)} ${task.status}</span>
                        <span>${getPriorityIcon(task.fields.priority)} ${task.fields.priority}</span>
                        ${task.fields.dueDate ? `<span>ğŸ“… ${formatDate(task.fields.dueDate)}</span>` : ''}
                    </div>
                    
                    ${task.todayPlannedTime ? `
                        <div class="focus-task-meta">
                            <span>â° ${task.todayPlannedTime}</span>
                        </div>
                    ` : ''}
                    
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>è¿›åº¦</span>
                            <span class="progress-value">${task.fields.progress || 0}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${task.fields.progress || 0}%"></div>
                        </div>
                    </div>
                    
                    <div class="focus-task-actions">
                        ${task.launchLink ? `
                            <button class="btn btn-launch" onclick="launchTask(event, '${task.id}')">
                                ğŸš€ å¯åŠ¨
                            </button>
                        ` : `
                            <button class="btn btn-secondary" onclick="setLaunchLink(event, '${task.id}')">
                                ğŸ”— è®¾ç½®å¯åŠ¨é“¾æ¥
                            </button>
                        `}
                        <button class="btn btn-secondary" onclick="updateProgress(event, '${task.id}')">
                            ğŸ“ˆ æ›´æ–°è¿›åº¦
                        </button>
                        <button class="btn btn-secondary" onclick="viewProgressLog(event, '${task.id}')">
                            ğŸ“Š è¿›å±•è¯¦æƒ…
                        </button>
                    </div>
                </div>
            `).join('') || '<p class="text-muted">æš‚æ— ç„¦ç‚¹ä»»åŠ¡ï¼Œè¯·ä»ä»»åŠ¡åˆ—è¡¨ä¸­é€‰æ‹©</p>';
            
            // æ›´æ–°å¾…å¤„ç†ä»»åŠ¡
            renderPendingTasks();
        }

        // æ¸²æŸ“å¾…å¤„ç†ä»»åŠ¡
        function renderPendingTasks() {
            const pendingTasks = tasks.filter(task => 
                task.status !== 'å·²å®Œæˆ' && !focusTasks.has(task.id)
            );
            
            document.getElementById('pendingCount').textContent = pendingTasks.length;
            
            const container = document.getElementById('pendingTasksList');
            container.innerHTML = pendingTasks.slice(0, 10).map(task => `
                <div class="timeline-content mb-2 slide-in" style="cursor: pointer;" onclick="addToFocus('${task.id}')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="task-type-badge ${task.type.toLowerCase()} text-small">
                                ${getTaskTypeIcon(task.type)} ${task.type}
                            </span>
                            <span class="text-small text-muted ml-2">${task.fields.priority}ä¼˜å…ˆçº§</span>
                        </div>
                        <button class="btn btn-secondary" style="padding: 4px 12px; font-size: 0.75rem;">
                            + æ·»åŠ åˆ°ç„¦ç‚¹
                        </button>
                    </div>
                    <div class="mt-1 font-weight-500">${task.title}</div>
                    ${task.fields.dueDate ? `<div class="text-small text-muted">æˆªæ­¢: ${formatDate(task.fields.dueDate)}</div>` : ''}
                </div>
            `).join('') || '<p class="text-muted">æš‚æ— å¾…å¤„ç†ä»»åŠ¡</p>';
        }

        /* ========================================
           ğŸ“… ä»Šæ—¥æ—¶é—´è½´åŠŸèƒ½
           ======================================== */
        
        // æ¸²æŸ“ä»Šæ—¥æ—¶é—´è½´
        function renderTodayTimeline() {
            const todayTasks = tasks.filter(task => task.fields.today);
            const container = document.getElementById('todayTimeline');
            
            // æŒ‰è®¡åˆ’æ—¶é—´æ’åº
            todayTasks.sort((a, b) => {
                const timeA = a.todayPlannedTime ? parseInt(a.todayPlannedTime.split(':')[0]) : 24;
                const timeB = b.todayPlannedTime ? parseInt(b.todayPlannedTime.split(':')[0]) : 24;
                return timeA - timeB;
            });
            
            container.innerHTML = `
                <div class="timeline-line"></div>
                ${todayTasks.map(task => `
                    <div class="timeline-item fade-in">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">${task.todayPlannedTime || 'å¾…å®‰æ’'}</div>
                        <div class="timeline-content" onclick="viewTaskDetail('${task.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="task-type-badge ${task.type.toLowerCase()} text-small">
                                    ${getTaskTypeIcon(task.type)} ${task.type}
                                </span>
                                <span class="${getStatusClass(task.status)} text-small">
                                    ${getStatusIcon(task.status)} ${task.status}
                                </span>
                            </div>
                            <div class="mt-1 font-weight-500">${task.title}</div>
                            <div class="text-small text-muted mt-1">
                                ${task.path}
                            </div>
                            ${task.launchLink ? `
                                <button class="btn btn-launch mt-2" style="padding: 4px 12px; font-size: 0.75rem;" onclick="launchTask(event, '${task.id}')">
                                    ğŸš€ å¯åŠ¨ä»»åŠ¡
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('')}
            ` || '<p class="text-muted">ä»Šæ—¥æš‚æ— å®‰æ’ä»»åŠ¡</p>';
        }

        /* ========================================
           ğŸ” ç­›é€‰åŠŸèƒ½
           ======================================== */
        
        // åº”ç”¨å¿«é€Ÿç­›é€‰
        function applyQuickFilter(filterType) {
            // æ›´æ–°ä¾§è¾¹æ é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.custom-view-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.custom-view-item').classList.add('active');
            
            // åº”ç”¨ç­›é€‰é€»è¾‘
            switch(filterType) {
                case 'current':
                    // æ˜¾ç¤ºç„¦ç‚¹ä»»åŠ¡
                    switchView('focus');
                    break;
                case 'today':
                    // åˆ‡æ¢åˆ°ä»Šæ—¥è§†å›¾
                    switchView('today');
                    break;
                case 'high-priority':
                    // ç­›é€‰é«˜ä¼˜å…ˆçº§ä»»åŠ¡
                    activeFilters.priority = 'é«˜';
                    applyFilters();
                    break;
                case 'in-progress':
                    // ç­›é€‰è¿›è¡Œä¸­çš„ä»»åŠ¡
                    activeFilters.status = 'è¿›è¡Œä¸­';
                    applyFilters();
                    break;
            }
        }

        // ä¿å­˜å½“å‰è§†å›¾
        function saveCurrentView() {
            const viewName = prompt('è¯·è¾“å…¥è§†å›¾åç§°ï¼š');
            if (!viewName) return;
            
            // ä¿å­˜å½“å‰çš„ç­›é€‰é…ç½®
            customViews[viewName] = {
                filters: {...activeFilters},
                focusTasks: [...focusTasks],
                viewType: currentView
            };
            
            // æ·»åŠ åˆ°ä¾§è¾¹æ 
            const viewsList = document.getElementById('customViewsList');
            const newItem = document.createElement('div');
            newItem.className = 'custom-view-item slide-in';
            newItem.onclick = () => loadCustomView(viewName);
            newItem.innerHTML = `
                <span>ğŸ“Œ ${viewName}</span>
                <span class="text-small text-muted">0</span>
            `;
            viewsList.appendChild(newItem);
            
            alert(`è§†å›¾ "${viewName}" å·²ä¿å­˜`);
        }

        // åŠ è½½è‡ªå®šä¹‰è§†å›¾
        function loadCustomView(viewName) {
            const view = customViews[viewName];
            if (view) {
                activeFilters = {...view.filters};
                focusTasks = new Set(view.focusTasks);
                switchView(view.viewType);
                applyFilters();
            }
        }

        /* ========================================
           ğŸš€ ä»»åŠ¡æ“ä½œåŠŸèƒ½
           ======================================== */
        
        // å¯åŠ¨ä»»åŠ¡
        function launchTask(event, taskId) {
            event.stopPropagation();
            const task = tasks.find(t => t.id === taskId);
            if (task && task.launchLink) {
                console.log(`å¯åŠ¨ä»»åŠ¡: ${task.title}`);
                console.log(`è·³è½¬åˆ°: ${task.launchLink}`);
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨ window.location.href = task.launchLink
                alert(`æ¨¡æ‹Ÿå¯åŠ¨ä»»åŠ¡:\n${task.title}\n\né“¾æ¥: ${task.launchLink}`);
            }
        }

        // è®¾ç½®å¯åŠ¨é“¾æ¥
        function setLaunchLink(event, taskId) {
            event.stopPropagation();
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const link = prompt('è¯·è¾“å…¥MN uistateé“¾æ¥ï¼š', 'marginnote4app://note/');
            if (link) {
                task.launchLink = link;
                renderFocusTasks();
                alert('å¯åŠ¨é“¾æ¥å·²è®¾ç½®');
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress(event, taskId) {
            event.stopPropagation();
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const currentProgress = task.fields.progress || 0;
            const newProgress = prompt(`æ›´æ–°è¿›åº¦ (å½“å‰: ${currentProgress}%)ï¼š`, currentProgress);
            
            if (newProgress !== null && !isNaN(newProgress)) {
                const progress = Math.max(0, Math.min(100, parseInt(newProgress)));
                const note = prompt('è¿›å±•è¯´æ˜ï¼ˆå¯é€‰ï¼‰ï¼š');
                
                task.fields.progress = progress;
                
                // æ·»åŠ è¿›å±•è®°å½•
                if (!task.fields.progressLog) {
                    task.fields.progressLog = [];
                }
                
                task.fields.progressLog.push({
                    date: new Date().toLocaleString('zh-CN'),
                    progress: progress,
                    note: note || `è¿›åº¦æ›´æ–°è‡³ ${progress}%`
                });
                
                // å¦‚æœè¿›åº¦è¾¾åˆ°100%ï¼Œè‡ªåŠ¨æ›´æ–°çŠ¶æ€ä¸ºå·²å®Œæˆ
                if (progress === 100) {
                    task.status = 'å·²å®Œæˆ';
                }
                
                renderFocusTasks();
                alert(`è¿›åº¦å·²æ›´æ–°è‡³ ${progress}%`);
            }
        }

        // æŸ¥çœ‹è¿›å±•æ—¥å¿—
        function viewProgressLog(event, taskId) {
            event.stopPropagation();
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.fields.progressLog || task.fields.progressLog.length === 0) {
                alert('æš‚æ— è¿›å±•è®°å½•');
                return;
            }
            
            const logHtml = task.fields.progressLog.map(log => `
                <div class="progress-log-item">
                    <div class="progress-log-time">${log.date}</div>
                    <div class="progress-log-content">
                        <span class="progress-log-value">${log.progress}%</span> - ${log.note}
                    </div>
                </div>
            `).join('');
            
            // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä½¿ç”¨æ¨¡æ€æ¡†
            const logWindow = window.open('', 'è¿›å±•æ—¥å¿—', 'width=600,height=400');
            logWindow.document.write(`
                <html>
                <head>
                    <title>è¿›å±•æ—¥å¿— - ${task.title}</title>
                    <style>
                        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 20px; background: #0a0a0f; color: #fff; }
                        h2 { margin-bottom: 20px; }
                        .progress-log-item { display: flex; gap: 16px; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
                        .progress-log-time { font-size: 14px; color: #6c6c7c; min-width: 140px; }
                        .progress-log-content { flex: 1; font-size: 14px; }
                        .progress-log-value { font-weight: 600; color: #667eea; }
                    </style>
                </head>
                <body>
                    <h2>${task.title} - è¿›å±•æ—¥å¿—</h2>
                    ${logHtml}
                </body>
                </html>
            `);
        }

        // åˆ‡æ¢å½“å‰ç„¦ç‚¹çŠ¶æ€
        function toggleCurrentFocus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯å·²ç»åœ¨ç„¦ç‚¹ä¸­çš„ä»»åŠ¡ï¼Œåˆ‡æ¢å…¶æ´»è·ƒçŠ¶æ€
                if (task.currentFocus) {
                    task.currentFocus = false;
                } else {
                    // å…ˆå°†å…¶ä»–ä»»åŠ¡çš„ç„¦ç‚¹çŠ¶æ€å–æ¶ˆ
                    tasks.forEach(t => t.currentFocus = false);
                    task.currentFocus = true;
                }
                renderFocusTasks();
            }
        }

        // æ·»åŠ åˆ°ç„¦ç‚¹ä»»åŠ¡
        function addToFocus(taskId) {
            if (focusTasks.size >= 5) {
                alert('ç„¦ç‚¹ä»»åŠ¡ä¸èƒ½è¶…è¿‡5ä¸ªï¼Œè¯·å…ˆç§»é™¤å…¶ä»–ä»»åŠ¡');
                return;
            }
            
            focusTasks.add(taskId);
            renderFocusTasks();
        }

        /* ========================================
           ğŸ› ï¸ å·¥å…·å‡½æ•°
           ======================================== */
        
        // è·å–ä»»åŠ¡ç±»å‹å›¾æ ‡
        function getTaskTypeIcon(type) {
            const icons = {
                'ç›®æ ‡': 'ğŸ¯',
                'å…³é”®ç»“æœ': 'ğŸ”‘',
                'é¡¹ç›®': 'ğŸ“',
                'åŠ¨ä½œ': 'âš¡'
            };
            return icons[type] || 'ğŸ“Œ';
        }

        // è·å–çŠ¶æ€å›¾æ ‡
        function getStatusIcon(status) {
            const icons = {
                'æœªå¼€å§‹': 'â¸',
                'è¿›è¡Œä¸­': 'ğŸš€',
                'å·²å®Œæˆ': 'âœ…'
            };
            return icons[status] || 'â“';
        }

        // è·å–ä¼˜å…ˆçº§å›¾æ ‡
        function getPriorityIcon(priority) {
            const icons = {
                'é«˜': 'ğŸ”´',
                'ä¸­': 'ğŸŸ¡',
                'ä½': 'ğŸŸ¢'
            };
            return icons[priority] || 'âšª';
        }

        // è·å–çŠ¶æ€æ ·å¼ç±»
        function getStatusClass(status) {
            const classes = {
                'æœªå¼€å§‹': 'text-muted',
                'è¿›è¡Œä¸­': 'text-warning',
                'å·²å®Œæˆ': 'text-success'
            };
            return classes[status] || '';
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const diffDays = Math.floor((date - today) / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'ä»Šå¤©';
            if (diffDays === 1) return 'æ˜å¤©';
            if (diffDays === -1) return 'æ˜¨å¤©';
            if (diffDays > 0 && diffDays <= 7) return `${diffDays}å¤©å`;
            if (diffDays < 0) return `é€¾æœŸ${-diffDays}å¤©`;
            
            return date.toLocaleDateString('zh-CN');
        }

        // åˆ‡æ¢è§†å›¾
        function switchView(viewName) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewName);
            });
            
            // éšè—æ‰€æœ‰è§†å›¾
            document.querySelectorAll('.view-container').forEach(view => {
                view.classList.add('hidden');
            });
            
            // æ˜¾ç¤ºç›®æ ‡è§†å›¾
            const targetView = document.getElementById(`view-${viewName}`);
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            currentView = viewName;
            
            // æ ¹æ®è§†å›¾ç±»å‹æ¸²æŸ“å†…å®¹
            switch(viewName) {
                case 'focus':
                    renderFocusTasks();
                    break;
                case 'today':
                    renderTodayTimeline();
                    break;
                // å…¶ä»–è§†å›¾å¾…å®ç°
            }
        }

        // å¿«é€Ÿæ·»åŠ ä»»åŠ¡
        function handleQuickAdd(event) {
            if (event.key !== 'Enter') return;
            
            const input = event.target;
            const text = input.value.trim();
            if (!text) return;
            
            // è§£æè¾“å…¥æ–‡æœ¬
            let title = text;
            let tags = [];
            let priority = 'ä¸­';
            let project = '';
            
            // æå–æ ‡ç­¾ #tag
            const tagMatches = text.match(/#(\S+)/g);
            if (tagMatches) {
                tags = tagMatches.map(tag => tag.substring(1));
                title = title.replace(/#\S+/g, '').trim();
            }
            
            // æå–é¡¹ç›® @project
            const projectMatch = text.match(/@(\S+)/);
            if (projectMatch) {
                project = projectMatch[1];
                title = title.replace(/@\S+/g, '').trim();
            }
            
            // æå–ä¼˜å…ˆçº§ !high !medium !low
            const priorityMatch = text.match(/!(\S+)/);
            if (priorityMatch) {
                const p = priorityMatch[1].toLowerCase();
                if (p === 'high' || p === 'é«˜') priority = 'é«˜';
                else if (p === 'low' || p === 'ä½') priority = 'ä½';
                title = title.replace(/!\S+/g, '').trim();
            }
            
            // åˆ›å»ºæ–°ä»»åŠ¡
            const newTask = {
                id: `task_${Date.now()}`,
                type: "åŠ¨ä½œ",
                status: "æœªå¼€å§‹",
                title: title,
                path: project || "å¿«é€Ÿæ·»åŠ ",
                launchLink: "",
                currentFocus: false,
                todayPlannedTime: "",
                fields: {
                    priority: priority,
                    dueDate: "",
                    tags: tags,
                    progress: 0,
                    today: true, // å¿«é€Ÿæ·»åŠ çš„ä»»åŠ¡é»˜è®¤ä¸ºä»Šæ—¥ä»»åŠ¡
                    progressLog: [],
                    customViews: [],
                    project: project
                }
            };
            
            tasks.unshift(newTask);
            input.value = '';
            
            // åˆ·æ–°å½“å‰è§†å›¾
            switch(currentView) {
                case 'focus':
                    renderFocusTasks();
                    break;
                case 'today':
                    renderTodayTimeline();
                    break;
            }
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            console.log(`âœ… ä»»åŠ¡å·²æ·»åŠ : ${title}`);
        }

        /* ========================================
           ğŸš€ åº”ç”¨åˆå§‹åŒ–
           ======================================== */
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç”Ÿæˆæµ‹è¯•æ•°æ®
            generateTestData();
            
            // æ¸²æŸ“åˆå§‹è§†å›¾
            renderFocusTasks();
            
            console.log('ğŸš€ MNTask ç„¦ç‚¹çœ‹æ¿å·²å¯åŠ¨');
        });
    </script>
</body>
</html>