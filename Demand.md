我发现移动和删除评论的弹窗函数里都有一个问题，就是归类卡片的前缀有问题
```
“xxx”相关yy
```
的归类卡片的类型应该写成 `[yy归类]` 而不是 `[yy]` ultrathink
---
刚测试了还是有个 bug: 命题卡片证明字段的内容,如果移动到"相关思考"字段下方的某个评论 A,我刚测试了点击"A上方"和"A 下方",结果都是到了 A 上方 ultrathink         
---
第二层解决了，但是第三层没有完全解决，虽然我也能接受，但是你看这个图 [Image #1], 明显是 HtmlMarkdown评论字段下方的内容暴露出来了! 比如那个"倒数第一"到"纯手写" 这个部分应该隐藏在 "的回答很好的"这一项里面 ultrathink
---
再补充一下，刚刚的例子中，第三层也是和第二层同理，要有一个第三层的粗略位置，也就是 1 前面，1 后面， A，A top，A bottom，B，B top，B bottom，点击 A 或者 B 进入更细节的位置控制 ultrathink
---
你说的第三层,我怕你没理解正确,我补充一下,这个时候暴露出来的普通评论的前面应该是没有任何 HtmlMarkdown 评论的,一旦有,就和前面说的一样,一定属于某个 HtmlMarkdown 评论,那么这个时候就不能暴露在这层,比如 1, A, 2,B 3. 其中  A 和 B 是 HtmlMarkdown 评论，然后从左到右 index 增加，这个时候 1 就是需要和 HtmlMarkdown 同层，因为它不属于任何 HtmlMarkdown 评论，但是 2 属于 A， 3 输入 B，所以 2 需要点击 A 才能看到，3 需要点击 B 才能看到。 ultrathink
---
还是有问题：这张图
第二个弹窗怎么又把字段里的内容暴露了？
这个部分
这个时候不应该显示的，这个部分的内容，应该点击“证明区”然后在第三个弹窗里显示
第三个弹窗也是这个类似的问题：
应该像第二个弹窗一样，先提供每个 HtmlMarkdown 评论的 top 和 bottom，然后如果有进一步需要，再点 HtmlMarkdown，比如我点击 “你干嘛啊”，才到第四个弹窗的内容。

总结一下，其实现在要的效果有了，但是第二个和第三个窗口都有暴露内容的问题。还没把这个“文件夹”分得很彻底 ultrathink
---
继续开发 mntask: 现在任务只有三个状态，但是其实第三个状态可以点击后进行归档，我希望在状态栏那个地方也增加一个“已归档”状态，来与“已完成”区分，因为“已完成”可能会退回“进行中”。 ultrathink
---
我刚发现应该还需要一个弹窗，因为目前第三个弹窗是 HtmlMarkdown 评论与其下方的所有内容都暴露在一起，容易混淆。
应该是类似于第二个弹窗，如果要更精细移动化，再点 HtmlMarkdown 评论，这样就进入到第三层弹窗，里面的内容是 HtmlMarkdown 下方的所有内容。 这样才真正能实现三层，像文件夹一样的效果。ultrathink
---
这张图左边是具体的卡片，右边是第二层弹窗，有个问题是这个时候 HtmlMarkdown 评论的字段不应该显示的，不应该在这一层就暴露出来，只有当我需要进一步点击证明区的时候才需要，但我看点击后第三层的功能确实也实现了，请把这个第二层优化一下  ultrathink
---
1. 现在第一个弹窗里根本无法像 deleteCommentsByFieldPopup 那样多选！ ultrathink
---
1. 如果是解析的是纯链接，那么弹窗里显示的应该是标题，不过如果有前缀的话需要处理，参考一下别的函数的处理，其实就是处理为`[类型] 标题`
2. 手写内容没有正确识别类型，可以学习一下 deleteCommentsByFieldPopup 函数的类型处理。要注意用 note.MNComments 来获取更精细的类型
3. 你目前也只是开发了两层，你相当于把 HtmlMarkdown 评论和其它评论看成一种了。在第二层的时候，其余类型的评论不应该“暴露出来”，应该要进一步点击某条 HtmlMarkdown 评论才行。所以你得学习 MNMath 的字段识别和字段下方内容获取，HtmlMarkdown 评论也要有一套类似的。ultrathink
---
继续开发 mnutils

## moveCommentsByPopup 增加新功能
目前我们 xdyyutils.js 里的 MNMath 类有一些能够解析普通评论的函数（不是函数本身，而是内部实现了），你可以学习一下。这里普通评论是指文本手写，图片，链接之类的，也就是说，不是我们 MNMath 里专门的字段或者是 HtmlMarkdownUtils 类里加的这种评论，虽然它们本质上也是 markdown 评论。

目前的 moveCommentsByPopup 函数的功能是只实现了两层。第一层是 HtmlComment 类型评论的字段，第二层是点击 xx 区“进入了第一层到达第二层”（这里的“进入了第一层”是指获取了这个字段下面的内容，也就是到下一个字段之间的内容。）

然后我们目前可以解析 HtmlMarkdown 评论。但现在有一些还没考虑到的场景：
1. 第二层里没有 HtmlComment 类型评论的字段，而是普通评论
   - 这种情况下就需要能够解析普通评论，从而能够移动内容到这种评论的位置，也就是能精准定位。
2. 如果有 HtmlComment 类型，先解析，然后在现在的基础上进一步处理：
   - 如果两个 HtmlComment 类型 A 和 HtmlComment 评论 B 之间有普通评论，那么 A 的两条（也就是 A 上方和 A 下方）就增加一条，点击后可以“进入 A”，也就是到了第三层，再有一个弹窗，里面的内容是解析的 A 和 B 之间的评论，然后这个时候就只需要有某条“下方”，以及最开始和最下方即可，因为这样已经可以取遍所有index 了
   - 如果 A 和 B 之间没有普通评论，那么就保持只有 A 的两条，也就是 A 上方和 A 下方


## moveCommentsByPopup 触发后的默认效果需要优化
- 不需要关键词（这个有其它函数处理过，你可以学习一下，关键是是不显示“关键词”，但是不要影响“关键词”上面一个和下面一个字段的处理
- 加一个“最后一条评论”按钮，和手动输入“Z”是一个效果，因为我发现我经常移动最后一条评论。
ultrathink

## 选择移动的内容也要继续优化
在选择移动什么内容（也就是第一个弹窗的选项）时，目前能选择的内容只有
- 自动获取
- 手动输入 Index
- 某个具体的字段下方的全部内容

无法更加精细化地选择。目前已经在其它函数里通过弹窗实现了多选。

希望也能像刚刚的提到的那样，进行三层的解析，如果进入到第三层，或者没有 HtmlComment 评论时的第二层，可以通过弹窗选择，也可以多选，多选其实就是涵盖了整个字段的处理。