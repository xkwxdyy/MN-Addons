<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务管理器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            font-size: 14px;
        }
        
        .container {
            padding: 10px;
        }
        
        /* 快速添加区域 */
        .quick-add {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .quick-add-form {
            display: flex;
            gap: 8px;
        }
        
        .quick-add input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
        }
        
        .quick-add input:focus {
            border-color: #457bd3;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: #457bd3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3a6bc2;
        }
        
        .btn-today {
            background: #ff9500;
            color: white;
        }
        
        .btn-today:hover {
            background: #e88600;
        }
        
        .btn-advanced {
            background: #8e8e93;
            color: white;
        }
        
        .btn-advanced:hover {
            background: #7d7d82;
        }
        
        /* 筛选标签 */
        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .filter-tab {
            padding: 6px 14px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 13px;
        }
        
        .filter-tab:hover {
            background: #f0f0f0;
        }
        
        .filter-tab.active {
            background: #457bd3;
            color: white;
            border-color: #457bd3;
        }
        
        /* 任务列表 */
        .task-list {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .task-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .task-item:hover {
            background: #f8f8f8;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .task-status.pending {
            background: #8e8e93;
        }
        
        .task-status.in-progress {
            background: #007aff;
        }
        
        .task-status.completed {
            background: #34c759;
        }
        
        .task-status.overdue {
            background: #ff3b30;
        }
        
        .task-content {
            flex: 1;
        }
        
        .task-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .task-meta {
            font-size: 12px;
            color: #8e8e93;
            display: flex;
            gap: 12px;
        }
        
        .task-progress {
            display: inline-block;
            padding: 2px 8px;
            background: #f0f0f0;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .task-tag {
            display: inline-block;
            padding: 2px 8px;
            background: #fff3cd;
            color: #856404;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 8px;
        }
        
        .task-tag.today {
            background: #ffe4b5;
            color: #ff6b00;
        }
        
        .task-tag.urgent {
            background: #ffd4d4;
            color: #ff3b30;
        }
        
        .task-tag.high {
            background: #ffe4d4;
            color: #ff9500;
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8e8e93;
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .empty-state p {
            font-size: 14px;
        }
        
        /* 加载状态 */
        .loading {
            text-align: center;
            padding: 40px;
            color: #8e8e93;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 快速添加任务 -->
        <div class="quick-add">
            <div class="quick-add-form">
                <input type="text" id="quickTaskInput" placeholder="快速添加任务..." />
                <button class="btn btn-primary" onclick="TaskManager.quickAddTask()">添加</button>
                <button class="btn btn-today" onclick="TaskManager.quickAddTodayTask()">今日</button>
                <button class="btn btn-advanced" onclick="TaskManager.showAdvancedAdd()">高级</button>
            </div>
        </div>
        
        <!-- 筛选标签 -->
        <div class="filter-tabs">
            <div class="filter-tab active" onclick="TaskManager.filterTasks('all')">全部</div>
            <div class="filter-tab" onclick="TaskManager.filterTasks('today')">今日任务</div>
            <div class="filter-tab" onclick="TaskManager.filterTasks('pending')">待办</div>
            <div class="filter-tab" onclick="TaskManager.filterTasks('completed')">已完成</div>
            <div class="filter-tab" onclick="TaskManager.filterTasks('overdue')">已过期</div>
        </div>
        
        <!-- 任务列表 -->
        <div id="taskList" class="task-list">
            <div class="loading">加载中...</div>
        </div>
    </div>
    
    <script>
        // 任务管理器对象
        window.TaskManager = {
            currentFilter: 'all',
            tasks: [],
            
            // 初始化
            init: function() {
                // 监听输入框回车事件
                document.getElementById('quickTaskInput').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        TaskManager.quickAddTask();
                    }
                });
                
                // 加载任务
                this.refreshTasks();
            },
            
            // 刷新任务列表
            refreshTasks: function() {
                // 通过自定义协议请求原生代码获取任务
                window.location.href = 'mntask://getTasks?filter=' + this.currentFilter;
            },
            
            // 渲染任务列表
            renderTasks: function(tasks) {
                this.tasks = tasks;
                const listEl = document.getElementById('taskList');
                
                if (!tasks || tasks.length === 0) {
                    listEl.innerHTML = `
                        <div class="empty-state">
                            <h3>暂无任务</h3>
                            <p>点击上方输入框快速创建新任务</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                tasks.forEach(task => {
                    const statusClass = task.isOverdue ? 'overdue' : task.status;
                    const progressText = task.progress + '%';
                    
                    html += `
                        <div class="task-item" onclick="TaskManager.openTask('${task.id}')">
                            <div class="task-status ${statusClass}"></div>
                            <div class="task-content">
                                <div class="task-title">
                                    ${this.escapeHtml(task.title)}
                                    ${task.isToday ? '<span class="task-tag today">今日</span>' : ''}
                                    ${task.priority === 'urgent' ? '<span class="task-tag urgent">紧急</span>' : ''}
                                    ${task.priority === 'high' ? '<span class="task-tag high">高优先级</span>' : ''}
                                </div>
                                <div class="task-meta">
                                    <span class="task-progress">${progressText}</span>
                                    ${task.dueDate ? '<span>截止: ' + task.dueDate + '</span>' : ''}
                                    ${task.childCount > 0 ? '<span>子任务: ' + task.childCount + '</span>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                listEl.innerHTML = html;
            },
            
            // 筛选任务
            filterTasks: function(filter) {
                this.currentFilter = filter;
                
                // 更新标签样式
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.classList.add('active');
                
                // 刷新列表
                this.refreshTasks();
            },
            
            // 快速添加任务
            quickAddTask: function() {
                const input = document.getElementById('quickTaskInput');
                const title = input.value.trim();
                
                if (!title) return;
                
                // 通过自定义协议创建任务
                window.location.href = 'mntask://createTask?title=' + encodeURIComponent(title) + '&priority=normal&isToday=false';
                
                // 清空输入框
                input.value = '';
            },
            
            // 快速添加今日任务
            quickAddTodayTask: function() {
                const input = document.getElementById('quickTaskInput');
                const title = input.value.trim();
                
                if (!title) return;
                
                // 通过自定义协议创建今日任务
                window.location.href = 'mntask://createTask?title=' + encodeURIComponent(title) + '&priority=normal&isToday=true';
                
                // 清空输入框
                input.value = '';
            },
            
            // 显示高级添加界面
            showAdvancedAdd: function() {
                window.location.href = 'mntask://showAdvancedAdd';
            },
            
            // 打开任务详情
            openTask: function(taskId) {
                window.location.href = 'mntask://openTask?taskId=' + taskId;
            },
            
            // HTML 转义
            escapeHtml: function(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, m => map[m]);
            }
        };
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            TaskManager.init();
        });
    </script>
</body>
</html>